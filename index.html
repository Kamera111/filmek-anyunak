<!-- [1 eleje] DOCTYPE + HEAD + ALAP STÍLUSOK -->
<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Filmek Anyunak</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0c1320; --card:#172238; --card2:#121b2f;
      --txt:#dbeafe; --muted:#9fb0ce; --cyan:#22d3ee; --blue:#60a5fa; --green:#10b981; --red:#ef4444; --amber:#f59e0b; --vio:#8b5cf6;
      --ring:#3b82f6;
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--txt);font-family:Inter,system-ui,Segoe UI,Arial,sans-serif;min-height:100vh}
    .container{max-width:1200px;margin:0 auto;padding:24px}
    h1{font-size:40px;margin:0 0 24px 0;color:#9ee3ff;font-weight:800}
    .grid{display:grid;gap:18px}
    .grid.cols-3{grid-template-columns:repeat(3,1fr)}
    .btn{border:0;border-radius:14px;padding:16px 22px;font-weight:800;cursor:pointer;color:#0b1220;background:#7dd3fc;box-shadow:0 6px 20px rgba(125,211,252,.2)}
    .btn.secondary{background:#334155;color:#e2e8f0}
    .btn.red{background:var(--red);color:#fff}
    .btn.green{background:var(--green);color:#032016}
    .btn.vio{background:var(--vio);color:#fff}
    .btn.small{padding:10px 14px;border-radius:999px;font-weight:700}
    .badge{display:inline-flex;gap:6px;align-items:center;border-radius:999px;background:#0f172a;color:#cbd5e1;padding:4px 10px;font-size:12px}
    .card{background:var(--card);border:1px solid #1f2a44;border-radius:var(--radius);padding:22px}
    .tile{background:var(--card2);border:1px solid #1a2640;border-radius:20px;min-height:102px;display:flex;align-items:center;justify-content:center;font-size:24px;font-weight:700;cursor:pointer;transition:transform .12s ease, background .12s ease}
    .tile:hover{transform:translateY(-2px);background:#182542}
    .tile .counts{position:absolute;left:18px;bottom:12px;display:flex;gap:8px}
    .row{display:flex;gap:14px;align-items:center}
    .right{margin-left:auto}
    .muted{color:var(--muted)}
    .hidden{display:none !important}
    .sticky-top{position:sticky;top:0;z-index:40;background:linear-gradient(180deg,rgba(12,19,32,.98),rgba(12,19,32,.9));backdrop-filter:blur(8px);padding:16px 0 12px 0}
    .list{display:grid;gap:12px}
    .item{display:flex;gap:14px;background:var(--card2);border:1px solid #253250;border-radius:16px;padding:12px;align-items:center}
    .item img{width:128px;height:80px;object-fit:cover;border-radius:10px;border:1px solid #304066;flex:0 0 auto}
    .item .meta{display:flex;flex-direction:column;gap:6px;min-width:0}
    .item .title{font-weight:800;font-size:18px;color:#e6f2ff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .item .sub{font-size:12px;color:#94a3b8}
    .item .actions{margin-left:auto;display:flex;gap:8px}
    .pill{display:inline-flex;gap:8px;align-items:center;padding:7px 12px;border-radius:999px;border:1px solid #2a3a5c;background:#0e172a;color:#cbd5e1;font-weight:700}
    .topbar{display:flex;gap:12px;align-items:center}
    .topbar h2{font-size:28px;margin:0 10px 0 0;color:#bfe9ff;font-weight:800}
    .sticky-right{position:sticky;top:16px;margin-left:auto}
    .float-add{position:fixed;right:22px;bottom:22px;z-index:50}
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;z-index:70}
    .modal{background:#0f172a;border:1px solid #223459;border-radius:18px;max-width:560px;width:92vw;padding:20px}
    .modal h3{margin:0 0 14px 0;font-size:22px}
    .field{display:flex;flex-direction:column;gap:8px;margin-bottom:12px}
    .field input,.field select,.field textarea{background:#0b1222;border:1px solid #24324f;color:#eaf2ff;border-radius:12px;padding:12px 14px;outline:0}
    .field input:focus,.field textarea:focus,.field select:focus{box-shadow:0 0 0 3px rgba(59,130,246,.4);border-color:#3b82f6}
    .flex{display:flex;gap:10px;align-items:center}
    .center{display:flex;align-items:center;justify-content:center}
    .pin-wrap{max-width:760px;width:92vw;padding:28px;border-radius:22px;background:linear-gradient(180deg,#101a2c 0%, #0c1426 100%);border:1px solid #1c2b48;box-shadow:0 30px 100px rgba(0,0,0,.35)}
    .pin-dots{display:flex;gap:16px;justify-content:center;align-items:center;height:64px;border:2px solid #cfe2ff;border-radius:16px;background:#0f172a}
    .dot{width:10px;height:10px;border-radius:999px;background:#293751}
    .dot.filled{background:#9fb9ff}
    .video-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:90}
    .video-modal{width:min(92vw,980px);aspect-ratio:16/9;background:#000;border-radius:12px;overflow:hidden;border:1px solid #1e293b}
    .top-right-fixed{position:fixed;right:22px;top:18px;z-index:60}
    @media (max-width:960px){.grid.cols-3{grid-template-columns:1fr}}
  </style>
</head>
<!-- [1 vége] -->
<body>
<!-- [2 eleje] PIN / ADMIN OVERLAY + VIDEÓ LEJÁTSZÓ MODÁL -->
<div id="overlay" class="modal-backdrop">
  <div class="pin-wrap">
    <h1 class="center" style="gap:14px;">Filmek Anyunak</h1>
    <p class="center muted" style="margin-top:-6px;">Vendég PIN szükséges</p>

    <!-- Láthatatlan PIN mező – gépeléskor automatikus belépés -->
    <input id="pinField"
           type="password"
           inputmode="numeric"
           pattern="[0-9]*"
           maxlength="4"
           autocomplete="one-time-code"
           autofocus
           style="position:absolute;opacity:0;pointer-events:none;height:1px;width:1px;"/>

    <!-- Vizuális PIN pöttyök -->
    <div class="pin-dots" id="pinDots" tabindex="0" title="Írd be a PIN-t">
      <span class="dot"></span><span class="dot"></span><span class="dot"></span><span class="dot"></span>
    </div>

    <div class="center" style="gap:14px;margin-top:16px;">
      <!-- Belépés gomb már nem szükséges, maradhat tartaléknak -->
      <button class="btn" id="btnPinEnter" style="display:none;">Belépés</button>
      <button class="btn vio" id="btnAdmin">A</button>
    </div>
    <p class="center muted" style="margin-top:14px;">Vendég PIN: <b>1954</b></p>
  </div>
</div>

<div id="adminModal" class="modal-backdrop hidden">
  <div class="modal">
    <h3>Admin bejelentkezés</h3>
    <div class="field"><label>Email</label><input id="adminEmail" type="email" placeholder="admin@example.com"></div>
    <div class="field"><label>Jelszó</label><input id="adminPass" type="password" placeholder="••••••••"></div>
    <div class="row"><button class="btn green" id="adminLogin">Belépés</button><button class="btn secondary" id="adminCancel">Mégse</button><span class="muted" id="adminMsg"></span></div>
  </div>
</div>

<div id="videoModal" class="video-backdrop hidden">
  <div class="video-modal" id="videoBox"></div>
</div>
<!-- [2 vége] -->

<!-- [3 eleje] FŐOLDAL + KATEGÓRIA OLDAL + STICKY VISSZA -->
<div id="app" class="container hidden">
  <div class="top-right-fixed">
    <span class="badge" id="userBadge">Vendég</span>
    <button class="btn red small" id="btnLogout">Kijelentkezés</button>
  </div>

  <div id="homeView">
    <h1>Filmek Anyunak</h1>
    <div id="catGrid" class="grid cols-3"></div>
    <p class="muted" style="margin-top:18px;">Válassz kategóriát…</p>
  </div>

  <div id="listView" class="hidden">
    <div class="sticky-top">
      <div class="topbar">
        <button class="btn red small" id="btnBack">VISSZA A FŐOLDALRA</button>
        <h2 id="listTitle">Kategória</h2>
        <span class="pill" id="countPill">Összesen: 0</span>
        <span class="pill" id="newPill">ÚJ: 0</span>
        <div class="right">
          <button class="btn small green hidden" id="btnAdd">+ Új film feltöltése (csak admin)</button>
        </div>
      </div>
    </div>
    <div class="list" id="movieList"></div>
  </div>
</div>
<!-- [3 vége] -->

<!-- [4 eleje] FELTÖLTÉS MODÁL + TÖRLÉS MEGERŐSÍTÉS -->
<div id="uploadModal" class="modal-backdrop hidden">
  <div class="modal">
    <h3>Új film feltöltése</h3>
    <div class="field"><label>Kategória</label>
      <select id="fCategory"></select>
    </div>
    <div class="field"><label>Link (YouTube ajánlott)</label>
      <input id="fLink" placeholder="https://www.youtube.com/watch?v=...">
    </div>
    <div class="field"><label>Cím</label>
      <input id="fTitle" placeholder="Automatikus kitöltés a linkből">
    </div>
    <div class="field"><label>Borító kép</label>
      <input id="fPoster" placeholder="Automatikus kitöltés a linkből">
    </div>
    <div class="field"><label>Miről szól?</label>
      <textarea id="fPlot" rows="4" placeholder="Automatikus kitöltés a linkből"></textarea>
    </div>
    <div class="row">
      <button class="btn green" id="btnSaveMovie">Mentés</button>
      <button class="btn secondary" id="btnCancelUpload">Mégse</button>
      <span class="muted" id="uMsg"></span>
    </div>
  </div>
</div>

<div id="deleteModal" class="modal-backdrop hidden">
  <div class="modal">
    <h3 style="color:#fecaca;">Biztos törlöd?</h3>
    <p class="muted">A film végleg törlődik.</p>
    <div class="row">
      <button class="btn red" id="btnDoDelete">Igen, törlöm</button>
      <button class="btn secondary" id="btnCancelDelete">Mégse</button>
    </div>
  </div>
</div>
<!-- [4 vége] -->

<!-- [5 eleje] ADATMODELL, ÁLLANDÓK, SEGÉDEK -->
<script>
const PIN_GUEST = "1954";
const ADMIN_EMAIL = "chisnyan@gmail.com";  // <== tetszőlegesen átírható
const ADMIN_PASS  = "admin123";            // <== tetszőlegesen átírható

const STORAGE_KEY = "filmek_anyunak_v1";
const CATEGORIES = [
  "Akció","Vígjáték","Kaland","Sorozatok","Új filmek","Thriller TV",
  "Top Filmek","Akció TV","Vígjáték TV","Beszélgetés","Színészek szerint","Krimi"
];

let state = {
  isGuest: false,
  isAdmin: false,
  currentCategory: null,
  movies: [],           // {id,title,link,poster,plot,categories[],createdAt}
  deleteId: null
};

const $ = sel => document.querySelector(sel);
const $$ = sel => document.querySelectorAll(sel);

function uid(){ return Math.random().toString(36).slice(2)+Date.now().toString(36) }
function now(){ return Date.now() }
function load(){ try{ const j=localStorage.getItem(STORAGE_KEY); return j? JSON.parse(j):[] }catch{ return [] } }
function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state.movies)) }
function byCat(cat){ return state.movies.filter(m => (m.categories||[]).includes(cat)) }
function newCount(list){
  const t = now()-7*24*3600*1000;
  return list.filter(m => m.createdAt && m.createdAt>=t).length;
}
function escapeHtml(s=''){ return s.replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])) }

function ytThumb(url){
  const m=url.match(/(?:v=|\/)([0-9A-Za-z_-]{11})(?:[&?]|$)/);
  return m? `https://img.youtube.com/vi/${m[1]}/hqdefault.jpg` : '';
}
function ytEmbed(url){
  const m=url.match(/(?:v=|\/)([0-9A-Za-z_-]{11})(?:[&?]|$)/);
  return m? `https://www.youtube.com/embed/${m[1]}?autoplay=1&rel=0` : null;
}
</script>
<!-- [5 vége] -->

<!-- [6 eleje] BELÉPÉS / ADMIN LOGIN LOGIKA -->
<script>
const overlay = $("#overlay");
const pinDots = $("#pinDots");
const pinField = $("#pinField");

function renderDots(){
  const val = (pinField.value || "").slice(0,4);
  const dots = pinDots.querySelectorAll(".dot");
  dots.forEach(d=>d.classList.remove("filled"));
  for(let i=0;i<val.length;i++) dots[i].classList.add("filled");
}

function tryAutoEnter(){
  const val = pinField.value;
  if(val.length===4){
    if(val===PIN_GUEST){
      state.isGuest = true;
      overlay.classList.add("hidden");
      $("#app").classList.remove("hidden");
      $("#userBadge").textContent="Vendég";
      renderHome();
    }else{
      // rossz PIN → törlés és pöttyök reset
      pinField.value="";
      renderDots();
    }
  }
}

// fókusz a pötty keretre kattintva
pinDots.addEventListener("click", ()=> pinField.focus() );

// automatikus belépés gépelésre
pinField.addEventListener("input", ()=>{ renderDots(); tryAutoEnter(); });

// Admin
$("#btnAdmin").addEventListener("click", ()=>{
  $("#adminModal").classList.remove("hidden");
  $("#adminEmail").focus();
});
$("#adminLogin").addEventListener("click", ()=>{
  const em=$("#adminEmail").value.trim();
  const pw=$("#adminPass").value.trim();
  if(em===ADMIN_EMAIL && pw===ADMIN_PASS){
    state.isAdmin=true; state.isGuest=true;
    $("#adminMsg").textContent=""; $("#adminModal").classList.add("hidden");
    overlay.classList.add("hidden");
    $("#app").classList.remove("hidden");
    $("#userBadge").textContent="Admin";
    renderHome();
  } else {
    $("#adminMsg").textContent="Hibás adatok";
  }
});
$("#adminCancel").addEventListener("click", ()=> $("#adminModal").classList.add("hidden"));
$("#btnLogout").addEventListener("click", ()=>{
  state.isAdmin=false; state.isGuest=false; pinField.value=""; renderDots();
  $("#app").classList.add("hidden"); overlay.classList.remove("hidden");
  // fókusz vissza a pin mezőre
  setTimeout(()=>pinField.focus(), 0);
});
</script>
<!-- [6 vége] -->

<!-- [7 eleje] FŐOLDALI KATEGÓRIÁK + SZÁMLÁLÓK -->
<script>
state.movies = load();

function renderHome(){
  $("#homeView").classList.remove("hidden");
  $("#listView").classList.add("hidden");

  const grid = $("#catGrid");
  grid.innerHTML = "";
  CATEGORIES.forEach(cat=>{
    const list = byCat(cat);
    const nNew = newCount(list);
    const nAll = list.length;

    const tile = document.createElement("div");
    tile.className="tile";
    tile.style.position="relative";
    tile.textContent = cat;

    const counts = document.createElement("div");
    counts.className="counts";
    const b1 = document.createElement("span"); b1.className="badge"; b1.innerHTML=`ÚJ: <b>${nNew}</b>`;
    const b2 = document.createElement("span"); b2.className="badge"; b2.innerHTML=`Összesen: <b>${nAll}</b>`;
    counts.appendChild(b1); counts.appendChild(b2);
    tile.appendChild(counts);

    tile.addEventListener("click", ()=> openCategory(cat));
    grid.appendChild(tile);
  });
}
</script>
<!-- [7 vége] -->

<!-- [8 eleje] KATEGÓRIA OLDAL + LISTA + RAGADÓS VISSZA -->
<script>
const listView = $("#listView");
const listEl = $("#movieList");

$("#btnBack").addEventListener("click", ()=>{
  state.currentCategory=null;
  renderHome();
});

function openCategory(cat){
  state.currentCategory = cat;
  $("#homeView").classList.add("hidden");
  listView.classList.remove("hidden");
  $("#listTitle").textContent = cat;
  $("#btnAdd").classList.toggle("hidden", !state.isAdmin);
  $("#fCategory").innerHTML = CATEGORIES.map(c=>`<option ${c===cat?'selected':''}>${c}</option>`).join("");
  renderList();
}

function renderList(){
  const list = byCat(state.currentCategory);
  $("#countPill").textContent = `Összesen: ${list.length}`;
  $("#newPill").textContent = `ÚJ: ${newCount(list)}`;
  listEl.innerHTML = "";
  list.sort((a,b)=> (b.createdAt||0)-(a.createdAt||0)).forEach(m=>{
    const row = document.createElement("div");
    row.className="item";
    const img = document.createElement("img");
    img.src = m.poster || ytThumb(m.link) || "https://placehold.co/256x160/0f172a/64748b?text=No+Poster";
    const meta = document.createElement("div");
    meta.className="meta";
    meta.innerHTML = `<div class="title" title="${escapeHtml(m.title||'')}">${escapeHtml(m.title||'Ismeretlen cím')}</div>
      <div class="sub">${new Date(m.createdAt||Date.now()).toLocaleDateString('hu-HU')} • ${escapeHtml((m.plot||'').slice(0,96))}</div>`;
    const actions = document.createElement("div");
    actions.className="actions";
    const play = document.createElement("button"); play.className="btn small"; play.textContent="Lejátszás";
    play.addEventListener("click", ()=> playMovie(m.link));
    actions.appendChild(play);
    if(state.isAdmin){
      const del = document.createElement("button"); del.className="btn small red"; del.textContent="Törlés";
      del.addEventListener("click", ()=>{ state.deleteId=m.id; $("#deleteModal").classList.remove("hidden"); });
      actions.appendChild(del);
    }
    row.appendChild(img); row.appendChild(meta); row.appendChild(actions);
    listEl.appendChild(row);
  });
}

function playMovie(link){
  const embed = ytEmbed(link);
  if(embed){
    $("#videoBox").innerHTML = `<iframe src="${embed}" width="100%" height="100%" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
    $("#videoModal").classList.remove("hidden");
  } else {
    window.open(link, "_blank");
  }
}
$("#videoModal").addEventListener("click", (e)=>{ if(e.target.id==="videoModal"){ $("#videoModal").classList.add("hidden"); $("#videoBox").innerHTML=""; }});
</script>
<!-- [8 vége] -->

<!-- [9 eleje] FELTÖLTÉS: MODÁL MEGNYITÁS, OEMBED KITÖLTÉS, MENTÉS -->
<script>
$("#btnAdd").addEventListener("click", ()=>{
  $("#uMsg").textContent="";
  $("#fLink").value=""; $("#fTitle").value=""; $("#fPoster").value=""; $("#fPlot").value="";
  $("#uploadModal").classList.remove("hidden");
});
$("#btnCancelUpload").addEventListener("click", ()=> $("#uploadModal").classList.add("hidden"));

$("#fLink").addEventListener("change", autoFillFromLink);
$("#fLink").addEventListener("blur", autoFillFromLink);

async function autoFillFromLink(){
  const url = $("#fLink").value.trim();
  if(!url) return;
  $("#uMsg").textContent="Adatok lekérése…";
  // YouTube oEmbed
  try{
    let title="", poster="", desc="";
    if(/(youtube\.com|youtu\.be)/i.test(url)){
      const res = await fetch(`https://www.youtube.com/oembed?url=${encodeURIComponent(url)}&format=json`);
      if(res.ok){
        const j = await res.json();
        title = j.title || "";
        poster = ytThumb(url);
        // Leírás oEmbed nem ad – kihagyjuk
      } else {
        poster = ytThumb(url);
      }
    }
    $("#fTitle").value = title || $("#fTitle").value;
    $("#fPoster").value = poster || $("#fPoster").value;
    if(!$("#fPoster").value) $("#fPoster").value = "https://placehold.co/600x360/0f172a/93a3b8?text=Poster";
    if(!$("#fPlot").value) $("#fPlot").value = desc || "";
    $("#uMsg").textContent="";
  }catch(e){
    $("#uMsg").textContent="Nem sikerült automatikusan kitölteni.";
  }
}

$("#btnSaveMovie").addEventListener("click", ()=>{
  const cat = $("#fCategory").value;
  const link = $("#fLink").value.trim();
  const title= $("#fTitle").value.trim() || "Ismeretlen cím";
  const poster = $("#fPoster").value.trim() || ytThumb(link);
  const plot = $("#fPlot").value.trim();
  if(!cat || !link){ $("#uMsg").textContent="Kategória és Link szükséges."; return; }
  const rec = { id: uid(), title, link, poster, plot, categories:[cat], createdAt: now() };
  state.movies.push(rec); save();
  $("#uploadModal").classList.add("hidden");
  if(state.currentCategory===cat) renderList(); else renderHome();
});
</script>
<!-- [9 vége] -->

<!-- [10 eleje] TÖRLÉS MEGERŐSÍTÉS -->
<script>
$("#btnCancelDelete").addEventListener("click", ()=> { state.deleteId=null; $("#deleteModal").classList.add("hidden"); });
$("#btnDoDelete").addEventListener("click", ()=>{
  if(!state.deleteId) return;
  state.movies = state.movies.filter(m=>m.id!==state.deleteId);
  save(); state.deleteId=null; $("#deleteModal").classList.add("hidden");
  if(state.currentCategory) renderList(); else renderHome();
});
</script>
<!-- [10 vége] -->

<!-- [11 eleje] KRIMI DEMÓ IMPORT GOMB NÉLKÜL (ELSŐ BETÖLTÉSNÉL HOZZÁADJUK, HA MÉG NINCS) -->
<script>
(function seedOnce(){
  const demoUrl = "https://www.youtube.com/watch?v=lGsmW8nPnpo";
  const exists = state.movies.some(m => m.link===demoUrl);
  if(!exists){
    state.movies.push({
      id: uid(),
      title: "YouTube – Krimi (minta)",
      link: demoUrl,
      poster: ytThumb(demoUrl),
      plot: "Minta krimi film (automatikus import).",
      categories:["Krimi"],
      createdAt: now()
    });
    save();
  }
})();
</script>
<!-- [11 vége] -->

<!-- [12 eleje] ALKALMAZÁS INDÍTÁS -->
<script>
window.addEventListener("load", ()=>{
  renderDots(); // PIN
  // Kategórialisták a feltöltő modálhoz
  $("#fCategory").innerHTML = CATEGORIES.map(c=>`<option ${state.currentCategory===c?'selected':''}>${c}</option>`).join("");
});
</script>
<!-- [12 vége] -->
</body>
</html>
