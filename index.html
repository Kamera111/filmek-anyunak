<!doctype html>
<html lang="hu">
<head>
  <!-- ===== [SZAKASZ 1] HEAD + META ‚Äì START ===== -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
  <title>Filmek Anyunak</title>
  <meta name="description" content="Filmek Anyunak ‚Äì egyszer≈±, gyors, szeretettel." />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3Eüé¨%3C/text%3E%3C/svg%3E">
  <!-- ===== [SZAKASZ 1] HEAD + META ‚Äì END ===== -->

  <!-- ===== [SZAKASZ 2] ST√çLUSOK ‚Äì START ===== -->
  <style>
    :root{
      --bg:#0b1324; --panel:#0f172a; --txt:#e5e7eb;
      --muted:#94a3b8; --accent:#22d3ee; --radius:20px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--txt);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    .wrap{max-width:1200px;margin:0 auto;padding:20px}
    .sticky{position:sticky;top:0;z-index:10;background:linear-gradient(180deg, rgba(11,19,36,.95), rgba(11,19,36,.78) 70%, rgba(11,19,36,0));backdrop-filter: blur(6px);margin:-20px -20px 16px -20px;padding:16px 20px 8px 20px;border-bottom:1px solid rgba(255,255,255,.04)}
    header{display:flex;align-items:center;gap:12px}
    .title{font-size:clamp(22px,3vw,34px);font-weight:800;letter-spacing:.4px}
    .btn{background:#111827;color:var(--txt);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:10px 14px;cursor:pointer}

    /* R√°cs a kateg√≥ri√°knak */
    #catBar{display:flex;flex-direction:column;gap:20px;margin-top:6px}
    .cats-row{display:grid;gap:20px;grid-template-columns:repeat(12,1fr)}
    .cats-row>.cat,.cats-row>a.cat{grid-column:span 4}
    .cat{display:flex;align-items:center;justify-content:center;text-align:center;background:#0f172a;border:1px solid rgba(255,255,255,.08);border-radius:var(--radius);padding:24px 18px;min-height:96px;color:var(--txt);font-size:clamp(20px,2.2vw,28px);font-weight:800;letter-spacing:.3px;cursor:pointer;text-decoration:none}
    .live strong{color:var(--accent)}
    #view{margin-top:22px}
    .card{display:flex;gap:14px;align-items:flex-start;background:#0f172a;border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:14px;margin:10px 0}
    .card img{width:120px;height:72px;object-fit:cover;border-radius:10px;border:1px solid rgba(255,255,255,.08)}
    .card .meta{display:flex;flex-direction:column;gap:6px}
    .muted{color:var(--muted);font-size:14px}
    footer{color:var(--muted);text-align:center;margin:28px 0 12px 0;font-size:14px}
    @media (max-width:960px){.cats-row>.cat,.cats-row>a.cat{grid-column:span 6}}
    @media (max-width:560px){.cats-row>.cat,.cats-row>a.cat{grid-column:span 12}.cat{min-height:84px}}

    /* ===== PIN bel√©p≈ë ===== */
    .gate{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(4,7,13,.94);backdrop-filter:blur(4px);z-index:9999}
    .pinbox{position:relative;background:#0f172a;border:1px solid rgba(255,255,255,.08);border-radius:22px;padding:20px;max-width:380px;width:92%}
    .pininput{width:100%;font-size:28px;border-radius:16px;border:1px solid rgba(255,255,255,.15);background:#0b1222;color:var(--txt);padding:16px 18px;text-align:center;letter-spacing:2px}
    .adminBtn{position:absolute;bottom:16px;right:16px;width:42px;height:42px;border-radius:999px;border:1px solid rgba(255,255,255,.18);background:#0b1222;color:var(--txt);font-weight:900;cursor:pointer}
  </style>
  <!-- ===== [SZAKASZ 2] ST√çLUSOK ‚Äì END ===== -->
</head>

<body>
  <!-- ===== [SZAKASZ 3] PIN BEL√âP≈ê ‚Äì START ===== -->
  <div id="gate" class="gate">
    <div class="pinbox">
      <input id="pin" class="pininput" type="tel" inputmode="numeric" autocomplete="one-time-code" placeholder="" maxlength="6" />
      <button id="btnAdminOpen" class="adminBtn" title="Admin bel√©p√©s">A</button>
    </div>
  </div>
  <!-- ===== [SZAKASZ 3] PIN BEL√âP≈ê ‚Äì END ===== -->

  <!-- ===== [SZAKASZ 4] ADMIN MODAL ‚Äì START ===== -->
  <div id="adminModal" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.55);z-index:10000">
    <div style="background:#0f172a;border:1px solid rgba(255,255,255,.12);border-radius:18px;padding:18px;min-width:300px;max-width:92%">
      <div style="font-weight:800;font-size:18px;margin-bottom:8px">Admin bel√©p√©s</div>
      <input id="admEmail" type="email" placeholder="Email" class="input" style="width:100%;font-size:16px;border-radius:12px;border:1px solid rgba(255,255,255,.18);background:#0b1222;color:#e5e7eb;padding:10px 12px">
      <input id="admPass"  type="password" placeholder="Jelsz√≥" class="input" style="margin-top:8px;width:100%;font-size:16px;border-radius:12px;border:1px solid rgba(255,255,255,.18);background:#0b1222;color:#e5e7eb;padding:10px 12px">
      <div style="display:flex;gap:10px;margin-top:10px">
        <button id="btnAdminCancel" class="btn" style="flex:1" type="button">M√©gse</button>
        <button id="btnAdminLogin"  class="btn" style="flex:1" type="button">Bel√©p√©s</button>
      </div>
    </div>
  </div>
  <!-- ===== [SZAKASZ 4] ADMIN MODAL ‚Äì END ===== -->

  <!-- ===== [SZAKASZ 5] APP ‚Äì START ===== -->
  <div class="wrap" id="app" hidden>
    <div class="sticky">
      <header>
        <div class="title">Filmek Anyunak</div>
        <button id="btnAdd" class="btn" hidden>+ √öj film ebbe a kateg√≥ri√°ba</button>
        <button id="btnLogout" class="btn" style="margin-left:auto" type="button">Kijelentkez√©s</button>
      </header>
    </div>

    <div id="catBar">
      <!-- SOR 1 -->
      <div class="cats-row">
        <button class="cat" data-cat="krimi"   type="button">Krimi</button>
        <button class="cat" data-cat="thriller" type="button">Thriller</button>
        <button class="cat" data-cat="akcio"    type="button">Akci√≥</button>
      </div>
      <!-- SOR 2 -->
      <div class="cats-row">
        <button class="cat live" data-cat="elo-thriller" type="button"><strong>√âL≈ê</strong> Thriller TV</button>
        <button class="cat live" data-cat="elo-akcio"    type="button"><strong>√âL≈ê</strong> Akci√≥ TV</button>
        <button class="cat live" data-cat="elo-vigjatek" type="button"><strong>√âL≈ê</strong> v√≠gj√°t√©k TV</button>
      </div>
      <!-- SOR 3 -->
      <div class="cats-row">
        <a class="cat live" href="https://player.telekomtvgo.hu/player/live?channelNumber=13" target="_blank" rel="noopener noreferrer"><strong>√âL≈ê</strong> Mozi +TV</a>
        <button class="cat" data-cat="thriller-2" type="button">Thriller</button>
        <button class="cat" data-cat="akcio-2"    type="button">Akci√≥</button>
      </div>
    </div>

    <div id="view"></div>
    <footer>¬© Filmek Anyunak</footer>
  </div>
  <!-- ===== [SZAKASZ 5] APP ‚Äì END ===== -->

  <!-- ===== [SZAKASZ 6] SCRIPT ‚Äì START ===== -->
  <script>
    // --- √Ålland√≥k/elemek
    const CORRECT_PIN = "195400";
    const gate = document.getElementById('gate');
    const app  = document.getElementById('app');
    const pin  = document.getElementById('pin');
    const btnAdminOpen = document.getElementById('btnAdminOpen');

    const adminModal = document.getElementById('adminModal');
    const admEmail = document.getElementById('admEmail');
    const admPass  = document.getElementById('admPass');
    const btnAdminLogin  = document.getElementById('btnAdminLogin');
    const btnAdminCancel = document.getElementById('btnAdminCancel');

    const btnLogout = document.getElementById('btnLogout');
    const btnAdd    = document.getElementById('btnAdd');
    const view      = document.getElementById('view');

    const LOG_KEY   = 'fa_logged_in';
    const ADMIN_KEY = 'fa_admin';
    let selectedCat = null;

    function showApp(){ gate.hidden = true; app.hidden = false; }
    function showGate(){ gate.hidden = false; app.hidden = true; }

    // Ha kor√°bban bel√©pett, azonnal app
    if (localStorage.getItem(LOG_KEY) === 'true') { showApp(); }

    // PIN: l√°that√≥ g√©pel√©s, 6 sz√°mn√°l ellen≈ërz√©s + automatikus nyit√°s
    pin?.addEventListener('input', () => {
      let v = (pin.value || '').replace(/\D/g,'');   // csak sz√°m
      if (pin.value !== v) pin.value = v;
      if (v.length === 6) {
        if (v === CORRECT_PIN) {
          localStorage.setItem(LOG_KEY, 'true');
          showApp();
        } else {
          // rossz PIN: √ºr√≠tj√ºk, hogy ne maradjon bent
          pin.value = '';
        }
      }
    });

    // Admin modal
    btnAdminOpen?.addEventListener('click', () => {
      adminModal.style.display = 'flex';
      admEmail.value = ''; admPass.value = '';
      setTimeout(()=>admEmail.focus(),50);
    });
    btnAdminCancel?.addEventListener('click', () => {
      adminModal.style.display = 'none';
    });
    btnAdminLogin?.addEventListener('click', () => {
      const e = admEmail.value.trim();
      const p = admPass.value;
      if (e === 'chisnyan@gmail.com' && p === 'C10201443ccc') {
        localStorage.setItem(ADMIN_KEY, 'true');
        localStorage.setItem(LOG_KEY, 'true');
        adminModal.style.display = 'none';
        showApp();
        updateAdminUI();
      } else {
        alert('Hib√°s admin adatok.');
      }
    });

    // Kijelentkez√©s
    btnLogout?.addEventListener('click', () => {
      localStorage.removeItem(LOG_KEY);
      localStorage.removeItem(ADMIN_KEY);
      location.reload();
    });

    // Kateg√≥ria kezel√©se
    const catTexts = {
      'krimi':'Krimi','thriller':'Thriller','akcio':'Akci√≥',
      'elo-thriller':'√âL≈ê Thriller TV','elo-akcio':'√âL≈ê Akci√≥ TV','elo-vigjatek':'√âL≈ê v√≠gj√°t√©k TV',
      'thriller-2':'Thriller','akcio-2':'Akci√≥'
    };

    document.querySelectorAll('.cat[data-cat]')?.forEach(b => b.addEventListener('click', () => {
      selectedCat = b.dataset.cat;
      const admin = localStorage.getItem(ADMIN_KEY) === 'true';
      const allowed = !selectedCat?.startsWith('elo-');
      btnAdd.hidden = !(admin && allowed);
      renderCategory(selectedCat);
    }));

    // √öj film felvitele (helyi ment√©s)
    btnAdd?.addEventListener('click', async () => {
      if (!selectedCat) return;
      const url = prompt('Illeszd be a film/link URL-j√©t:');
      if (!url) return;
      let meta = await tryFetchMeta(url);
      if (!meta) {
        const title = prompt('Nem siker√ºlt automatikusan kiolvasni a c√≠met.\n√çrd be a film c√≠m√©t:') || 'Ismeretlen c√≠m';
        const image = prompt('Bor√≠t√≥k√©p URL (opcion√°lis):') || '';
        meta = { title, image };
      }
      saveItem(selectedCat, { url, ...meta, created: Date.now() });
      renderCategory(selectedCat);
      alert('Felt√∂ltve (helyi ment√©s). Firebase szinkron k√ºl√∂n j√∂n).');
    });

    // Meta kiolvas√°s (best-effort)
    async function tryFetchMeta(url){
      try{
        const res = await fetch(url, {mode:'cors'});
        const html = await res.text();
        const doc = new DOMParser().parseFromString(html, 'text/html');
        const ogt = doc.querySelector('meta[property="og:title"]')?.content || doc.querySelector('title')?.textContent || '';
        const ogi = doc.querySelector('meta[property="og:image"]')?.content || '';
        if (ogt || ogi) return { title: ogt || 'Ismeretlen c√≠m', image: ogi };
        return null;
      }catch(e){ return null; }
    }

    // Helyi t√°rol√°s
    function loadItems(cat){
      const all = JSON.parse(localStorage.getItem('fa_items') || '{}');
      return all[cat] || [];
    }
    function saveItem(cat, item){
      const all = JSON.parse(localStorage.getItem('fa_items') || '{}');
      all[cat] = all[cat] || [];
      all[cat].unshift(item);
      localStorage.setItem('fa_items', JSON.stringify(all));
    }

    function renderCategory(cat){
      const items = loadItems(cat);
      const title = catTexts[cat] || 'Kateg√≥ria';
      let html = `<div class="muted" style="margin-bottom:8px">Kateg√≥ria: <strong>${title}</strong> ‚Äî elemek: ${items.length}</div>`;
      for (const it of items){
        html += `
          <div class="card">
            ${it.image ? `<img src="${it.image}" alt="">` : `<div style="width:120px;height:72px;border:1px solid rgba(255,255,255,.08);border-radius:10px;display:flex;align-items:center;justify-content:center" class="muted">Nincs k√©p</div>`}
            <div class="meta">
              <div style="font-weight:700">${escapeHTML(it.title || 'Ismeretlen c√≠m')}</div>
              <a href="${it.url}" target="_blank" rel="noopener noreferrer" class="muted">${it.url}</a>
            </div>
          </div>`;
      }
      if (items.length===0) html += `<div class="muted">M√©g nincs felt√∂lt√©s ebben a kateg√≥ri√°ban.</div>`;
      view.innerHTML = html;
    }

    function escapeHTML(s){return (s||'').replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]));}
    function updateAdminUI(){ const admin = localStorage.getItem(ADMIN_KEY) === 'true'; if (!admin) btnAdd.hidden = true; }
    updateAdminUI();
  </script>
  <!-- ===== [SZAKASZ 6] SCRIPT ‚Äì END ===== -->
</body>
</html>
