<!DOCTYPE html>
<html lang="hu">
<head>
  <!-- [1 eleje] HEAD + STÍLUSOK -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Filmek Anyunak</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: #0f172a;
      --card:#111827;
      --muted:#9ca3af;
      --text:#e5e7eb;
      --cyan:#06b6d4;
      --cyan2:#0891b2;
      --red:#ef4444;
      --red2:#b91c1c;
      --green:#10b981;
      --vio:#7c3aed;
      --bord:#334155;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
    .hidden{display:none !important}

    /* ===== PIN / OVERLAY ===== */
    .overlay{
      position:fixed; inset:0; z-index:50;
      display:flex; align-items:center; justify-content:center;
      background:rgba(0,0,0,.85);
      padding:24px;
    }
    .pin-card{
      width:100%; max-width:380px; background:var(--card);
      border:1px solid var(--bord);
      border-radius:20px; padding:22px; display:grid; gap:14px;
      box-shadow:0 10px 30px rgba(0,0,0,.35);
    }
    .pin-input{
      width:100%;
      padding:18px 16px;
      border-radius:14px;
      border:2px solid var(--bord);
      background:#0b1324;
      color:var(--text);
      font-size:26px;
      text-align:center;
      letter-spacing:10px;
    }
    .pin-input::placeholder{letter-spacing:0; color:var(--muted); font-size:16px}
    .row{display:flex; gap:10px; align-items:center; justify-content:center}
    .btn{
      border:none; cursor:pointer; font-weight:800; color:#fff;
      padding:12px 16px; border-radius:12px; transition:.2s;
      background:#1f2937; border:1px solid var(--bord)
    }
    .btn:hover{filter:brightness(1.1)}
    .btn.vio{background:var(--vio)}
    .btn.red{background:var(--red)}
    .btn.green{background:var(--green)}
    .muted{color:var(--muted); font-size:14px}

    /* ===== FŐOLDAL ===== */
    .container{max-width:980px; margin:0 auto; padding:20px}
    h1{margin:28px 0 20px; text-align:center; font-size:38px; font-weight:800; color:#8be9fd}
    .grid{
      display:grid; gap:12px;
      grid-template-columns: repeat(auto-fit,minmax(140px,1fr));
    }
    .cat-btn{
      position:relative;
      background:#0b1324; border:1px solid var(--bord);
      border-radius:16px; padding:16px; text-align:center;
      font-weight:800; font-size:16px; cursor:pointer;
      color:#cfeafe;
    }
    .cat-btn:hover{background:#0d1630}
    .badge{
      position:absolute; left:10px; top:8px; font-size:12px; font-weight:800;
      padding:4px 8px; border-radius:999px; background:var(--red);
    }
    .total{
      position:absolute; right:10px; bottom:8px; font-size:12px; font-weight:800;
      color:#fff; opacity:.9;
    }
    .footer-actions{display:flex; justify-content:center; margin:26px 0 10vh; gap:10px}

    /* ===== LISTA OLDAL ===== */
    #page-list{display:none}
    .list-header{
      position:sticky; top:0; z-index:15;
      display:flex; align-items:center; justify-content:center;
      background:linear-gradient(180deg, rgba(15,23,42,.98), rgba(15,23,42,.92));
      padding:10px; border-bottom:1px solid var(--bord);
      backdrop-filter: blur(6px);
    }
    .list-title{font-size:26px; font-weight:800; text-align:center; margin:6px 0; color:#cfeafe}
    .top-right{
      position:absolute; right:10px; top:10px;
    }
    .top-left{
      position:absolute; left:10px; top:10px;
    }
    .cards{max-width:980px; margin:16px auto 60px; padding:0 12px; display:grid; gap:14px}
    .movie-card{
      display:grid; grid-template-columns:120px 1fr; gap:14px;
      background:var(--card); border:1px solid var(--bord); border-radius:16px; padding:12px;
    }
    .poster img{width:100%; height:100%; max-height:160px; object-fit:cover; border-radius:12px}
    .title{font-size:18px; font-weight:800; color:#8be9fd}
    .desc{font-size:14px; color:var(--muted); margin-top:6px}
    .btn.sm{padding:8px 10px; font-size:12px; border-radius:10px}

    /* ===== MODÁLOK ===== */
    .modal-backdrop{
      position:fixed; inset:0; z-index:60; display:none;
      align-items:center; justify-content:center;
      background:rgba(0,0,0,.75); padding:18px;
    }
    .modal{
      width:100%; max-width:520px; background:var(--card); border:1px solid var(--bord);
      border-radius:16px; padding:18px; display:grid; gap:10px;
    }
    .field{display:grid; gap:6px}
    .field input, .field textarea, .field select{
      background:#0b1324; color:var(--text); border:1px solid var(--bord);
      border-radius:10px; padding:10px 12px; outline:none
    }
    .video-backdrop{
      position:fixed; inset:0; display:none; z-index:70;
      background:rgba(0,0,0,.9); align-items:center; justify-content:center; padding:16px;
    }
    .video-modal{
      width:min(1100px,96vw); aspect-ratio:16/9; background:#000; border-radius:12px; overflow:hidden;
      border:1px solid #222;
    }
  </style>
  <!-- [1 vége] -->
</head>
<body>

  <!-- [2 eleje] PIN / ADMIN OVERLAY + VIDEÓ LEJÁTSZÓ MODÁL -->
  <div id="overlay" class="overlay">
    <div class="pin-card">
      <input id="pinField" class="pin-input" type="password" maxlength="4"
             inputmode="numeric" pattern="[0-9]*"
             placeholder="érints ide és add a PINt!"/>
      <div class="row">
        <button id="btnAdmin" class="btn vio" title="Admin">A</button>
      </div>
    </div>
  </div>

  <div id="adminModal" class="modal-backdrop">
    <div class="modal">
      <h3 style="margin:0 0 6px; font-size:22px; font-weight:800; color:#cfeafe">Admin bejelentkezés</h3>
      <div class="field"><label>Email</label><input id="adminEmail" type="email" placeholder="chisnyan@gmail.com"></div>
      <div class="field"><label>Jelszó</label><input id="adminPass" type="password" placeholder="••••••••••••"></div>
      <div class="row" style="justify-content:space-between">
        <span id="adminMsg" class="muted"></span>
        <div class="row">
          <button id="adminLogin" class="btn green">Belépés</button>
          <button id="adminCancel" class="btn">Mégse</button>
        </div>
      </div>
    </div>
  </div>

  <div id="videoModal" class="video-backdrop"><div id="videoBox" class="video-modal"></div></div>
  <!-- [2 vége] -->

  <!-- [3 eleje] FŐOLDAL (KATEGÓRIA GOMBOK + SZÁMLÁLÓK) -->
  <div id="page-home" class="container">
    <h1>Filmek Anyunak</h1>

    <div class="grid" id="catGrid">
      <!-- Gombok automatikusan generálva JS-ből a CATEGORIES alapján -->
    </div>

    <div class="footer-actions">
      <button id="logoutGuest" class="btn red">Kilépés mindenből</button>
    </div>
  </div>
  <!-- [3 vége] -->

  <!-- [4 eleje] LISTA OLDAL (STICKY VISSZA + ADMIN FELTÖLTÉS) -->
  <div id="page-list" class="container">
    <div class="list-header">
      <div class="top-left">
        <button id="btnAdd" class="btn vio hidden">+ Feltöltés</button>
      </div>
      <div class="list-title" id="listTitle">Kategória</div>
      <div class="top-right">
        <button id="btnBack" class="btn red">VISSZA A FŐOLDALRA</button>
      </div>
    </div>

    <div id="listGrid" class="cards"></div>
  </div>

  <!-- Feltöltő modal (csak admin) -->
  <div id="addModal" class="modal-backdrop">
    <div class="modal">
      <h3 style="margin:0 0 6px; font-size:22px; font-weight:800; color:#cfeafe">Új film hozzáadása</h3>
      <div class="field">
        <label>Link (YouTube ajánlott)</label>
        <input id="addLink" type="url" placeholder="https://www.youtube.com/watch?v=...">
      </div>
      <div class="field">
        <label>Cím</label>
        <input id="addTitle" type="text" placeholder="Automatikus kitöltés a link alapján">
      </div>
      <div class="field">
        <label>Borító kép (URL)</label>
        <input id="addPoster" type="url" placeholder="Automatikus kitöltés a link alapján">
      </div>
      <div class="field">
        <label>Miről szól? (opcionális)</label>
        <textarea id="addDesc" rows="3" placeholder="Rövid leírás"></textarea>
      </div>
      <div class="row" style="justify-content:space-between">
        <span id="addMsg" class="muted"></span>
        <div class="row">
          <button id="addSave" class="btn green">Mentés</button>
          <button id="addCancel" class="btn">Mégse</button>
        </div>
      </div>
    </div>
  </div>
  <!-- [4 vége] -->

  <!-- [5.1 eleje] PIN + ADMIN BELÉPTETÉS (JS) -->
  <script>
    const GUEST_PIN = "1954";
    const OK_EMAIL = "chisnyan@gmail.com";
    const OK_PASS  = "C10201443ccc";

    const gateOverlay   = document.getElementById('overlay');
    const guestPinInput = document.getElementById('pinField');

    const adminModal    = document.getElementById('adminModal');
    const openAdminBtn  = document.getElementById('btnAdmin');
    const adminEmailEl  = document.getElementById('adminEmail');
    const adminPassEl   = document.getElementById('adminPass');
    const adminLoginBtn = document.getElementById('adminLogin');
    const adminCancelBtn= document.getElementById('adminCancel');
    const adminMsg      = document.getElementById('adminMsg');

    let IS_ADMIN = false;
    window.__APP__ = window.__APP__ || {};
    Object.defineProperty(window.__APP__, 'isAdmin', { get(){ return IS_ADMIN; } });

    function guestTryOpen(){
      const v = (guestPinInput.value||'').trim();
      if (v.length === 4){
        if (v === GUEST_PIN){
          gateOverlay.style.display = 'none';
          window.dispatchEvent(new CustomEvent('guest-logged-in'));
        } else {
          guestPinInput.value = '';
          guestPinInput.placeholder = 'Hibás PIN! Próbáld újra…';
          setTimeout(()=> guestPinInput.placeholder = 'érints ide és add a PINt!', 1200);
        }
      }
    }
    guestPinInput.addEventListener('input', guestTryOpen);
    guestPinInput.addEventListener('keydown', e=>{ if(e.key==='Enter') guestTryOpen(); });

    openAdminBtn.addEventListener('click', ()=>{
      adminMsg.textContent = ''; adminModal.style.display='flex';
      setTimeout(()=> adminEmailEl.focus(), 10);
    });
    adminCancelBtn.addEventListener('click', ()=> adminModal.style.display='none');

    function doAdminLogin(){
      const email = (adminEmailEl.value||'').trim();
      const pass  = (adminPassEl.value||'').trim();
      if (email===OK_EMAIL && pass===OK_PASS){
        IS_ADMIN = true;
        adminModal.style.display='none';
        gateOverlay.style.display='none';
        window.dispatchEvent(new CustomEvent('admin-logged-in'));
      } else {
        adminMsg.textContent = 'Hibás adatok';
      }
    }
    adminLoginBtn.addEventListener('click', doAdminLogin);
    adminPassEl.addEventListener('keydown', e=>{ if(e.key==='Enter') doAdminLogin(); });

    window.addEventListener('load', ()=> guestPinInput.focus());
  </script>
  <!-- [5.1 vége] -->

  <!-- [6 eleje] ADATKEZELÉS, LISTÁK, SZÁMLÁLÓK, LEJÁTSZÁS -->
  <script>
    /* 6.1 Kategóriák */
    const CATEGORIES = [
      { key:'akcio',       label:'Akció' },
      { key:'vigjatek',    label:'Vígjáték' },
      { key:'kaland',      label:'Kaland' },
      { key:'sorozatok',   label:'Sorozatok' },
      { key:'uj',          label:'Új filmek' },
      { key:'thrillertv',  label:'Thriller TV' },
      { key:'top',         label:'Top Filmek' },
      { key:'akciotv',     label:'Akció TV' },
      { key:'vigjatektv',  label:'Vígjáték TV' },
      { key:'beszelgetes', label:'Beszélgetés' },
      { key:'szineszek',   label:'Színészek szerint' },
      { key:'krimi',       label:'Krimi' }
    ];
    const CAT_BY_LABEL = Object.fromEntries(CATEGORIES.map(c=>[c.label,c.key]));

    /* 6.2 Perzisztencia */
    const LS_KEY = 'fa_movies_v1';
    function loadDB(){ try{ return JSON.parse(localStorage.getItem(LS_KEY)) || {}; }catch{ return {}; } }
    function saveDB(db){ try{ localStorage.setItem(LS_KEY, JSON.stringify(db)); }catch{} }
    let DB = loadDB();

    /* 6.3 Segédek */
    const pageHome = document.getElementById('page-home');
    const pageList = document.getElementById('page-list');
    const listTitle= document.getElementById('listTitle');
    const listGrid = document.getElementById('listGrid');
    const catGrid  = document.getElementById('catGrid');
    const btnBack  = document.getElementById('btnBack');
    const btnAdd   = document.getElementById('btnAdd');
    const logoutGuest = document.getElementById('logoutGuest');

    const addModal = document.getElementById('addModal');
    const addLink  = document.getElementById('addLink');
    const addTitle = document.getElementById('addTitle');
    const addPoster= document.getElementById('addPoster');
    const addDesc  = document.getElementById('addDesc');
    const addMsg   = document.getElementById('addMsg');
    const addSave  = document.getElementById('addSave');
    const addCancel= document.getElementById('addCancel');

    function now(){ return Date.now(); }
    function daysAgo(n){ return now() - n*24*60*60*1000; }
    function isNew(ts){ return (ts||0) >= daysAgo(7); }

    function normalizeMovie(m){
      return {
        id: m.id || (crypto.randomUUID ? crypto.randomUUID() : String(now())+Math.random()),
        title: (m.title||'Ismeretlen cím').trim(),
        url: (m.url||'').trim(),
        poster: (m.poster||'').trim(),
        desc: (m.desc||'').trim(),
        createdAt: m.createdAt || now()
      };
    }
    function listByCat(key){ DB[key] ||= []; return DB[key]; }
    function addMovie(key, movie){ DB[key] ||= []; DB[key].unshift(normalizeMovie(movie)); saveDB(DB); }
    function delMovie(key, id){ if(!DB[key]) return; DB[key]=DB[key].filter(x=>x.id!==id); saveDB(DB); }

    function extractYtId(url){
      try{
        const u = new URL(url);
        if (u.hostname.includes('youtu.be')) return u.pathname.slice(1);
        if (u.searchParams.get('v')) return u.searchParams.get('v');
        const m = url.match(/\/embed\/([A-Za-z0-9_\-]+)/);
        return m ? m[1] : null;
      }catch{ return null; }
    }
    async function fetchYouTubeMeta(url){
      try{
        const res = await fetch(`https://www.youtube.com/oembed?format=json&url=${encodeURIComponent(url)}`);
        if(!res.ok) throw 0;
        const data = await res.json();
        const vid = extractYtId(url);
        const poster = vid ? `https://img.youtube.com/vi/${vid}/hqdefault.jpg` : (data.thumbnail_url || '');
        return { title: data.title || 'Ismeretlen cím', poster };
      }catch{
        return { title: 'Ismeretlen cím', poster: '' };
      }
    }

    /* 6.4 Főoldali gombok létrehozása */
    function makeCatButtons(){
      catGrid.innerHTML = '';
      CATEGORIES.forEach(c=>{
        const b = document.createElement('button');
        b.className = 'cat-btn';
        b.dataset.cat = c.key;
        b.innerHTML = `
          <span class="badge" id="new-${c.key}" style="display:none">ÚJ: 0</span>
          <div style="font-size:18px;font-weight:800">${c.label}</div>
          <span class="total" id="total-${c.key}">Összesen: 0</span>
        `;
        b.addEventListener('click', ()=> openCategory(c.key));
        catGrid.appendChild(b);
      });
    }

    /* 6.5 Számlálók frissítése */
    function updateBadges(){
      CATEGORIES.forEach(c=>{
        const arr   = listByCat(c.key);
        const total = arr.length;
        const news  = arr.filter(m=>isNew(m.createdAt)).length;
        const newEl = document.getElementById(`new-${c.key}`);
        const totEl = document.getElementById(`total-${c.key}`);
        if (newEl){
          if (news>0){ newEl.textContent = `ÚJ: ${news}`; newEl.style.display='inline-block'; }
          else newEl.style.display='none';
        }
        if (totEl) totEl.textContent = `Összesen: ${total}`;
      });
    }

    /* 6.6 Oldalváltás */
    function showHome(){ pageHome.style.display='block'; pageList.style.display='none'; }
    function showList(){ pageHome.style.display='none'; pageList.style.display='block'; }

    btnBack.addEventListener('click', showHome);
    logoutGuest.addEventListener('click', ()=> location.href='https://www.google.com');

    /* 6.7 Lista renderelés + lejátszás */
    const videoModal = document.getElementById('videoModal');
    const videoBox   = document.getElementById('videoBox');
    function openVideo(url){
      let html = '';
      const yt = extractYtId(url);
      if (yt){
        html = `<iframe width="100%" height="100%" src="https://www.youtube.com/embed/${yt}" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
      } else if (/vimeo\.com/.test(url)){
        const id = url.split('/').pop();
        html = `<iframe width="100%" height="100%" src="https://player.vimeo.com/video/${id}" frameborder="0" allow="autoplay; fullscreen" allowfullscreen></iframe>`;
      } else {
        html = `<video controls autoplay style="width:100%;height:100%;object-fit:contain;"><source src="${url}"></video>`;
      }
      videoBox.innerHTML = html;
      videoModal.style.display='flex';
    }
    function closeVideo(){ videoBox.innerHTML=''; videoModal.style.display='none'; }
    videoModal.addEventListener('click', e=>{ if(e.target===videoModal) closeVideo(); });

    let CURRENT_CAT = null;
    function renderList(key){
      CURRENT_CAT = key;
      const cat = CATEGORIES.find(c=>c.key===key);
      listTitle.textContent = cat ? cat.label : 'Kategória';

      const arr = listByCat(key);
      listGrid.innerHTML = '';
      if (arr.length===0){
        const empty = document.createElement('div');
        empty.className = 'muted';
        empty.style.textAlign='center';
        empty.style.padding='24px';
        empty.textContent = 'Nincs találat ebben a kategóriában.';
        listGrid.appendChild(empty);
      } else {
        arr.forEach(m=>{
          const card = document.createElement('div');
          card.className='movie-card';
          card.innerHTML = `
            <div class="poster"><img src="${m.poster || 'https://placehold.co/320x180?text=Nincs+bor%C3%ADt%C3%B3'}" alt=""></div>
            <div>
              <div class="title">${m.title}</div>
              ${m.desc ? `<div class="desc">${m.desc}</div>` : ``}
              <div class="row" style="margin-top:10px; justify-content:flex-start">
                <button class="btn sm green">Lejátszás</button>
                ${window.__APP__.isAdmin ? `<button class="btn sm red" data-del="${m.id}">Törlés</button>` : ``}
              </div>
            </div>
          `;
          card.querySelector('.btn.green').addEventListener('click', ()=> openVideo(m.url));
          if (window.__APP__.isAdmin){
            card.querySelector('[data-del]').addEventListener('click', ()=>{
              if (confirm('Biztosan törlöd?')){
                delMovie(key, card.querySelector('[data-del]').dataset.del);
                renderList(key); updateBadges();
              }
            });
          }
          listGrid.appendChild(card);
        });
      }
      btnAdd.classList.toggle('hidden', !window.__APP__.isAdmin);
      showList();
    }

    function openCategory(key){ renderList(key); }

    /* 6.8 Feltöltő modal logika (auto kitöltés link alapján) */
    function showAdd(){ if(!window.__APP__.isAdmin) return; addMsg.textContent=''; addModal.style.display='flex'; setTimeout(()=>addLink.focus(),10); }
    function hideAdd(){ addModal.style.display='none'; addLink.value=''; addTitle.value=''; addPoster.value=''; addDesc.value=''; addMsg.textContent=''; }
    btnAdd.addEventListener('click', showAdd);
    addCancel.addEventListener('click', hideAdd);

    addLink.addEventListener('input', async ()=>{
      const url = addLink.value.trim();
      if (!url) { addTitle.value=''; addPoster.value=''; return; }
      addMsg.textContent='Kitöltés…';
      const meta = await fetchYouTubeMeta(url);
      addTitle.value  = meta.title || addTitle.value;
      addPoster.value = meta.poster || addPoster.value;
      addMsg.textContent='';
    });

    addSave.addEventListener('click', ()=>{
      if (!CURRENT_CAT) { addMsg.textContent='Válassz kategóriát előbb!'; return; }
      const url = addLink.value.trim();
      if (!url){ addMsg.textContent='Adj meg egy linket!'; return; }
      const movie = {
        title: addTitle.value.trim() || 'Ismeretlen cím',
        url,
        poster: addPoster.value.trim(),
        desc: addDesc.value.trim()
      };
      addMovie(CURRENT_CAT, movie);
      hideAdd();
      renderList(CURRENT_CAT);
      updateBadges();
    });

    /* 6.9 Események: belépések */
    window.addEventListener('guest-logged-in', ()=>{
      makeCatButtons();
      updateBadges();
      showHome();
    });
    window.addEventListener('admin-logged-in', ()=>{
      makeCatButtons();
      updateBadges();
      showHome();
      btnAdd.classList.toggle('hidden', !window.__APP__.isAdmin);
    });

    /* 6.10 Első indítás (ha már belépve maradt volna, itt most mindig overlay van) */
    // csak gombok és számlálók előkészítése háttérben
    makeCatButtons(); updateBadges();
  </script>
  <!-- [6 vége] -->

</body>
</html>

<!-- [7 eleje] FŐOLDALI KATEGÓRIÁK + SZÁMLÁLÓK -->
<script>
state.movies = load();

function renderHome(){
  $("#homeView").classList.remove("hidden");
  $("#listView").classList.add("hidden");

  const grid = $("#catGrid");
  grid.innerHTML = "";
  CATEGORIES.forEach(cat=>{
    const list = byCat(cat);
    const nNew = newCount(list);
    const nAll = list.length;

    const tile = document.createElement("div");
    tile.className="tile";
    tile.style.position="relative";
    tile.textContent = cat;

    const counts = document.createElement("div");
    counts.className="counts";
    const b1 = document.createElement("span"); b1.className="badge"; b1.innerHTML=`ÚJ: <b>${nNew}</b>`;
    const b2 = document.createElement("span"); b2.className="badge"; b2.innerHTML=`Összesen: <b>${nAll}</b>`;
    counts.appendChild(b1); counts.appendChild(b2);
    tile.appendChild(counts);

    tile.addEventListener("click", ()=> openCategory(cat));
    grid.appendChild(tile);
  });
}
</script>
<!-- [7 vége] -->

<!-- [8 eleje] KATEGÓRIA OLDAL + LISTA + RAGADÓS VISSZA -->
<script>
const listView = $("#listView");
const listEl = $("#movieList");

$("#btnBack").addEventListener("click", ()=>{
  state.currentCategory=null;
  renderHome();
});

function openCategory(cat){
  state.currentCategory = cat;
  $("#homeView").classList.add("hidden");
  listView.classList.remove("hidden");
  $("#listTitle").textContent = cat;
  $("#btnAdd").classList.toggle("hidden", !state.isAdmin);
  $("#fCategory").innerHTML = CATEGORIES.map(c=>`<option ${c===cat?'selected':''}>${c}</option>`).join("");
  renderList();
}

function renderList(){
  const list = byCat(state.currentCategory);
  $("#countPill").textContent = `Összesen: ${list.length}`;
  $("#newPill").textContent = `ÚJ: ${newCount(list)}`;
  listEl.innerHTML = "";
  list.sort((a,b)=> (b.createdAt||0)-(a.createdAt||0)).forEach(m=>{
    const row = document.createElement("div");
    row.className="item";
    const img = document.createElement("img");
    img.src = m.poster || ytThumb(m.link) || "https://placehold.co/256x160/0f172a/64748b?text=No+Poster";
    const meta = document.createElement("div");
    meta.className="meta";
    meta.innerHTML = `<div class="title" title="${escapeHtml(m.title||'')}">${escapeHtml(m.title||'Ismeretlen cím')}</div>
      <div class="sub">${new Date(m.createdAt||Date.now()).toLocaleDateString('hu-HU')} • ${escapeHtml((m.plot||'').slice(0,96))}</div>`;
    const actions = document.createElement("div");
    actions.className="actions";
    const play = document.createElement("button"); play.className="btn small"; play.textContent="Lejátszás";
    play.addEventListener("click", ()=> playMovie(m.link));
    actions.appendChild(play);
    if(state.isAdmin){
      const del = document.createElement("button"); del.className="btn small red"; del.textContent="Törlés";
      del.addEventListener("click", ()=>{ state.deleteId=m.id; $("#deleteModal").classList.remove("hidden"); });
      actions.appendChild(del);
    }
    row.appendChild(img); row.appendChild(meta); row.appendChild(actions);
    listEl.appendChild(row);
  });
}

function playMovie(link){
  const embed = ytEmbed(link);
  if(embed){
    $("#videoBox").innerHTML = `<iframe src="${embed}" width="100%" height="100%" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
    $("#videoModal").classList.remove("hidden");
  } else {
    window.open(link, "_blank");
  }
}
$("#videoModal").addEventListener("click", (e)=>{ if(e.target.id==="videoModal"){ $("#videoModal").classList.add("hidden"); $("#videoBox").innerHTML=""; }});
</script>
<!-- [8 vége] -->

<!-- [9 eleje] FELTÖLTÉS: MODÁL MEGNYITÁS, OEMBED KITÖLTÉS, MENTÉS -->
<script>
$("#btnAdd").addEventListener("click", ()=>{
  $("#uMsg").textContent="";
  $("#fLink").value=""; $("#fTitle").value=""; $("#fPoster").value=""; $("#fPlot").value="";
  $("#uploadModal").classList.remove("hidden");
});
$("#btnCancelUpload").addEventListener("click", ()=> $("#uploadModal").classList.add("hidden"));

$("#fLink").addEventListener("change", autoFillFromLink);
$("#fLink").addEventListener("blur", autoFillFromLink);

async function autoFillFromLink(){
  const url = $("#fLink").value.trim();
  if(!url) return;
  $("#uMsg").textContent="Adatok lekérése…";
  // YouTube oEmbed
  try{
    let title="", poster="", desc="";
    if(/(youtube\.com|youtu\.be)/i.test(url)){
      const res = await fetch(`https://www.youtube.com/oembed?url=${encodeURIComponent(url)}&format=json`);
      if(res.ok){
        const j = await res.json();
        title = j.title || "";
        poster = ytThumb(url);
        // Leírás oEmbed nem ad – kihagyjuk
      } else {
        poster = ytThumb(url);
      }
    }
    $("#fTitle").value = title || $("#fTitle").value;
    $("#fPoster").value = poster || $("#fPoster").value;
    if(!$("#fPoster").value) $("#fPoster").value = "https://placehold.co/600x360/0f172a/93a3b8?text=Poster";
    if(!$("#fPlot").value) $("#fPlot").value = desc || "";
    $("#uMsg").textContent="";
  }catch(e){
    $("#uMsg").textContent="Nem sikerült automatikusan kitölteni.";
  }
}

$("#btnSaveMovie").addEventListener("click", ()=>{
  const cat = $("#fCategory").value;
  const link = $("#fLink").value.trim();
  const title= $("#fTitle").value.trim() || "Ismeretlen cím";
  const poster = $("#fPoster").value.trim() || ytThumb(link);
  const plot = $("#fPlot").value.trim();
  if(!cat || !link){ $("#uMsg").textContent="Kategória és Link szükséges."; return; }
  const rec = { id: uid(), title, link, poster, plot, categories:[cat], createdAt: now() };
  state.movies.push(rec); save();
  $("#uploadModal").classList.add("hidden");
  if(state.currentCategory===cat) renderList(); else renderHome();
});
</script>
<!-- [9 vége] -->

<!-- [10 eleje] TÖRLÉS MEGERŐSÍTÉS -->
<script>
$("#btnCancelDelete").addEventListener("click", ()=> { state.deleteId=null; $("#deleteModal").classList.add("hidden"); });
$("#btnDoDelete").addEventListener("click", ()=>{
  if(!state.deleteId) return;
  state.movies = state.movies.filter(m=>m.id!==state.deleteId);
  save(); state.deleteId=null; $("#deleteModal").classList.add("hidden");
  if(state.currentCategory) renderList(); else renderHome();
});
</script>
<!-- [10 vége] -->

<!-- [11 eleje] KRIMI DEMÓ IMPORT GOMB NÉLKÜL (ELSŐ BETÖLTÉSNÉL HOZZÁADJUK, HA MÉG NINCS) -->
<script>
(function seedOnce(){
  const demoUrl = "https://www.youtube.com/watch?v=lGsmW8nPnpo";
  const exists = state.movies.some(m => m.link===demoUrl);
  if(!exists){
    state.movies.push({
      id: uid(),
      title: "YouTube – Krimi (minta)",
      link: demoUrl,
      poster: ytThumb(demoUrl),
      plot: "Minta krimi film (automatikus import).",
      categories:["Krimi"],
      createdAt: now()
    });
    save();
  }
})();
</script>
<!-- [11 vége] -->

<!-- [12 eleje] ALKALMAZÁS INDÍTÁS -->
<script>
window.addEventListener("load", ()=>{
  renderDots(); // PIN
  // Kategórialisták a feltöltő modálhoz
  $("#fCategory").innerHTML = CATEGORIES.map(c=>`<option ${state.currentCategory===c?'selected':''}>${c}</option>`).join("");
});
</script>
<!-- [12 vége] -->
</body>
</html>
