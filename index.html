<!doctype html>
<html lang="hu">
<head>
  <!-- ===== [SZAKASZ 1] HEAD + STÍLUSOK – START ===== -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Filmek Anyunak</title>
  <style>
    :root { --bg:#0f172a; --card:#111827; --muted:#94a3b8; --txt:#e5e7eb; --accent:#22d3ee; }
    html,body{margin:0;padding:0;background:var(--bg);color:var(--txt);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    .wrap{max-width:980px;margin:0 auto;padding:16px}
    .sticky{position:sticky;top:0;background:linear-gradient(180deg, rgba(15,23,42,.98), rgba(15,23,42,.75) 60%, rgba(15,23,42,0));backdrop-filter: blur(6px);z-index:10}
    header{display:flex;align-items:center;gap:12px;padding:12px 0}
    .title{font-weight:800;font-size:20px;letter-spacing:.3px}
    .btn{background:#1f2937;color:#fff;border:1px solid #334155;border-radius:12px;padding:10px 14px;cursor:pointer}
    .btn[hidden]{display:none!important}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px}
    .card{background:var(--card);border:1px solid #1f2937;border-radius:16px;padding:14px}
    .muted{color:var(--muted);font-size:14px}
    input,select,textarea{width:100%;padding:10px;border-radius:12px;border:1px solid #334155;background:#0b1220;color:#e5e7eb}
    label{font-size:13px;color:#b3c1d1;margin-bottom:6px;display:block}
    form .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    img{max-width:100%;border-radius:10px;border:1px solid #1f2937}
    a{color:#a5f3fc;text-decoration:none}
    a:hover{text-decoration:underline}
    .catbar{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0 18px}
    .pill{background:#0b1220;border:1px solid #334155;border-radius:999px;padding:8px 12px}
    .hidden{display:none!important}
    .pinBox,.loginBox{max-width:420px;margin:12vh auto;padding:18px}
    .pinInput{font-size:28px;letter-spacing:6px;text-align:center}
    .hint{font-size:12px;color:#9aa8b8}
    .movie a.title{font-weight:700;display:block;margin:6px 0}
    .del{border:1px dashed #ef4444;background:transparent;color:#ef4444}
    .footer{margin:30px 0 10px;text-align:center;color:#6b7280;font-size:12px}
  </style>
  <!-- ===== [SZAKASZ 1] HEAD + STÍLUSOK – END ===== -->
</head>
<body>
  <div class="wrap">
    <div class="sticky">
      <header>
        <div class="title">Filmek Anyunak</div>
        <div style="flex:1"></div>
        <button id="btnAddGlobal" class="btn hidden">+ Új film</button>
        <button id="btnAdminLogout" class="btn hidden">Kijelentkezés</button>
      </header>
    </div>

    <!-- App nézet (bejelentkezés után) -->
    <div id="app" class="card hidden">
      <h2>Filmlisták</h2>
      <div id="catBar" class="catbar"></div>
      <div id="lists" class="grid"></div>

      <!-- Admin panel: új film hozzáadás -->
      <div id="adminPanel" class="card hidden" style="margin-top:16px">
        <h3>Új film hozzáadása</h3>
        <form id="addMovieForm">
          <div class="row">
            <div>
              <label for="catSelect">Kategória</label>
              <select id="catSelect" name="cat" required></select>
            </div>
            <div>
              <label for="title">Cím</label>
              <input id="title" name="title" placeholder="Film címe" required />
            </div>
          </div>
          <label for="url">Link</label>
          <input id="url" name="url" type="url" placeholder="https://…" required />
          <label for="cover">Borítókép URL (opcionális)</label>
          <input id="cover" name="cover" type="url" placeholder="https://…" />
          <label for="desc">Leírás (opcionális)</label>
          <textarea id="desc" name="desc" rows="3" placeholder="Rövid leírás…"></textarea>
          <div style="height:10px"></div>
          <button class="btn" type="submit">Hozzáadás</button>
        </form>
      </div>
    </div>

    <div class="footer">© FilmeK Anyunak</div>
  </div>
<!-- ===== [SZAKASZ 1B] RESPONSIVE CSS – START ===== -->
<style>
  /* Alap konténer */
  .wrap {
    max-width: 980px;
    margin: 0 auto;
    padding: 16px;
  }

  /* Nagy, fehér kártya-gombok rácsa */
  .catsFull {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 14px;
    margin: 12px 0 24px;
  }
  .catsFull .cat.block {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 16px 18px;
    border-radius: 22px;
    border: 1px solid #2b3648;
    background: #111827;
    color: #e5e7eb;               /* FEHÉR felirat */
    font-weight: 700;
    font-size: 18px;
    letter-spacing: .3px;
    transition: transform .08s ease, box-shadow .12s ease, background .12s ease;
  }
  .catsFull .cat.block:hover {
    background: #0f172a;
    box-shadow: 0 0 0 2px #233147 inset;
  }
  .catsFull .cat.block:active {
    transform: scale(.98);
  }

  /* Filmkártyák (ha vannak) – reszponzív kép/typó */
  .movie img { width: 100%; height: auto; border-radius: 10px; }
  .movie .title { font-size: 16px; }
  @media (min-width: 420px) {
    .movie .title { font-size: 17px; }
  }

  /* PIN mező – mobilon is szép, nem túl nagy */
  .pinInput {
    width: 14ch;               /* 8–10 karakter szélességhez elég */
    max-width: 100%;
    text-align: center;
    font-size: 24px;
    letter-spacing: .4ch;
    padding: 10px 12px;
    border-radius: 12px;
    border: 1px solid #334155;
    background: #0b1220;
    color: #e5e7eb;
    margin-inline: auto;
    display: block;
  }
  @media (min-width: 480px) {
    .pinInput { font-size: 28px; }
  }

  /* Felső címsor (ha van) – kicsit kisebb mobilon */
  h1,h2 {
    line-height: 1.2;
    margin: 10px 0 6px;
  }
  h1 { font-size: clamp(22px, 5vw, 32px); }
  h2 { font-size: clamp(18px, 4.5vw, 24px); }

  /* Kártya dobozok */
  .card {
    background: #111827;
    border: 1px solid #1f2937;
    border-radius: 16px;
    padding: 14px;
  }

  /* Gombok */
  .btn {
    background: #1f2937;
    color: #fff;
    border: 1px solid #334155;
    border-radius: 12px;
    padding: 10px 14px;
    cursor: pointer;
    font-weight: 600;
  }
  .btn:active { transform: scale(.98); }

  /* Admin „A” kör gomb – érintésbarát */
  .admin-fab {
    width: 44px; height: 44px;
    border-radius: 999px;
    display: grid; place-items: center;
    border: 1px solid #334155;
    background: #1f2937; color: #e5e7eb;
    margin: 10px auto 0;
  }
  .admin-fab:active { transform: scale(.96); }

  /* Kisebb kijelzőn tömörebb margók */
  @media (max-width: 420px) {
    .wrap { padding: 12px; }
    .catsFull { gap: 10px; }
    .catsFull .cat.block { padding: 14px 16px; font-size: 16px; }
  }
</style>
<!-- ===== [SZAKASZ 1B] RESPONSIVE CSS – END ===== -->

  <!-- ===== [SZAKASZ 2] FIREBASE INIT (EGYSÉGES 10.12.4) – START ===== -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-analytics.js";
    import {
      getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot,
      serverTimestamp, query, orderBy
    } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";
    import { getAuth } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBDSI-z3a4IFAIoKCVZVcUyue7GMoO5acY",
      authDomain: "filmek-fe035.firebaseapp.com",
      projectId: "filmek-fe035",
      storageBucket: "filmek-fe035.appspot.com",
      messagingSenderId: "302167835367",
      appId: "1:302167835367:web:6e0fd4304c4496612c1842",
      measurementId: "G-QBG7LG0ZQH"
    };

    const app = initializeApp(firebaseConfig);
    try { getAnalytics(app); } catch(e) { /* analytics nem kötelező */ }

    const db = getFirestore(app);
    const auth = getAuth(app);

    // Globális elérés a többi szakasznak
    window.fb = {
      app, auth, db,
      fs: { collection, addDoc, deleteDoc, doc, onSnapshot, serverTimestamp, query, orderBy }
    };

    // Debug
    console.log("[FB] apiKey:", firebaseConfig.apiKey.slice(0,12));
    console.log("[FB] storageBucket:", firebaseConfig.storageBucket);
  </script>
  <!-- ===== [SZAKASZ 2] FIREBASE INIT – END ===== -->

  <!-- ===== [SZAKASZ 3] KATEGÓRIÁK + ALAP UI – START ===== -->
  <script type="module">
    const CATEGORIES = [
      { key: 'akcio',     name: 'Akció' },
      { key: 'thriller',  name: 'Thriller' },
      { key: 'krimi',     name: 'Krimi' },
      { key: 'vigjatek',  name: 'Vígjáték' },
      { key: 'szineszek', name: 'Színészek' }
    ];
    const catBar   = document.getElementById('catBar');
    const lists    = document.getElementById('lists');
    const catSelect= document.getElementById('catSelect');

    catBar.innerHTML   = CATEGORIES.map(c => `<button class="pill" data-cat="${c.key}">${c.name}</button>`).join('');
    lists.innerHTML    = CATEGORIES.map(c => `<div class="card"><h3>${c.name}</h3><div data-cat-list="${c.key}"></div></div>`).join('');
    catSelect.innerHTML= CATEGORIES.map(c => `<option value="${c.key}">${c.name}</option>`).join('');

    catBar.addEventListener('click', e=>{
      const btn=e.target.closest('[data-cat]'); if(!btn) return;
      document.querySelector(`[data-cat-list="${btn.dataset.cat}"]`)?.parentElement.scrollIntoView({behavior:"smooth"});
    });
  </script>
  <!-- ===== [SZAKASZ 3] KATEGÓRIÁK – END ===== -->

  <!-- ===== [SZAKASZ 4] AUTH (VENDÉG / ADMIN) – START ===== -->
  <script type="module">
    import { onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";

    const { auth } = window.fb;

    const pinView      = document.getElementById('pinView');
    const appView      = document.getElementById('app');
    const guestPin     = document.getElementById('guestPin');
    const btnGuest     = document.getElementById('btnGuestEnter');
    const adminForm    = document.getElementById('adminLoginForm');
    const adminEmailEl = document.getElementById('adminEmail');
    const adminPassEl  = document.getElementById('adminPass');
    const btnLogout    = document.getElementById('btnAdminLogout');
    const btnAdd       = document.getElementById('btnAddGlobal');
    const adminPanel   = document.getElementById('adminPanel');

    async function guestLoginFixed(){
      try{
        await signInWithEmailAndPassword(auth,"guest@filmek-anyunak.app","195400");
      }catch(e){
        alert("Vendég belépési hiba: "+e.message);
      }
    }
    btnGuest.addEventListener('click',e=>{e.preventDefault();guestLoginFixed();});
    guestPin.addEventListener('input',()=>{ if(guestPin.value.replace(/\D/g,'').length>=6) guestLoginFixed(); });

    adminForm.addEventListener('submit',async e=>{
      e.preventDefault();
      try{
        await signInWithEmailAndPassword(auth, adminEmailEl.value.trim(), adminPassEl.value);
      }catch(e){
        alert("Admin belépési hiba: "+e.message);
      }
    });

    btnLogout.addEventListener('click', async ()=>{ await signOut(auth); });
    btnAdd.addEventListener('click', ()=> adminPanel.scrollIntoView({behavior:"smooth"}));

    onAuthStateChanged(auth, u=>{
      const logged = !!u;
      const isAdmin= logged && u.email==="chisnyan@gmail.com";

      pinView.classList.toggle('hidden', logged);
      appView.classList.toggle('hidden', !logged);
      btnLogout.classList.toggle('hidden', !logged);
      btnAdd.classList.toggle('hidden', !isAdmin);
      adminPanel.classList.toggle('hidden', !isAdmin);

      if (logged) window.startRealtime?.();
    });
  </script>
  <!-- ===== [SZAKASZ 4] AUTH – END ===== -->

<!-- ===== [SZAKASZ 5] AUTH (VENDÉG + ADMIN GOMB) – START ===== -->

<style>
  /* Mobilbarát, kompakt belépő UI */
  #pinView{
    display:flex;flex-direction:column;align-items:center;gap:10px;margin:28px auto;
  }
  /* PIN mező: kb. 22 karakter, hogy elférjen a „Katt ide! Add a kódot!” */
  #guestPin{
    width:22ch;max-width:90vw;padding:10px 14px;border-radius:12px;
    border:1px solid #334155;background:#0b1220;color:#e5e7eb;
    font-size:1rem;text-align:center;outline:none;
  }
  #guestPin::placeholder{color:#94a3b8}
  /* Kis, kör alakú admin-gomb */
  #btnShowAdmin{
    padding:6px 10px;font-size:12px;border-radius:999px;background:#1f2937;
    color:#fff;border:1px solid #334155;cursor:pointer
  }
  /* Hibaüzenet a PIN-hez */
  #pinError{color:#fda4af;font-size:.9rem;text-align:center;min-height:1.2em}

  /* Admin űrlap (rejtve indul) */
  #adminLoginForm{display:none;width:22ch;max-width:90vw;gap:8px}
  #adminLoginForm.show{display:grid}
  #adminLoginForm input{
    padding:10px 12px;border-radius:12px;border:1px solid #334155;background:#0b1220;color:#e5e7eb
  }
  #adminLoginForm button{
    padding:10px 12px;border-radius:12px;background:#1f2937;color:#fff;border:1px solid #334155;cursor:pointer
  }

  @media (max-width:480px){ #guestPin{font-size:.95rem} }
</style>

<div id="pinView" class="wrap">
  <!-- Vendég PIN (6 szám után automatikus belépés) -->
  <input
    id="guestPin"
    class="pinInput"
    type="text"
    inputmode="numeric"
    pattern="[0-9]*"
    maxlength="6"
    placeholder="Katt ide! Add a kódot!"
    aria-label="Vendég PIN"
    autocomplete="one-time-code"
  />
  <!-- Hibaüzenet -->
  <div id="pinError" role="alert" aria-live="polite" style="display:none;"></div>

  <!-- Admin űrlap megnyitása -->
  <button id="btnShowAdmin" type="button" title="Admin belépés">A</button>

  <!-- Admin belépő (mindig üres mezőkkel, autofill tiltva) -->
  <form id="adminLoginForm" autocomplete="off">
    <input
      id="adminEmail" type="email" inputmode="email"
      placeholder="Admin email" value=""
      autocomplete="off" autocapitalize="none" spellcheck="false"
      name="admin_email" required
    />
    <input
      id="adminPass" type="password"
      placeholder="Jelszó" value=""
      autocomplete="new-password" autocapitalize="none"
      spellcheck="false" name="admin_pass" required
    />
    <button type="submit">Admin belépés</button>
  </form>
</div>

<script type="module">
  import { onAuthStateChanged, signInWithEmailAndPassword, signOut }
    from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";

  // A [SZAKASZ 2–3]-ból jön (initializeApp + window.fb.auth)
  const auth = window.fb && window.fb.auth;
  if (!auth) {
    console.error("Auth nincs inicializálva. Ellenőrizd a [SZAKASZ 2–3]-at!");
  }

  // Elemeink
  const pinView      = document.getElementById('pinView');
  const appView      = document.getElementById('app');          // a fő nézeted
  const guestPin     = document.getElementById('guestPin');
  const pinError     = document.getElementById('pinError');
  const btnShowAdmin = document.getElementById('btnShowAdmin');
  const adminForm    = document.getElementById('adminLoginForm');

  // Opcionális, ha felül vannak:
  const btnLogout    = document.getElementById('btnAdminLogout');
  const btnAdd       = document.getElementById('btnAddGlobal');
  const adminPanel   = document.getElementById('adminPanel');

  // ===== Vendég belépés (automatikus 6 szám után) =====
  async function guestLogin() {
    try {
      await signInWithEmailAndPassword(auth, "guest@filmek-anyunak.app", "195400");
    } catch (e) {
      pinError.textContent = "Hibás PIN kód!";
      pinError.style.display = "block";
      guestPin.value = "";
      guestPin.focus();
    }
  }

  if (guestPin) {
    guestPin.addEventListener('input', () => {
      // új inputnál tüntessük el a hibát
      if (pinError.style.display !== "none") pinError.style.display = "none";
      // pontosan 6 karakter → automatikus belépés
      if (guestPin.value.length === 6) guestLogin();
    });
  }

  // ===== Admin űrlap mutatása/elrejtése; mezők kiürítése megnyitáskor =====
  if (btnShowAdmin && adminForm) {
    btnShowAdmin.addEventListener('click', () => {
      adminForm.classList.toggle('show');
      if (adminForm.classList.contains('show')) {
        const emailEl = document.getElementById('adminEmail');
        const passEl  = document.getElementById('adminPass');
        if (emailEl) emailEl.value = "";
        if (passEl)  passEl.value  = "";
        emailEl && emailEl.focus();
      }
    });
  }

  // ===== Admin belépés =====
  if (adminForm) {
    adminForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('adminEmail').value.trim();
      const pass  = document.getElementById('adminPass').value;
      try {
        await signInWithEmailAndPassword(auth, email, pass);
      } catch (e) {
        alert("Hiba: " + (e && e.message ? e.message : e));
      } finally {
        const passEl = document.getElementById('adminPass');
        if (passEl) passEl.value = "";
      }
    });
  }

  // ===== Kijelentkezés (ha van gombod) =====
  if (btnLogout) {
    btnLogout.addEventListener('click', async () => { await signOut(auth); });
  }

  // ===== Auth állapot figyelése =====
  onAuthStateChanged(auth, (u) => {
    const logged  = !!u;
    const isAdmin = logged && u.email === "chisnyan@gmail.com";

    pinView.classList.toggle('hidden', logged);
    if (appView) appView.classList.toggle('hidden', !logged);

    if (btnAdd)     btnAdd.classList.toggle('hidden', !isAdmin);
    if (btnLogout)  btnLogout.classList.toggle('hidden', !logged);
    if (adminPanel) adminPanel.classList.toggle('hidden', !isAdmin);

    if (logged && window.startRealtime) window.startRealtime();
  });
</script>

<!-- ===== [SZAKASZ 5] AUTH – END ===== -->

<!-- ===== [SZAKASZ 6] KATEGÓRIA GOMBSOR – START ===== -->
<!-- A régi „Filmlisták” cím és a kis pill-gombsor TÖRÖLVE.
     Csak a nagy, kártya-stílusú fehér feliratú gombok maradnak. -->
<div class="catsFull" id="cats">
  <button class="cat block" data-cat="akcio">Akció</button>
  <button class="cat block" data-cat="thriller">Thriller</button>
  <button class="cat block" data-cat="krimi">Krimi</button>
  <button class="cat block" data-cat="vigjatek">Vígjáték</button>
  <button class="cat block" data-cat="szineszek">Színészek</button>
</div>
<!-- ===== [SZAKASZ 6] KATEGÓRIA GOMBSOR – END ===== -->

  <!-- ===== [SZAKASZ 7] FIRESTORE SECURITY RULES – CSAK A FIREBASE CONSOLE-BA =====
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Olvasni csak bejelentkezve lehet:
    match /{doc=**} { allow read: if request.auth != null; }

    // Írni/törölni csak az admin emailről:
    match /categories/{cat}/movies/{doc} {
      allow create, update, delete: if request.auth != null
        && request.auth.token.email == "chisnyan@gmail.com";
    }
  }
}
  ===== [SZAKASZ 7] END ===== -->
</body>
</html>
