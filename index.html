<!-- [1 eleje] DOCTYPE + HEAD + ALAP STÍLUSOK -->
<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Filmek Anyunak</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0c1320; --card:#172238; --card2:#121b2f;
      --txt:#dbeafe; --muted:#9fb0ce; --cyan:#22d3ee; --blue:#60a5fa; --green:#10b981; --red:#ef4444; --amber:#f59e0b; --vio:#8b5cf6;
      --ring:#3b82f6;
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--txt);font-family:Inter,system-ui,Segoe UI,Arial,sans-serif;min-height:100vh}
    .container{max-width:1200px;margin:0 auto;padding:24px}
    h1{font-size:40px;margin:0 0 24px 0;color:#9ee3ff;font-weight:800}
    .grid{display:grid;gap:18px}
    .grid.cols-3{grid-template-columns:repeat(3,1fr)}
    .btn{border:0;border-radius:14px;padding:16px 22px;font-weight:800;cursor:pointer;color:#0b1220;background:#7dd3fc;box-shadow:0 6px 20px rgba(125,211,252,.2)}
    .btn.secondary{background:#334155;color:#e2e8f0}
    .btn.red{background:var(--red);color:#fff}
    .btn.green{background:var(--green);color:#032016}
    .btn.vio{background:var(--vio);color:#fff}
    .btn.small{padding:10px 14px;border-radius:999px;font-weight:700}
    .badge{display:inline-flex;gap:6px;align-items:center;border-radius:999px;background:#0f172a;color:#cbd5e1;padding:4px 10px;font-size:12px}
    .card{background:var(--card);border:1px solid #1f2a44;border-radius:var(--radius);padding:22px}
    .tile{background:var(--card2);border:1px solid #1a2640;border-radius:20px;min-height:102px;display:flex;align-items:center;justify-content:center;font-size:24px;font-weight:700;cursor:pointer;transition:transform .12s ease, background .12s ease}
    .tile:hover{transform:translateY(-2px);background:#182542}
    .tile .counts{position:absolute;left:18px;bottom:12px;display:flex;gap:8px}
    .row{display:flex;gap:14px;align-items:center}
    .right{margin-left:auto}
    .muted{color:var(--muted)}
    .hidden{display:none !important}
    .sticky-top{position:sticky;top:0;z-index:40;background:linear-gradient(180deg,rgba(12,19,32,.98),rgba(12,19,32,.9));backdrop-filter:blur(8px);padding:16px 0 12px 0}
    .list{display:grid;gap:12px}
    .item{display:flex;gap:14px;background:var(--card2);border:1px solid #253250;border-radius:16px;padding:12px;align-items:center}
    .item img{width:128px;height:80px;object-fit:cover;border-radius:10px;border:1px solid #304066;flex:0 0 auto}
    .item .meta{display:flex;flex-direction:column;gap:6px;min-width:0}
    .item .title{font-weight:800;font-size:18px;color:#e6f2ff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .item .sub{font-size:12px;color:#94a3b8}
    .item .actions{margin-left:auto;display:flex;gap:8px}
    .pill{display:inline-flex;gap:8px;align-items:center;padding:7px 12px;border-radius:999px;border:1px solid #2a3a5c;background:#0e172a;color:#cbd5e1;font-weight:700}
    .topbar{display:flex;gap:12px;align-items:center}
    .topbar h2{font-size:28px;margin:0 10px 0 0;color:#bfe9ff;font-weight:800}
    .sticky-right{position:sticky;top:16px;margin-left:auto}
    .float-add{position:fixed;right:22px;bottom:22px;z-index:50}
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;z-index:70}
    .modal{background:#0f172a;border:1px solid #223459;border-radius:18px;max-width:560px;width:92vw;padding:20px}
    .modal h3{margin:0 0 14px 0;font-size:22px}
    .field{display:flex;flex-direction:column;gap:8px;margin-bottom:12px}
    .field input,.field select,.field textarea{background:#0b1222;border:1px solid #24324f;color:#eaf2ff;border-radius:12px;padding:12px 14px;outline:0}
    .field input:focus,.field textarea:focus,.field select:focus{box-shadow:0 0 0 3px rgba(59,130,246,.4);border-color:#3b82f6}
    .flex{display:flex;gap:10px;align-items:center}
    .center{display:flex;align-items:center;justify-content:center}
    .pin-wrap{max-width:760px;width:92vw;padding:28px;border-radius:22px;background:linear-gradient(180deg,#101a2c 0%, #0c1426 100%);border:1px solid #1c2b48;box-shadow:0 30px 100px rgba(0,0,0,.35)}
    .pin-dots{display:flex;gap:16px;justify-content:center;align-items:center;height:64px;border:2px solid #cfe2ff;border-radius:16px;background:#0f172a}
    .dot{width:10px;height:10px;border-radius:999px;background:#293751}
    .dot.filled{background:#9fb9ff}
    .video-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:90}
    .video-modal{width:min(92vw,980px);aspect-ratio:16/9;background:#000;border-radius:12px;overflow:hidden;border:1px solid #1e293b}
    .top-right-fixed{position:fixed;right:22px;top:18px;z-index:60}
    @media (max-width:960px){.grid.cols-3{grid-template-columns:1fr}}
  </style>
</head>
<!-- [1 vége] -->
<body>
<!-- [2.2] – Vendég/Admin belépő overlay (HTML+CSS) -->
<style>
  /* Belépő overlay */
  #gateOverlay{
    position:fixed; inset:0; z-index:9999; display:flex; align-items:center; justify-content:center;
    background:#0b1320;
  }
  .gate-card{
    width:min(980px,92vw); border-radius:28px; background:#111a2b; padding:28px 22px 34px;
    box-shadow:0 10px 60px rgba(0,0,0,.45), 0 0 0 1px rgba(255,255,255,.05) inset;
  }
  .gate-row{display:flex; justify-content:center; gap:14px; margin-top:10px;}
  .pin-input{
    width:100%; height:84px; border-radius:22px; border:2px solid #b7caf8;
    outline:none; background:#0f192a; color:#cfe3ff; font-size:28px; text-align:center;
    caret-color:#74b4ff;
  }
  .pin-input::placeholder{color:#7f91b2; opacity:.95;}
  .gate-actions{display:flex; align-items:center; justify-content:center; gap:16px; margin-top:18px;}
  .btn{
    border:none; border-radius:18px; padding:14px 22px; font-weight:700; cursor:pointer;
  }
  .btn-admin{
    width:78px; height:78px; border-radius:20px; background:#7b55f5; color:#fff; font-size:32px;
    display:flex; align-items:center; justify-content:center; box-shadow:0 10px 30px rgba(123,85,245,.35);
  }

  /* Admin modal */
  #adminModal{position:fixed; inset:0; z-index:10000; background:rgba(0,0,0,.6); display:none; align-items:center; justify-content:center;}
  .admin-card{
    width:min(980px,92vw); border-radius:28px; background:#111a2b; padding:28px 22px 34px;
    box-shadow:0 10px 60px rgba(0,0,0,.45), 0 0 0 1px rgba(255,255,255,.05) inset;
  }
  .admin-title{font-size:38px; font-weight:800; color:#cfe3ff; margin:4px 0 22px;}
  .admin-field{display:flex; flex-direction:column; gap:10px; margin:16px 0;}
  .admin-input{
    height:66px; border-radius:16px; border:2px solid #b7caf8; outline:none; background:#0f192a; color:#cfe3ff;
    font-size:20px; padding:0 16px;
  }
  .admin-actions{display:flex; gap:16px; margin-top:8px;}
  .btn-ok{background:#10b981; color:#031821;}
  .btn-cancel{background:#334155; color:#cfe3ff;}
  .admin-error{color:#ff7676; font-weight:700; margin-left:12px;}
</style>

<div id="gateOverlay" aria-hidden="false">
  <div class="gate-card">
    <!-- Címek NEM jelennek meg, csak a mező + Admin -->
    <div class="gate-row">
      <input id="guestPin"
             class="pin-input"
             type="tel"
             inputmode="numeric"
             pattern="[0-9]*"
             maxlength="4"
             placeholder="érints ide és add a PINt!" />
    </div>

    <div class="gate-actions">
      <!-- NINCS belépés gomb a vendégnek, csak Admin gomb -->
      <button id="openAdmin" class="btn btn-admin" title="Admin">A</button>
    </div>
  </div>
</div>

<!-- Admin modal -->
<div id="adminModal">
  <div class="admin-card">
    <div class="admin-title">Admin bejelentkezés</div>

    <div class="admin-field">
      <label for="adminEmail" style="color:#9fb3d9;font-weight:700;">Email</label>
      <input id="adminEmail" class="admin-input" type="email" autocomplete="username" value="chisnyan@gmail.com" />
    </div>

    <div class="admin-field">
      <label for="adminPass" style="color:#9fb3d9;font-weight:700;">Jelszó</label>
      <input id="adminPass" class="admin-input" type="password" autocomplete="current-password" value="C10201443ccc" />
    </div>

    <div class="admin-actions">
      <button id="adminLoginBtn" class="btn btn-ok">Belépés</button>
      <button id="adminCancelBtn" class="btn btn-cancel">Mégse</button>
      <span id="adminErr" class="admin-error" aria-live="polite"></span>
    </div>
  </div>
</div>
<!-- [/2.2] -->

<!-- [3 eleje] FŐOLDAL + KATEGÓRIA OLDAL + STICKY VISSZA -->
<div id="app" class="container hidden">
  <div class="top-right-fixed">
    <span class="badge" id="userBadge">Vendég</span>
    <button class="btn red small" id="btnLogout">Kijelentkezés</button>
  </div>

  <div id="homeView">
    <h1>Filmek Anyunak</h1>
    <div id="catGrid" class="grid cols-3"></div>
    <p class="muted" style="margin-top:18px;">Válassz kategóriát…</p>
  </div>

  <div id="listView" class="hidden">
    <div class="sticky-top">
      <div class="topbar">
        <button class="btn red small" id="btnBack">VISSZA A FŐOLDALRA</button>
        <h2 id="listTitle">Kategória</h2>
        <span class="pill" id="countPill">Összesen: 0</span>
        <span class="pill" id="newPill">ÚJ: 0</span>
        <div class="right">
          <button class="btn small green hidden" id="btnAdd">+ Új film feltöltése (csak admin)</button>
        </div>
      </div>
    </div>
    <div class="list" id="movieList"></div>
  </div>
</div>
<!-- [3 vége] -->

<!-- [4 eleje] FELTÖLTÉS MODÁL + TÖRLÉS MEGERŐSÍTÉS -->
<div id="uploadModal" class="modal-backdrop hidden">
  <div class="modal">
    <h3>Új film feltöltése</h3>
    <div class="field"><label>Kategória</label>
      <select id="fCategory"></select>
    </div>
    <div class="field"><label>Link (YouTube ajánlott)</label>
      <input id="fLink" placeholder="https://www.youtube.com/watch?v=...">
    </div>
    <div class="field"><label>Cím</label>
      <input id="fTitle" placeholder="Automatikus kitöltés a linkből">
    </div>
    <div class="field"><label>Borító kép</label>
      <input id="fPoster" placeholder="Automatikus kitöltés a linkből">
    </div>
    <div class="field"><label>Miről szól?</label>
      <textarea id="fPlot" rows="4" placeholder="Automatikus kitöltés a linkből"></textarea>
    </div>
    <div class="row">
      <button class="btn green" id="btnSaveMovie">Mentés</button>
      <button class="btn secondary" id="btnCancelUpload">Mégse</button>
      <span class="muted" id="uMsg"></span>
    </div>
  </div>
</div>

<div id="deleteModal" class="modal-backdrop hidden">
  <div class="modal">
    <h3 style="color:#fecaca;">Biztos törlöd?</h3>
    <p class="muted">A film végleg törlődik.</p>
    <div class="row">
      <button class="btn red" id="btnDoDelete">Igen, törlöm</button>
      <button class="btn secondary" id="btnCancelDelete">Mégse</button>
    </div>
  </div>
</div>
<!-- [4 vége] -->

<!-- [5.1] – PIN és admin beléptetés (JS) -->
<script>
  // Beállítások
  const GUEST_PIN = "1954";

  // Elemszelektorok
  const gateOverlay = document.getElementById('gateOverlay');
  const guestPinInput = document.getElementById('guestPin');

  const adminModal = document.getElementById('adminModal');
  const openAdminBtn = document.getElementById('openAdmin');
  const adminEmailEl = document.getElementById('adminEmail');
  const adminPassEl  = document.getElementById('adminPass');
  const adminLoginBtn = document.getElementById('adminLoginBtn');
  const adminCancelBtn = document.getElementById('adminCancelBtn');
  const adminErrEl = document.getElementById('adminErr');

  // Állapot
  let isAdmin = false;

  // ========== Vendég PIN: automatikus belépés 4 szám után ==========
  function tryGuestOpen() {
    const v = (guestPinInput.value || '').trim();
    if (v.length === 4) {
      if (v === GUEST_PIN) {
        // Vendég beléptetése – azonnal főoldal
        gateOverlay.style.display = 'none';
        document.body.classList.remove('locked'); // ha volt
        window.dispatchEvent(new CustomEvent('guest-logged-in', { detail: { role:'guest' } }));
      } else {
        guestPinInput.value = '';
        guestPinInput.placeholder = 'Hibás PIN! Próbáld újra…';
        setTimeout(()=> guestPinInput.placeholder = 'érints ide és add a PINt!', 2000);
      }
    }
  }
  guestPinInput.addEventListener('input', tryGuestOpen);
  // Enterre is elfogadjuk (ha valaki mégis megnyomná):
  guestPinInput.addEventListener('keydown', (e)=>{
    if (e.key === 'Enter') tryGuestOpen();
  });

  // ========== Admin overlay nyit/zár ==========
  openAdminBtn.addEventListener('click', () => {
    adminErrEl.textContent = '';
    adminModal.style.display = 'flex';
    setTimeout(()=> adminEmailEl.focus(), 50);
  });
  adminCancelBtn.addEventListener('click', () => {
    adminModal.style.display = 'none';
  });

  // ========== Admin belépés (lokális ellenőrzés + esemény) ==========
  async function handleAdminLogin(){
    adminErrEl.textContent = '';
    const email = (adminEmailEl.value || '').trim();
    const pass  = (adminPassEl.value  || '').trim();

    // Kért fix adatok
    const OK_EMAIL = 'chisnyan@gmail.com';
    const OK_PASS  = 'C10201443ccc';

    if (email === OK_EMAIL && pass === OK_PASS) {
      isAdmin = true;
      adminModal.style.display = 'none';
      gateOverlay.style.display = 'none';
      window.dispatchEvent(new CustomEvent('admin-logged-in', { detail: { role:'admin', email } }));
    } else {
      adminErrEl.textContent = 'Hibás adatok';
    }
  }
  adminLoginBtn.addEventListener('click', handleAdminLogin);
  adminPassEl.addEventListener('keydown', e => {
    if (e.key === 'Enter') handleAdminLogin();
  });

  // Opcionális: első fókusz a PIN-re
  window.addEventListener('load', ()=> guestPinInput && guestPinInput.focus());
</script>
<!-- [/5.1] -->

<!-- [7 eleje] FŐOLDALI KATEGÓRIÁK + SZÁMLÁLÓK -->
<script>
state.movies = load();

function renderHome(){
  $("#homeView").classList.remove("hidden");
  $("#listView").classList.add("hidden");

  const grid = $("#catGrid");
  grid.innerHTML = "";
  CATEGORIES.forEach(cat=>{
    const list = byCat(cat);
    const nNew = newCount(list);
    const nAll = list.length;

    const tile = document.createElement("div");
    tile.className="tile";
    tile.style.position="relative";
    tile.textContent = cat;

    const counts = document.createElement("div");
    counts.className="counts";
    const b1 = document.createElement("span"); b1.className="badge"; b1.innerHTML=`ÚJ: <b>${nNew}</b>`;
    const b2 = document.createElement("span"); b2.className="badge"; b2.innerHTML=`Összesen: <b>${nAll}</b>`;
    counts.appendChild(b1); counts.appendChild(b2);
    tile.appendChild(counts);

    tile.addEventListener("click", ()=> openCategory(cat));
    grid.appendChild(tile);
  });
}
</script>
<!-- [7 vége] -->

<!-- [8 eleje] KATEGÓRIA OLDAL + LISTA + RAGADÓS VISSZA -->
<script>
const listView = $("#listView");
const listEl = $("#movieList");

$("#btnBack").addEventListener("click", ()=>{
  state.currentCategory=null;
  renderHome();
});

function openCategory(cat){
  state.currentCategory = cat;
  $("#homeView").classList.add("hidden");
  listView.classList.remove("hidden");
  $("#listTitle").textContent = cat;
  $("#btnAdd").classList.toggle("hidden", !state.isAdmin);
  $("#fCategory").innerHTML = CATEGORIES.map(c=>`<option ${c===cat?'selected':''}>${c}</option>`).join("");
  renderList();
}

function renderList(){
  const list = byCat(state.currentCategory);
  $("#countPill").textContent = `Összesen: ${list.length}`;
  $("#newPill").textContent = `ÚJ: ${newCount(list)}`;
  listEl.innerHTML = "";
  list.sort((a,b)=> (b.createdAt||0)-(a.createdAt||0)).forEach(m=>{
    const row = document.createElement("div");
    row.className="item";
    const img = document.createElement("img");
    img.src = m.poster || ytThumb(m.link) || "https://placehold.co/256x160/0f172a/64748b?text=No+Poster";
    const meta = document.createElement("div");
    meta.className="meta";
    meta.innerHTML = `<div class="title" title="${escapeHtml(m.title||'')}">${escapeHtml(m.title||'Ismeretlen cím')}</div>
      <div class="sub">${new Date(m.createdAt||Date.now()).toLocaleDateString('hu-HU')} • ${escapeHtml((m.plot||'').slice(0,96))}</div>`;
    const actions = document.createElement("div");
    actions.className="actions";
    const play = document.createElement("button"); play.className="btn small"; play.textContent="Lejátszás";
    play.addEventListener("click", ()=> playMovie(m.link));
    actions.appendChild(play);
    if(state.isAdmin){
      const del = document.createElement("button"); del.className="btn small red"; del.textContent="Törlés";
      del.addEventListener("click", ()=>{ state.deleteId=m.id; $("#deleteModal").classList.remove("hidden"); });
      actions.appendChild(del);
    }
    row.appendChild(img); row.appendChild(meta); row.appendChild(actions);
    listEl.appendChild(row);
  });
}

function playMovie(link){
  const embed = ytEmbed(link);
  if(embed){
    $("#videoBox").innerHTML = `<iframe src="${embed}" width="100%" height="100%" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
    $("#videoModal").classList.remove("hidden");
  } else {
    window.open(link, "_blank");
  }
}
$("#videoModal").addEventListener("click", (e)=>{ if(e.target.id==="videoModal"){ $("#videoModal").classList.add("hidden"); $("#videoBox").innerHTML=""; }});
</script>
<!-- [8 vége] -->

<!-- [9 eleje] FELTÖLTÉS: MODÁL MEGNYITÁS, OEMBED KITÖLTÉS, MENTÉS -->
<script>
$("#btnAdd").addEventListener("click", ()=>{
  $("#uMsg").textContent="";
  $("#fLink").value=""; $("#fTitle").value=""; $("#fPoster").value=""; $("#fPlot").value="";
  $("#uploadModal").classList.remove("hidden");
});
$("#btnCancelUpload").addEventListener("click", ()=> $("#uploadModal").classList.add("hidden"));

$("#fLink").addEventListener("change", autoFillFromLink);
$("#fLink").addEventListener("blur", autoFillFromLink);

async function autoFillFromLink(){
  const url = $("#fLink").value.trim();
  if(!url) return;
  $("#uMsg").textContent="Adatok lekérése…";
  // YouTube oEmbed
  try{
    let title="", poster="", desc="";
    if(/(youtube\.com|youtu\.be)/i.test(url)){
      const res = await fetch(`https://www.youtube.com/oembed?url=${encodeURIComponent(url)}&format=json`);
      if(res.ok){
        const j = await res.json();
        title = j.title || "";
        poster = ytThumb(url);
        // Leírás oEmbed nem ad – kihagyjuk
      } else {
        poster = ytThumb(url);
      }
    }
    $("#fTitle").value = title || $("#fTitle").value;
    $("#fPoster").value = poster || $("#fPoster").value;
    if(!$("#fPoster").value) $("#fPoster").value = "https://placehold.co/600x360/0f172a/93a3b8?text=Poster";
    if(!$("#fPlot").value) $("#fPlot").value = desc || "";
    $("#uMsg").textContent="";
  }catch(e){
    $("#uMsg").textContent="Nem sikerült automatikusan kitölteni.";
  }
}

$("#btnSaveMovie").addEventListener("click", ()=>{
  const cat = $("#fCategory").value;
  const link = $("#fLink").value.trim();
  const title= $("#fTitle").value.trim() || "Ismeretlen cím";
  const poster = $("#fPoster").value.trim() || ytThumb(link);
  const plot = $("#fPlot").value.trim();
  if(!cat || !link){ $("#uMsg").textContent="Kategória és Link szükséges."; return; }
  const rec = { id: uid(), title, link, poster, plot, categories:[cat], createdAt: now() };
  state.movies.push(rec); save();
  $("#uploadModal").classList.add("hidden");
  if(state.currentCategory===cat) renderList(); else renderHome();
});
</script>
<!-- [9 vége] -->

<!-- [10 eleje] TÖRLÉS MEGERŐSÍTÉS -->
<script>
$("#btnCancelDelete").addEventListener("click", ()=> { state.deleteId=null; $("#deleteModal").classList.add("hidden"); });
$("#btnDoDelete").addEventListener("click", ()=>{
  if(!state.deleteId) return;
  state.movies = state.movies.filter(m=>m.id!==state.deleteId);
  save(); state.deleteId=null; $("#deleteModal").classList.add("hidden");
  if(state.currentCategory) renderList(); else renderHome();
});
</script>
<!-- [10 vége] -->

<!-- [11 eleje] KRIMI DEMÓ IMPORT GOMB NÉLKÜL (ELSŐ BETÖLTÉSNÉL HOZZÁADJUK, HA MÉG NINCS) -->
<script>
(function seedOnce(){
  const demoUrl = "https://www.youtube.com/watch?v=lGsmW8nPnpo";
  const exists = state.movies.some(m => m.link===demoUrl);
  if(!exists){
    state.movies.push({
      id: uid(),
      title: "YouTube – Krimi (minta)",
      link: demoUrl,
      poster: ytThumb(demoUrl),
      plot: "Minta krimi film (automatikus import).",
      categories:["Krimi"],
      createdAt: now()
    });
    save();
  }
})();
</script>
<!-- [11 vége] -->

<!-- [12 eleje] ALKALMAZÁS INDÍTÁS -->
<script>
window.addEventListener("load", ()=>{
  renderDots(); // PIN
  // Kategórialisták a feltöltő modálhoz
  $("#fCategory").innerHTML = CATEGORIES.map(c=>`<option ${state.currentCategory===c?'selected':''}>${c}</option>`).join("");
});
</script>
<!-- [12 vége] -->
</body>
</html>
