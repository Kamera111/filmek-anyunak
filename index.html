<!-- =========================
     1. rész eleje – HEAD + ALAP STÍLUSOK
========================== -->
<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Filmek Anyunak</title>

  <style>
    :root { --bg:#0f172a; --card:#111827; --muted:#94a3b8; --txt:#e5e7eb; --accent:#22d3ee; }
    html,body{margin:0;padding:0;background:var(--bg);color:var(--txt);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    .wrap{max-width:980px;margin:0 auto;padding:16px}
    .sticky{position:sticky;top:0;background:linear-gradient(180deg, rgba(15,23,42,.98), rgba(15,23,42,.75) 60%, rgba(15,23,42,0));backdrop-filter: blur(6px);z-index:10}
    header{display:flex;align-items:center;gap:12px;padding:12px 0}
    .title{font-weight:800;font-size:clamp(20px,4.8vw,28px);letter-spacing:.3px}
    .btn{background:#1f2937;color:#fff;border:1px solid #334155;border-radius:12px;padding:10px 14px;cursor:pointer;font-weight:600}
    .btn:active{transform:scale(.98)}
    .btn[hidden]{display:none!important}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px}
    .card{background:var(--card);border:1px solid #1f2937;border-radius:16px;padding:14px}
    .muted{color:var(--muted);font-size:14px}
    input,select,textarea{width:100%;padding:10px;border-radius:12px;border:1px solid #334155;background:#0b1220;color:#e5e7eb}
    label{font-size:13px;color:#b3c1d1;margin-bottom:6px;display:block}
    form .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    img{max-width:100%;border-radius:10px;border:1px solid #1f2937}
    a{color:#a5f3fc;text-decoration:none}
    a:hover{text-decoration:underline}
    .hidden{display:none!important}
    .footer{margin:30px 0 10px;text-align:center;color:#6b7280;font-size:12px}
  </style>
</head>
<!-- =========================
     1. rész vége
========================== -->
<!-- ===== [SZAKASZ 2] VENDÉG PIN + „A” gomb (MINIMAL + HOTFIX, helyesen lezárva) ===== -->
<style>
  #gateOverlay{position:fixed;inset:0;z-index:2147483647;display:none;align-items:center;justify-content:center;background:rgba(6,12,20,.94);backdrop-filter:blur(2px)}
  #gateOverlay.active{display:flex}
  body.gate-active > :not(#gateOverlay){display:none!important}
  #gateBox{width:min(720px,92vw);background:#111827;color:#e5e7eb;border-radius:16px;padding:22px 20px;box-shadow:0 10px 30px rgba(0,0,0,.35);display:flex;flex-direction:column;gap:14px}
  #guestPinInput{width:100%;font-size:32px;padding:18px 20px;border-radius:12px;border:1px solid #374151;background:#0f172a;color:#f9fafb}
  #adminTinyBtn{align-self:flex-start;font-size:22px;font-weight:800;padding:8px 14px;border-radius:999px;border:2px solid #e5e7eb;background:#0b1220;color:#e5e7eb;cursor:pointer}
  #adminMini{display:none;flex-direction:column;gap:12px;margin-top:10px;padding:12px;border:1px solid #334155;border-radius:12px;background:#0b1220}
</style>

<div id="gateOverlay" role="dialog" aria-modal="true">
  <div id="gateBox">
    <div id="gateTitle" style="font-size:28px;font-weight:800">Vendég PIN</div>
    <input id="guestPinInput" type="tel" inputmode="numeric" maxlength="6" autocomplete="one-time-code" placeholder="KATT IDE! ÍRD A KÓDOT" />
    <div id="gateHint" style="color:#9ca3af;font-size:18px">Írd be a 6 számjegyet – <strong>automatikus belépés</strong>.</div>
    <button id="adminTinyBtn" type="button" aria-label="Admin belépés">A</button>
    <div id="adminMini"></div><!-- ÜRES: a 6. szakasz tölti fel email+jelszóval -->
  </div>
</div>

<script>
(function(){
  const PIN="195400", LS_KEY="filmek_anyunak_guest_ok";
  const overlay=document.getElementById("gateOverlay");
  const input=document.getElementById("guestPinInput");

  /* ===== HOTFIX: régi admin űrlap törlése (PIN mező, előtöltött email, pöttyös jelszó) ===== */
  function nukeOldAdmin(){
    const host=document.getElementById('adminMini');
    if(!host) return;
    host.replaceChildren();
    host.removeAttribute('data-ready');
    try{ localStorage.removeItem('admin_email'); }catch{}
  }
  nukeOldAdmin();
  const obs=new MutationObserver(()=>nukeOldAdmin());
  obs.observe(document.documentElement,{subtree:true,childList:true});
  setTimeout(()=>obs.disconnect(),4000);

  /* ===== Vendégkapu ===== */
  function showGate(){
    try{ localStorage.removeItem(LS_KEY);}catch{}
    document.body.classList.add("gate-active");
    overlay.classList.add("active");
    if(input){ input.value=""; setTimeout(()=>input.focus(),50); }
  }
  function hideGate(){
    try{ localStorage.setItem(LS_KEY,"1"); }catch{}
    overlay.classList.remove("active");
    document.body.classList.remove("gate-active");
  }
  function handle(v){
    const norm=String(v||"").replace(/\D+/g,"").slice(0,6);
    if(input && input.value!==norm) input.value=norm;
    if(norm.length===6 && norm===PIN) hideGate();
  }

  /* ===== „A” gomb → 6. szakasz showAdminMini() ===== */
  function wireAGomb(){
    const btn=document.getElementById("adminTinyBtn");
    if(!btn) return;
    const clone=btn.cloneNode(true); btn.replaceWith(clone);
    clone.addEventListener("click",(e)=>{
      e.preventDefault(); e.stopPropagation();
      if(typeof window.showAdminMini==="function"){ window.showAdminMini(); return; }
      const watch=new MutationObserver(()=>{
        if(typeof window.showAdminMini==="function"){ window.showAdminMini(); watch.disconnect(); }
      });
      watch.observe(document.documentElement,{subtree:true,childList:true});
      setTimeout(()=>watch.disconnect(),5000);
    },true);
  }

  document.addEventListener("DOMContentLoaded", ()=>{
    const ok=(()=>{try{return localStorage.getItem(LS_KEY)==="1"}catch{return false}})();
    if(!ok) showGate();

    input?.addEventListener("input",e=>handle(e.target.value));
    input?.addEventListener("keyup",e=>handle(e.target.value));
    input?.addEventListener("paste",e=>{e.preventDefault(); const t=(e.clipboardData||window.clipboardData).getData("text")||""; handle(t);});

    wireAGomb();

    document.getElementById("btnLogoutAll")?.addEventListener("click",()=>{
      try{
        localStorage.removeItem(LS_KEY);
        ["filmek_anyunak_admin_ok","admin_session","admin_email"].forEach(k=>localStorage.removeItem(k));
        sessionStorage.clear();
      }catch{}
      showGate();
    });

    window.addEventListener("storage",(e)=>{
      if(e.key===LS_KEY && e.newValue==="1") hideGate();
    });
  });

  window.showPinGate=showGate;
})();
</script>
<!-- ===== [SZAKASZ 2 VÉGE] ===== -->

<!-- ===== [SZAKASZ 3] FEJLÉC + TOP KATEGÓRIÁK + ÉLŐ RÁCS + NÉZET – START ===== -->
<div id="app" class="wrap">
  <div class="sticky">
    <header>
      <div class="title" style="display:none">Filmek Anyunak</div>
      <div style="margin-left:auto; display:flex; gap:8px;">
        <button id="btnLogoutAll" class="btn btn-danger" title="Kijelentkezés és vissza a PIN-hez">
          Kilépés mindenből
        </button>
        <button class="btn" id="btnRefreshAll">Frissítés</button>
      </div>
    </header>

    <!-- Felső színes kategória-gombok (vendégnek is látszik) -->
    <div id="topFilters" class="top-filters">
      <button class="chip chip-krimi" data-goto="krimi">
        <div class="chip-title">KRIMI</div>
        <div class="chip-sub"><span class="tag">Új:</span><span id="badge-new-krimi">0</span> ·
          <span class="tag">Összes:</span><span id="badge-all-krimi">0</span></div>
      </button>

      <button class="chip chip-akcio" data-goto="akcio">
        <div class="chip-title">AKCIÓ</div>
        <div class="chip-sub"><span class="tag">Új:</span><span id="badge-new-akcio">0</span> ·
          <span class="tag">Összes:</span><span id="badge-all-akcio">0</span></div>
      </button>

      <button class="chip chip-thriller" data-goto="thriller">
        <div class="chip-title">THRILLER</div>
        <div class="chip-sub"><span class="tag">Új:</span><span id="badge-new-thriller">0</span> ·
          <span class="tag">Összes:</span><span id="badge-all-thriller">0</span></div>
      </button>

      <button class="chip chip-actors" data-goto="actors">
        <div class="chip-title">SZÍNÉSZEK</div>
        <div class="chip-sub">20 név (hamarosan)</div>
      </button>
    </div>

    <!-- Élő csatornák rácsa -->
    <div id="catBar">
      <div class="cats-row" id="catsLive"></div>
    </div>
  </div>

  <!-- Dinamikus nézetek ide kerülnek -->
  <main id="view" class="view"></main>
</div>

<style>
  /* Felső színes gombsor */
  .top-filters{
    display:grid; grid-template-columns:repeat(4, minmax(140px,1fr));
    gap:10px; padding: 6px 12px 12px;
  }
  @media (max-width:900px){ .top-filters{ grid-template-columns:repeat(2,1fr); } }
  @media (max-width:520px){ .top-filters{ grid-template-columns:1fr; } }

  .chip{
    display:flex; flex-direction:column; gap:4px;
    padding:12px 14px; border-radius:14px; color:#fff;
    border:1px solid rgba(255,255,255,.16);
    box-shadow:0 4px 14px rgba(0,0,0,.18);
    cursor:pointer; text-align:left;
    transition:transform .08s ease, box-shadow .12s ease, filter .12s ease;
  }
  .chip:hover{ transform:translateY(-1px); box-shadow:0 8px 18px rgba(0,0,0,.22); filter:brightness(1.03); }
  .chip-title{ font-weight:800; letter-spacing:.3px; }
  .chip-sub{ font-size:14px; opacity:.95; }
  .chip-sub .tag{ opacity:.9; }

  .chip-krimi{    background:linear-gradient(180deg,#16a34a,#15803d); }
  .chip-akcio{    background:linear-gradient(180deg,#2563eb,#1e40af); }
  .chip-thriller{ background:linear-gradient(180deg,#e11d48,#be123c); }
  .chip-actors{   background:linear-gradient(180deg,#f59e0b,#b45309); }

  /* Rács + kártyák */
  #catBar { padding: 12px; }
  .cats-row { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px,1fr)); gap: 12px; }

  .cat{
    display:flex; flex-direction:column; align-items:flex-start; justify-content:center;
    padding:14px 16px; border-radius:14px; background:#1f2937; color:#fff; cursor:pointer;
    box-shadow:0 4px 14px rgba(0,0,0,.18); transition:transform .08s ease, box-shadow .12s ease;
    min-height:84px; text-align:left; border:1px solid #0f2437;
  }
  .cat:hover{ transform:translateY(-1px); box-shadow:0 8px 18px rgba(0,0,0,.22); }

  :root{ --name-green:#22c55e; }
  .cat .name{ color:var(--name-green); font-weight:700; font-size:18px; line-height:1.2; margin-bottom:6px; }
  .cat .name .live{ color:#ef4444 !important; font-weight:900; margin-right:4px; } /* ÉLŐ piros */

  .cat .now{ font-size:15px; opacity:.95; white-space:normal; }
  .cat .now .label{ opacity:.9; margin-right:6px; }
  .cat .now .title{ font-size:16px; font-weight:800; } /* Kattints kisebb */
  .btn-danger{ background:#dc2626; border:1px solid #b91c1c; color:#fff; }
  .btn-danger:hover{ filter:brightness(1.05); }
  .btn-back{ margin-bottom:12px; }
</style>

<script>
/* Minimál navigáció a 4 kategóriához – helyőrző nézetekkel */
(function(){
  const viewEl = document.getElementById("view");
  const catBar = document.getElementById("catBar");
  const topBox = document.getElementById("topFilters");

  function goHome(){
    catBar.style.display = "";
    viewEl.innerHTML = "";
    window.scrollTo({top:0, behavior:"smooth"});
  }

  function renderCat(catKey, label){
    catBar.style.display = "none";
    viewEl.innerHTML = `
      <div class="card" style="margin:12px;">
        <button class="btn btn-danger btn-back" id="btnBackHome">Vissza a főoldalra</button>
        <h2 style="margin:4px 0 8px">${label}</h2>
        <div class="muted" style="margin-bottom:10px">Görgess – hamarosan ide töltjük a filmeket…</div>
        <div id="list-${catKey}" class="grid"></div>
      </div>`;
    document.getElementById("btnBackHome").addEventListener("click", goHome);
  }

  function renderActors(){
    catBar.style.display = "none";
    viewEl.innerHTML = `
      <div class="card" style="margin:12px;">
        <button class="btn btn-danger btn-back" id="btnBackHome">Vissza a főoldalra</button>
        <h2 style="margin:4px 0 8px">Színészek</h2>
        <div class="muted" style="margin-bottom:10px">20 név lesz itt – kattintható szűréssel.</div>
        <ul id="actorsList" style="margin:0; padding-left:18px;"></ul>
      </div>`;
    document.getElementById("btnBackHome").addEventListener("click", goHome);
  }

  document.addEventListener("DOMContentLoaded", ()=>{
    topBox?.addEventListener("click", (e)=>{
      const btn = e.target.closest(".chip");
      if(!btn) return;
      const dest = btn.dataset.goto;
      if(dest === "krimi")    renderCat("krimi","KRIMI");
      if(dest === "akcio")    renderCat("akcio","AKCIÓ");
      if(dest === "thriller") renderCat("thriller","THRILLER");
      if(dest === "actors")   renderActors();
      window.scrollTo({top:0, behavior:"smooth"});
    });
  });
})();
</script>
     <!-- ===== [SZAKASZ 3.5] ADMIN FELTÖLTŐ ŰRLAP – auto kitöltés (YouTube/Videa) ===== -->
<style>
  .admin-uploader{margin:12px;padding:14px;border-radius:14px;background:#0e1729;border:1px solid #334155}
  .admin-uploader h3{margin:0 0 8px;font-size:18px}
  .admin-uploader .row{display:grid;grid-template-columns:1fr;gap:8px}
  .admin-uploader label{font-size:12px;color:#9ca3af}
  .admin-uploader input,.admin-uploader textarea{
    width:100%;padding:10px;border-radius:10px;border:1px solid #374151;background:#0f172a;color:#e5e7eb
  }
  .admin-uploader textarea{min-height:110px;resize:vertical}
  .admin-uploader .actions{display:flex;gap:8px;margin-top:8px}
  .admin-uploader .btn{background:#1f2937;border:1px solid #334155;color:#fff;padding:8px 12px;border-radius:10px;cursor:pointer}
  .admin-uploader .btn.primary{background:#2563eb;border-color:#1d4ed8}
  .admin-uploader .muted{color:#9ca3af;font-size:12px}
  .admin-uploader .preview{display:flex;gap:10px;align-items:flex-start}
  .admin-uploader .preview img{width:140px;height:auto;border-radius:8px;border:1px solid #1f2937}
</style>

<script>
(function(){
  const ADMIN_OK_KEY = "filmek_anyunak_admin_ok";

  // ===== Segédek
  const isAdmin = ()=> { try{ return localStorage.getItem(ADMIN_OK_KEY)==="1"; }catch{ return false; } };
  const q = (sel,root=document)=> root.querySelector(sel);

  // proxys HTML letöltés (CORS-biztos)
  async function fetchHtml(url){
    const u = url.startsWith("https://") ? `https://r.jina.ai/${url}` : `https://r.jina.ai/http://${url.replace(/^https?:\/\//,'')}`;
    const r = await fetch(u); if(!r.ok) throw new Error("fetch fail"); return await r.text();
  }
  function meta(text, prop){
    const re = new RegExp(`property=["']${prop}["'][^>]*content=["']([^"']+)["']`,"i");
    const m = text.match(re); return m && m[1] ? m[1] : "";
  }
  function norm(s){ return String(s||"").replace(/\s+/g," ").trim(); }

  // oEmbed (YouTube) – ha elérhető
  async function ytOembed(url){
    try{
      const r = await fetch(`https://www.youtube.com/oembed?format=json&url=${encodeURIComponent(url)}`);
      if(!r.ok) return null;
      const j = await r.json();
      return { title: j.title||"", cover: j.thumbnail_url||"", content: "" };
    }catch{ return null; }
  }

  // Általános meta kinyerés (YouTube, Videa, bármi): og:title / og:image / og:description
  async function genericMeta(url){
    const html = await fetchHtml(url);
    return {
      title: norm(meta(html,"og:title")||""),
      cover: norm(meta(html,"og:image")||""),
      content: norm(meta(html,"og:description")||"")
    };
  }

  async function extractMeta(url){
    const u = String(url||"").trim();
    if(!u) return { title:"", cover:"", content:"" };
    // 1) YouTube oEmbed próba
    if (/youtu\.be|youtube\.com/i.test(u)) {
      const o = await ytOembed(u);
      if (o && o.title) {
        // próbáljuk leírást is (oEmbed nem adja)
        try { const g = await genericMeta(u); if(g.content) o.content = g.content; } catch {}
        return o;
      }
    }
    // 2) generic (YouTube/Videa/egyéb) – OG meta alapján
    return await genericMeta(u);
  }

  // Firestore mentés (ha van)
  async function saveMovie(catKey, data){
    try{
      // ha a projekt már inicializálta: használjuk
      if (window.fb && window.fb.db) {
        const { db, addDoc, collection, serverTimestamp } = window.fb.db;
        await addDoc(collection(db, "categories", catKey, "movies"), {
          ...data,
          createdAt: serverTimestamp ? serverTimestamp() : Date.now()
        });
        return true;
      }
      // dinamikus betöltés (ha van config)
      const appMod  = await import("https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js");
      const fsMod   = await import("https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js");
      let app = null;
      if (appMod.getApps && appMod.getApps().length === 0 && window.firebaseConfig) {
        app = appMod.initializeApp(window.firebaseConfig);
      }
      const db = fsMod.getFirestore(app || (appMod.getApps ? appMod.getApps()[0] : undefined));
      await fsMod.addDoc(fsMod.collection(db, "categories", catKey, "movies"), {
        ...data,
        createdAt: fsMod.serverTimestamp ? fsMod.serverTimestamp() : Date.now()
      });
      return true;
    }catch(e){
      console.warn("Mentés kihagyva (nincs Firestore):", e && e.message ? e.message : e);
      return false;
    }
  }

  // Űrlap létrehozása és bekötése
  function mountUploader(catKey, mountBeforeEl){
    if (!isAdmin()) return;
    if (q(`#admin-uploader-${catKey}`)) return;

    const box = document.createElement("div");
    box.className = "admin-uploader card";
    box.id = `admin-uploader-${catKey}`;
    box.innerHTML = `
      <h3>Új film hozzáadása – ${catKey.toUpperCase()}</h3>
      <div class="row">
        <div>
          <label for="au-link-${catKey}">Link</label>
          <input id="au-link-${catKey}" type="url" placeholder="Illeszd be a YouTube vagy Videa linket" />
          <div class="muted">Beillesztés után automatikusan kitöltjük a mezőket.</div>
        </div>

        <div>
          <label for="au-title-${catKey}">Cím</label>
          <input id="au-title-${catKey}" type="text" placeholder="Automatikusan töltjük…" />
        </div>

        <div>
          <label for="au-cover-${catKey}">Borítókép (URL)</label>
          <input id="au-cover-${catKey}" type="url" placeholder="Automatikusan töltjük…" />
        </div>

        <div>
          <label for="au-content-${catKey}">Tartalom / leírás</label>
          <textarea id="au-content-${catKey}" placeholder="Automatikusan töltjük…"></textarea>
        </div>

        <div class="preview">
          <img id="au-preview-${catKey}" alt="Borító előnézet" src="" onerror="this.style.display='none'">
          <div class="muted">Előnézet: ha van borítókép URL, itt megjelenik.</div>
        </div>

        <div class="actions">
          <button class="btn" id="au-autofill-${catKey}" type="button">Auto kitöltés</button>
          <button class="btn primary" id="au-save-${catKey}" type="button">Mentés</button>
          <button class="btn" id="au-clear-${catKey}" type="button">Mezők törlése</button>
        </div>

        <div class="muted" id="au-msg-${catKey}"></div>
      </div>
    `;

    mountBeforeEl.parentNode.insertBefore(box, mountBeforeEl);

    const el = {
      link:    q(`#au-link-${catKey}`),
      title:   q(`#au-title-${catKey}`),
      cover:   q(`#au-cover-${catKey}`),
      content: q(`#au-content-${catKey}`),
      prev:    q(`#au-preview-${catKey}`),
      msg:     q(`#au-msg-${catKey}`),
      btnAuto: q(`#au-autofill-${catKey}`),
      btnSave: q(`#au-save-${catKey}`),
      btnClr:  q(`#au-clear-${catKey}`)
    };

    function showMsg(t){ if(el.msg) el.msg.textContent = t; }
    function refreshPrev(){
      const url = (el.cover?.value||"").trim();
      if (!el.prev) return;
      if (url){ el.prev.src = url; el.prev.style.display = ""; }
      else { el.prev.removeAttribute("src"); el.prev.style.display = "none"; }
    }

    async function doAutofill(){
      const url = (el.link?.value||"").trim();
      if (!url){ showMsg("Előbb illeszd be a linket."); return; }
      showMsg("Meta adatok töltése…");
      try{
        const meta = await extractMeta(url);
        if (meta.title && el.title)   el.title.value   = meta.title;
        if (meta.cover && el.cover)   el.cover.value   = meta.cover;
        if (el.content && meta.content) el.content.value = meta.content;
        refreshPrev();
        showMsg("Kész. Ellenőrizd és mentsd el.");
      }catch(e){
        showMsg("Nem sikerült a meta adatok kinyerése.");
      }
    }

    async function doSave(){
      const data = {
        title:   (el.title?.value||"").trim(),
        link:    (el.link?.value||"").trim(),
        cover:   (el.cover?.value||"").trim(),
        content: (el.content?.value||"").trim()
      };
      if (!data.link){ showMsg("Adj meg linket."); return; }
      if (!data.title){ showMsg("Adj meg címet (vagy katt az Auto kitöltésre)."); return; }

      showMsg("Mentés…");
      const ok = await saveMovie(catKey, data);
      if (ok){
        showMsg("Elmentve.");
        // ürítés
        ["title","link","cover","content"].forEach(k=> el[k] && (el[k].value=""));
        refreshPrev();
      }else{
        showMsg("Mentés kihagyva (nincs Firestore beállítva). A bejegyzést a konzolba írtuk.");
        console.log("DEMO mentés:", catKey, data);
      }
    }

    // események
    el.btnAuto?.addEventListener("click", doAutofill);
    el.link?.addEventListener("paste", ()=> setTimeout(doAutofill, 50));
    el.link?.addEventListener("change", doAutofill);
    el.cover?.addEventListener("input", refreshPrev);
    el.btnClr?.addEventListener("click", ()=>{
      ["title","link","cover","content"].forEach(k=> el[k] && (el[k].value=""));
      refreshPrev(); showMsg("");
    });
    el.btnSave?.addEventListener("click", doSave);
  }

  // Figyeljük, mikor nyílik meg bármelyik kategória-nézet (list-<catKey>)
  function tryMount(){
    if (!isAdmin()) return;
    const list = q('#view [id^="list-"]');
    if (!list) return;
    const id = list.id;            // pl. list-krimi
    const catKey = id.replace(/^list-/,''); // krimi
    if (!catKey) return;
    // űrlap a list kártyája ELÉ
    mountUploader(catKey, list);
  }

  const mo = new MutationObserver(()=> tryMount());
  mo.observe(document.getElementById("view"), { childList:true, subtree:true });
  document.addEventListener("DOMContentLoaded", tryMount);
})();
</script>
<!-- ===== [SZAKASZ 3.5 VÉGE] ===== -->

<!-- ===== [SZAKASZ 3] FEJLÉC + TOP KATEGÓRIÁK + ÉLŐ RÁCS + NÉZET – END ===== -->

<!-- ===== [SZAKASZ 4] STÍLUS – START ===== -->
<style>
  /* alap rejtések */
  h1, h2 { display:none !important; }

  /* rács – élő kártyák */
  #catBar { padding: 12px; }
  .cats-row { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px,1fr)); gap: 12px; }

  /* kártya */
  .cat{
    display:flex; flex-direction:column; align-items:flex-start; justify-content:center;
    padding:14px 16px; border-radius:14px; background:#1f2937; color:#fff; cursor:pointer;
    box-shadow:0 4px 14px rgba(0,0,0,.18); transition:transform .08s ease, box-shadow .12s ease;
    min-height:84px; text-align:left; border:1px solid #0f2437;
  }
  .cat:hover{ transform:translateY(-1px); box-shadow:0 8px 18px rgba(0,0,0,.22); }

  /* csatorna név – zöld */
  :root{ --name-green:#22c55e; }
  .cat .name{ color:var(--name-green); font-weight:700; font-size:18px; line-height:1.2; margin-bottom:6px; }

  /* a névben az „ÉLŐ” legyen piros (ha span.live) */
  .cat .name .live{ color:#ef4444 !important; font-weight:900; margin-right:4px; }

  /* „Most megy” sor és a „Kattints” */
  .cat .now{ font-size:15px; opacity:.95; white-space:normal; }
  .cat .now .label{ opacity:.9; margin-right:6px; }
  .cat .now .title{ font-size:16px; font-weight:800; }  /* KISEBB „Kattints” */

  /* felső piros gomb (kilépés) */
  .btn-danger{ background:#dc2626; border:1px solid #b91c1c; color:#fff; }
  .btn-danger:hover{ filter:brightness(1.05); }

  /* TOP színes gombok */
  .top-filters{
    display:grid; grid-template-columns:repeat(4, minmax(140px,1fr));
    gap:10px; padding: 6px 12px 12px;
  }
  @media (max-width:900px){ .top-filters{ grid-template-columns:repeat(2,1fr); } }
  @media (max-width:520px){ .top-filters{ grid-template-columns:1fr; } }

  .chip{
    display:flex; flex-direction:column; gap:4px;
    padding:12px 14px; border-radius:14px; color:#fff;
    border:1px solid rgba(255,255,255,.16);
    box-shadow:0 4px 14px rgba(0,0,0,.18);
    cursor:pointer; text-align:left;
    transition:transform .08s ease, box-shadow .12s ease, filter .12s ease;
  }
  .chip:hover{ transform:translateY(-1px); box-shadow:0 8px 18px rgba(0,0,0,.22); filter:brightness(1.03); }
  .chip-title{ font-weight:800; letter-spacing:.3px; }
  .chip-sub{ font-size:14px; opacity:.95; }
  .chip-sub .tag{ opacity:.9; }

  .chip-krimi{    background:linear-gradient(180deg,#16a34a,#15803d); }
  .chip-akcio{    background:linear-gradient(180deg,#2563eb,#1e40af); }
  .chip-thriller{ background:linear-gradient(180deg,#e11d48,#be123c); }
  .chip-actors{   background:linear-gradient(180deg,#f59e0b,#b45309); }

  /* vissza gomb a nézetekben */
  .btn-back{ margin-bottom:12px; }
</style>
<!-- ===== [SZAKASZ 4] STÍLUS – END ===== -->

<!-- ===== [SZAKASZ 5] LOGIKA – GOMBOK + CÍM-KINYERÉS – CLEAN ===== -->
<script>
(function(){
  const REFRESH_MS = 5 * 60 * 1000; // 5 perc
  const catsLiveEl = document.getElementById("catsLive");
  const btnRefreshAll = document.getElementById("btnRefreshAll");

  /* ========== Csatornák ========== */
  const channels = [];
  function addChannel({ id, name, url, provider, sweetName }) {
    channels.push({ id, name, url, provider, sweetName });
  }

  // SWEET.TV – 4 csatorna
  addChannel({ id:"live-vigjatek",  name:"ÉLŐ Vígjáték TV", url:"https://sweet.tv/hu/free_tv/2014-comedy-universe-hd", provider:"sweet",   sweetName:"Vígjáték univerzum HD" });
  addChannel({ id:"live-akcio",     name:"ÉLŐ Akció TV",    url:"https://sweet.tv/hu/free_tv/2010-action-zone-hd",     provider:"sweet",   sweetName:"Akció zóna HD" });
  addChannel({ id:"live-thriller",  name:"ÉLŐ Thriller TV", url:"https://sweet.tv/hu/free_tv/2016-thriller-time-hd",    provider:"sweet",   sweetName:"Thriller idő HD" });
  addChannel({ id:"live-top",       name:"ÉLŐ TOP Filmek",  url:"https://sweet.tv/hu/free_tv/2967-top-movies-hd",       provider:"sweet",   sweetName:"Top Filmek HD" });

  // TELEKOM TV GO – 12 csatorna
  addChannel({ id:"tgo-13",  name:"Mozi+ tv",      url:"https://player.telekomtvgo.hu/player/live?channelNumber=13",  provider:"telekom" });
  addChannel({ id:"tgo-15",  name:"Film + tv",     url:"https://player.telekomtvgo.hu/player/live?channelNumber=15",  provider:"telekom" });
  addChannel({ id:"tgo-21",  name:"Prime tv",      url:"https://player.telekomtvgo.hu/player/live?channelNumber=21",  provider:"telekom" });
  addChannel({ id:"tgo-24",  name:"RTL 2 tv",      url:"https://player.telekomtvgo.hu/player/live?channelNumber=24",  provider:"telekom" });
  addChannel({ id:"tgo-28",  name:"FilmCafe tv",   url:"https://player.telekomtvgo.hu/player/live?channelNumber=28",  provider:"telekom" });
  addChannel({ id:"tgo-30",  name:"ozone tv",      url:"https://player.telekomtvgo.hu/player/live?channelNumber=30",  provider:"telekom" });
  addChannel({ id:"tgo-60",  name:"Cool tv",       url:"https://player.telekomtvgo.hu/player/live?channelNumber=60",  provider:"telekom" });
  addChannel({ id:"tgo-61",  name:"AXN tv",        url:"https://player.telekomtvgo.hu/player/live?channelNumber=61",  provider:"telekom" });
  addChannel({ id:"tgo-62",  name:"AMC tv",        url:"https://player.telekomtvgo.hu/player/live?channelNumber=62",  provider:"telekom" });
  addChannel({ id:"tgo-66",  name:"Paramount tv",  url:"https://player.telekomtvgo.hu/player/live?channelNumber=66",  provider:"telekom" });
  addChannel({ id:"tgo-163", name:"FilmMánia tv",  url:"https://player.telekomtvgo.hu/player/live?channelNumber=163", provider:"telekom" });
  addChannel({ id:"tgo-169", name:"Moziverzum tv", url:"https://player.telekomtvgo.hu/player/live?channelNumber=169", provider:"telekom" });

  /* ========== Segédfüggvények ========== */
  function channelHref(ch){
    if (ch.provider === "sweet") {
      // közvetlen Sweet.TV login -> visszairányítás a csatornára
      const next = encodeURIComponent(ch.url);
      return `https://sweet.tv/hu/login?next=${next}`;
    }
    // Telekomnál közvetlen lejátszó
    return ch.url;
  }

  function renderButtons() {
    if (!catsLiveEl) return;
    catsLiveEl.innerHTML = "";
    for (const ch of channels) {
      // LINK-ként rajzoljuk ki, hogy biztosan megnyíljon új fülön
      const a = document.createElement("a");
      a.className = "cat";
      a.href = channelHref(ch);
      a.target = "_blank";
      a.rel = "noopener"; // biztonság

      // „ÉLŐ” pirossal a név elején
      const safeName = escapeHtml(ch.name).replace(
        /^ÉLŐ(\s+)/,
        '<span class="live">ÉLŐ</span>$1'
      );

      a.innerHTML = `
        <div class="name">${safeName}</div>
        <div class="now">
          <span class="label">Most megy:</span>
          <span class="title" id="now-${ch.id}">Kattints</span>
        </div>
      `;
      catsLiveEl.appendChild(a);
    }
  }

  async function refreshAll() { await Promise.all(channels.map(updateOne)); }

  async function updateOne(ch) {
    const out = document.getElementById(`now-${ch.id}`);
    if (!out) return;
    try {
      let title = null;
      if (ch.provider === "sweet") {
        title = await sweetFromChannel(ch.url, ch.sweetName);
        if (!title) {
          const html = await fetchHtml("https://sweet.tv/hu/free_tv");
          title = findNear(html, ch.sweetName);
        }
      } else {
        title = await telekomFromPlayer(ch.url);
      }
      out.textContent = title ? cleanTitle(title) : "Kattints";
    } catch {
      out.textContent = "Kattints";
    }
  }

  /* ========== SWEET.TV ========== */
  async function sweetFromChannel(url, sweetName) {
    const html = await fetchHtml(url);
    let t = sweetName ? findNear(html, sweetName) : null;
    if (t) return t;
    t = matchJsonNowTitle(html);
    if (t) return t;
    t = matchTitle(html) || matchOg(html, "og:description") || matchOg(html, "og:title");
    return t || null;
  }

  /* ========== TELEKOM TV GO (heurisztika) ========== */
  async function telekomFromPlayer(url) {
    const html = await fetchHtml(url);
    let t = matchTitle(html);
    if (t && looksLikeTitle(t)) return t;
    t = matchOg(html, "og:description") || matchOg(html, "og:title");
    if (t && looksLikeTitle(t)) return t;
    const m1 = html.match(/"currentProgram"[^{}]*\{[^{}]*"title"\s*:\s*"([^"]{2,120})"/i);
    if (m1 && m1[1]) return m1[1];
    const m2 = html.match(/"(now|program|epg)"[^{}]*\{[^{}]*"title"\s*:\s*"([^"]{2,120})"/i);
    if (m2 && m2[2]) return m2[2];
    const texts = (html.match(/>([^<>]{1,160})</g) || [])
      .map(s => s.replace(/[<>]/g,"").trim())
      .map(s => s.replace(/\s+/g," ").trim()).filter(Boolean);
    for (const x of texts) { if (looksLikeTitle(x)) return x; }
    return null;
  }

  /* ========== HTML letöltés proxy-n keresztül ========== */
  async function fetchHtml(url) {
    const proxied = url.startsWith("https://")
      ? `https://r.jina.ai/${url}`
      : `https://r.jina.ai/http://${url.replace(/^https?:\/\//,'')}`;
    const res = await fetch(proxied, { method: "GET" });
    if (!res.ok) throw new Error("fetch failed");
    return await res.text();
  }

  /* ========== Parszoló segédek ========== */
  function matchTitle(text) { const m = text.match(/<title[^>]*>([\s\S]*?)<\/title>/i); return m && m[1] ? m[1] : null; }
  function matchOg(text, prop) {
    const re = new RegExp(`property=["']${prop}["'][^>]*content=["']([^"']+)["']`,"i");
    const m = text.match(re); return m && m[1] ? m[1] : null;
  }
  function matchJsonNowTitle(text) {
    const m1 = text.match(/"now"[^{}]*\{[^{}]*"title"\s*:\s*"([^"]{2,120})"/i);
    if (m1 && m1[1]) return m1[1];
    const m2 = text.match(/"(current|program|epg)"[^{}]*\{[^{}]*"title"\s*:\s*"([^"]{2,120})"/i);
    return (m2 && m2[2]) ? m2[2] : null;
  }
  function findNear(html, sweetName) {
    if (!sweetName) return null;
    const idx = html.search(new RegExp(escapeRegex(sweetName), "i"));
    if (idx < 0) return null;
    const slice = html.slice(idx, Math.min(html.length, idx + 2600));
    const texts = (slice.match(/>([^<>]{1,160})</g) || [])
      .map(s => s.replace(/[<>]/g,"").trim())
      .map(s => s.replace(/\s+/g," ").trim())
      .filter(Boolean);
    const nameNorm = normalizeKey(sweetName);
    const badRe = /^(HD|Full\s*HD|TV|Live|Új|Összes|Bejelentkezés|Regisztráció|Profil|Kategóriák)$/i;
    const candidates = texts
      .filter(t => normalizeKey(t) !== nameNorm)
      .filter(t => !badRe.test(t))
      .filter(t => t.length >= 2 && t.length <= 120);
    for (const t of candidates) { if (looksLikeTitle(t)) return t; }
    return null;
  }
  function looksLikeTitle(t) {
    if (!t) return false;
    if (t.length < 3) return false;
    if (/^\d{1,2}:\d{2}$/.test(t)) return false;
    if (/^HD$/i.test(t)) return false;
    if (/^\w{1,3}$/.test(t)) return false;
    return true;
  }
  function cleanTitle(t) {
    return String(t)
      .replace(/\s+\|\s*Sweet\.?TV.*$/i, "")
      .replace(/ - Sweet\.?TV.*$/i, "")
      .replace(/\s+—\s+.*$/,"")
      .replace(/\s*\|\s*HD\s*$/i,"")
      .replace(/\s+/g," ").trim();
  }
  function escapeHtml(str) {
    return String(str)
      .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
      .replaceAll('"',"&quot;").replaceAll("'","&#39;");
  }
  function escapeRegex(s){ return String(s).replace(/[.*+?^${}()|[\]\\]/g,"\\$&"); }
  function normalizeKey(s){
    return String(s).toLowerCase()
      .normalize("NFD").replace(/[\u0300-\u036f]/g,"")
      .replace(/\s+/g," ").trim();
  }

  /* ========== Init ========== */
  document.addEventListener("DOMContentLoaded", () => {
    renderButtons();
    refreshAll();
    btnRefreshAll?.addEventListener("click", refreshAll);
    setInterval(refreshAll, REFRESH_MS);
  });
})();
</script>
<!-- ===== [SZAKASZ 5] VÉGE ===== -->
<!-- ===== [SZAKASZ 6] ADMIN BELÉPŐ – „A” GOMB (email + jelszó, üresen; Firebase opcionális) ===== -->
<style>
  #adminMini{
    display:none; flex-direction:column; gap:12px; margin-top:10px;
    padding:12px; border:1px solid #334155; border-radius:12px; background:#0b1220;
  }
  #adminMini label{ font-size:12px; color:#9ca3af; }
  #adminMini input{
    width:100%; padding:10px; border-radius:10px; border:1px solid #374151;
    background:#0f172a; color:#e5e7eb;
  }
  #adminMini .row{ display:flex; gap:8px; }
  #adminMini .btn{
    background:#1f2937; border:1px solid #334155; color:#fff;
    padding:8px 12px; border-radius:10px; cursor:pointer;
  }
  #adminMini .btn.primary{ background:#2563eb; border-color:#1d4ed8; }
  #adminMini .btn:active{ transform:scale(.98); }
  #adminMini .err{ color:#fca5a5; font-size:12px; min-height:16px; }
</style>

<script>
(function(){
  function buildAdminMiniOnce(){
    const host = document.getElementById("adminMini");
    if (!host || host.dataset.ready === "1") return;
    host.dataset.ready = "1";

    host.innerHTML = `
      <div class="err" id="adminMiniErr"></div>

      <div>
        <label for="adminMiniEmail">Admin email</label>
        <input id="adminMiniEmail" type="email" inputmode="email" autocomplete="off"
               autocapitalize="none" spellcheck="false" value="" />
      </div>

      <div>
        <label for="adminMiniPass">Jelszó</label>
        <input id="adminMiniPass" type="text" autocomplete="off" value="" />
      </div>

      <div class="row">
        <button class="btn" id="adminMiniCancel" type="button">Mégse</button>
        <button class="btn primary" id="adminMiniLogin" type="button">Belépés</button>
      </div>
    `;

    document.getElementById("adminMiniCancel")?.addEventListener("click", hideAdminMini);
    document.getElementById("adminMiniLogin")?.addEventListener("click", doAdminLogin);
    document.getElementById("adminMiniPass")?.addEventListener("keyup",(e)=>{ if(e.key==="Enter") doAdminLogin(); });
  }

  function showAdminMini(){
    buildAdminMiniOnce();
    const box = document.getElementById("adminMini");
    if (!box) return;
    box.style.display = "flex";
    const err = document.getElementById("adminMiniErr");
    if (err) err.textContent = "";
    const email = document.getElementById("adminMiniEmail");
    const pass  = document.getElementById("adminMiniPass");
    if (email) email.value = "";
    if (pass)  pass.value = "";
    email?.focus();
  }

  function hideAdminMini(){
    const box  = document.getElementById("adminMini");
    const email= document.getElementById("adminMiniEmail");
    const pass = document.getElementById("adminMiniPass");
    if (email) email.value = "";
    if (pass)  pass.value = "";
    if (box)   box.style.display = "none";
  }

  async function doAdminLogin(){
    const email = (document.getElementById("adminMiniEmail")?.value || "").trim();
    const pass  = (document.getElementById("adminMiniPass") ?.value || "").trim();
    const errEl = document.getElementById("adminMiniErr");

    if (!email || !pass){
      if (errEl) errEl.textContent = "Írd be az emailt és a jelszót.";
      return;
    }

    // ===== Firebase-belépés (opcionális) =====
    let ok = false;
    try{
      let auth = null;

      // 1) Ha a projekt már inicializálta a Firebase-t, használd azt
      if (window.fb && window.fb.auth) {
        auth = window.fb.auth;
      } else {
        // 2) Próbálj dinamikusan betölteni mindent. Ha nincs firebaseConfig, akkor demó mód.
        const appMod  = await import("https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js");
        const authMod = await import("https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js");

        if (appMod && appMod.getApps && appMod.getApps().length === 0 && window.firebaseConfig) {
          appMod.initializeApp(window.firebaseConfig);
        }
        try { auth = authMod.getAuth(); } catch { auth = null; }

        if (auth) {
          await authMod.signInWithEmailAndPassword(auth, email, pass);
        }
      }

      // Ha idáig eljutottunk: vagy sikeres Firebase login, vagy nincs Firebase -> demó OK
      ok = true;
    }catch(e){
      // Ha konkrét Firebase hiba volt és tényleg kellene Firebase, ezt ide írhatod ki:
      ok = false;
      if (errEl) errEl.textContent = "Sikertelen belépés. Hibás adatok, vagy nincs Firebase beállítva.";
    }

    if (ok){
      try{
        localStorage.setItem("filmek_anyunak_guest_ok","1");
        localStorage.setItem("filmek_anyunak_admin_ok","1");
        localStorage.setItem("admin_email", email);
      }catch{}

      document.getElementById("gateOverlay")?.classList.remove("active");
      document.body.classList.remove("gate-active");
      hideAdminMini();
    }
  }

  function wireAGomb(){
    const btn = document.getElementById("adminTinyBtn");
    if (!btn) return;
    const clone = btn.cloneNode(true); btn.replaceWith(clone);
    clone.addEventListener("click",(ev)=>{
      ev.preventDefault(); ev.stopPropagation();
      showAdminMini();
    }, true);
  }

  // publikus, hogy a 2. szakasz hívhassa
  window.showAdminMini = showAdminMini;

  if (document.readyState === "loading"){
    document.addEventListener("DOMContentLoaded", wireAGomb, { once:true });
  } else {
    wireAGomb();
  }
})();
</script>
<!-- ===== [SZAKASZ 6] VÉGE ===== -->


     
<!-- =========================
     7. rész eleje – BELÉPŐ (vendég PIN + admin gomb/űrlap)
========================== -->

<!-- =========================
     7. rész vége
========================== -->

<!-- =========================
     8. rész eleje – (Megjegyzés) FIRESTORE SECURITY RULES – csak a konzolba
========================== -->
<!--
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Olvasás csak bejelentkezve
    match /{doc=**} { allow read: if request.auth != null; }

    // Írás csak admin emailről
    match /categories/{cat}/movies/{doc} {
      allow create, update, delete: if request.auth != null
        && request.auth.token.email == "chisnyan@gmail.com";
    }
  }
}
-->
<!-- =========================
     8. rész vége
========================== -->

</body>
</html>
