<!-- ===== [SZAKASZ 2] FEJL√âC ‚Äì START ===== -->
<header>
  <h1>üé¨ Filmek</h1>
  <div>
    <button id="btnRefresh" class="secondary">Friss√≠t√©s</button>
    <button id="btnAdd">+ √öj film</button>
  </div>
</header>

<!-- Kateg√≥ria gombok -->
<div style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:14px">
  <button class="secondary cat-btn" data-cat="">Mind</button>
  <button class="secondary cat-btn" data-cat="akcio">Akci√≥</button>
  <button class="secondary cat-btn" data-cat="thriller">Thriller</button>
  <button class="secondary cat-btn" data-cat="krimi">Krimi</button>
  <button class="secondary cat-btn" data-cat="vigjatek">V√≠gj√°t√©k</button>
  <button class="secondary cat-btn" data-cat="__SZINESZEK__">Sz√≠n√©szek</button>
</div>
<!-- ===== [SZAKASZ 2] FEJL√âC ‚Äì END ===== -->
<!-- ===== [SZAKASZ 2] FEJL√âC ‚Äì START ===== -->
<header>
  <h1>üé¨ Filmek</h1>
  <div>
    <button id="btnRefresh" class="secondary">Friss√≠t√©s</button>
    <button id="btnAdd">+ √öj film</button>
  </div>
</header>

<!-- Kateg√≥ria gombok -->
<div style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:14px">
  <button class="secondary cat-btn" data-cat="">Mind</button>
  <button class="secondary cat-btn" data-cat="akcio">Akci√≥</button>
  <button class="secondary cat-btn" data-cat="thriller">Thriller</button>
  <button class="secondary cat-btn" data-cat="krimi">Krimi</button>
  <button class="secondary cat-btn" data-cat="vigjatek">V√≠gj√°t√©k</button>
  <button class="secondary cat-btn" data-cat="__SZINESZEK__">Sz√≠n√©szek</button>
</div>
<!-- ===== [SZAKASZ 2] FEJL√âC ‚Äì END ===== -->
<!-- ===== [SZAKASZ 3] √öJ FILM ≈∞RLAP ‚Äì START ===== -->
<div id="addBox" class="card" hidden>
  <h3 style="margin:0 0 8px">√öj film hozz√°ad√°sa</h3>
  <div class="row">
    <div>
      <label>Lej√°tsz√°si link (el√©g ezt megadni)</label>
      <input id="url" placeholder="https://www.youtube.com/watch?v=..." />
    </div>
    <div>
      <label>Kateg√≥ria</label>
      <select id="category">
        <option value="akcio">Akci√≥</option>
        <option value="krimi">Krimi</option>
        <option value="thriller">Thriller</option>
        <option value="vigjatek">V√≠gj√°t√©k</option>
        <option value="drama">Dr√°ma</option>
        <option value="egyeb" selected>Egy√©b</option>
      </select>
    </div>
  </div>

  <div class="row">
    <div>
      <label>Film c√≠me (automatikus)</label>
      <input id="title" placeholder="Automatikus kit√∂lt√©s‚Ä¶" />
    </div>
    <div>
      <label>PIN (ideiglenes) ‚Äì 1954</label>
      <input id="pin" placeholder="1954" />
    </div>
  </div>

  <label>Sz√≠n√©szek (opcion√°lis, vessz≈ëvel elv√°lasztva)</label>
  <input id="actors" placeholder="pl. Tom Hanks, Meg Ryan" />

  <div class="preview">
    <img id="posterPrev" alt="El≈ën√©zet" src="" />
    <div class="muted" id="autoInfo">Illessz be egy linket ‚Äì automatikus c√≠m √©s bor√≠t√≥.</div>
  </div>

  <div class="actions">
    <button id="save">Ment√©s</button>
    <button class="secondary" id="cancel">M√©gse</button>
  </div>
  <div class="muted" style="margin-top:6px">Automatikus: YouTube biztos, m√°s oldalakon oEmbed alapj√°n pr√≥b√°lkozunk.</div>
</div>
<!-- ===== [SZAKASZ 3] √öJ FILM ≈∞RLAP ‚Äì END ===== -->
<!-- ===== [SZAKASZ 4A] SZ√çN√âSZ LISTA PANEL ‚Äì START ===== -->
<div id="actorsPanel" class="card" hidden>
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
    <h3 style="margin:0">Sz√≠n√©szek</h3>
    <button id="actorsClose" class="secondary">Vissza</button>
  </div>
  <div class="muted" style="margin-bottom:8px">V√°lassz egy sz√≠n√©szt a filmjeihez:</div>
  <div id="actorsList" style="display:flex;flex-wrap:wrap;gap:8px"></div>
</div>
<!-- ===== [SZAKASZ 4A] SZ√çN√âSZ LISTA PANEL ‚Äì END ===== -->
/* ===== [SZAKASZ 8] DOM ELEMEK HIVATKOZ√ÅSA ‚Äì START ===== */
const addBox = document.getElementById('addBox');
const btnAdd = document.getElementById('btnAdd');
const btnRefresh = document.getElementById('btnRefresh');
const saveBtn = document.getElementById('save');
const cancelBtn = document.getElementById('cancel');
const titleEl = document.getElementById('title');
const urlEl = document.getElementById('url');
const catEl = document.getElementById('category');
const pinEl = document.getElementById('pin');
const actorsEl = document.getElementById('actors');
const filterCat = document.getElementById('filterCat');
const searchEl = document.getElementById('search');
const listEl = document.getElementById('list');
const posterPrev = document.getElementById('posterPrev');
const autoInfo = document.getElementById('autoInfo');
const actorsPanel = document.getElementById('actorsPanel');
const actorsList = document.getElementById('actorsList');
const actorsClose = document.getElementById('actorsClose');

/* ===== [SZAKASZ 8] DOM ELEMEK HIVATKOZ√ÅSA ‚Äì END ===== */

/* ===== [SZAKASZ 9] ALAP LOGIKA: GOMBOK + ESEM√âNYEK ‚Äì START ===== */
const ADMIN_PIN = "1954";
btnAdd.onclick = () => { addBox.hidden = !addBox.hidden; };
cancelBtn.onclick = () => { addBox.hidden = true; };
btnRefresh.onclick = () => window.location.reload();

// Kateg√≥ria gombok (k√∂zt√ºk a Sz√≠n√©szek)
document.querySelectorAll('.cat-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const cat = btn.dataset.cat;
    if (cat === '__SZINESZEK__') {
      selectedActor = ""; // t√∂r√∂lj√ºk az esetleges akt√≠v sz√≠n√©szsz≈±r≈ët
      actorsPanel.hidden = false;
      renderActors();     // sz√≠n√©szgombok fel√©p√≠t√©se
      return;
    }
    filterCat.value = cat;
    selectedActor = "";
    render();
  });
});

// Sz√≠n√©szpanel bez√°r√°sa
actorsClose.addEventListener('click', () => {
  actorsPanel.hidden = true;
});
/* ===== [SZAKASZ 9] ALAP LOGIKA: GOMBOK + ESEM√âNYEK ‚Äì END ===== */
/* ===== [SZAKASZ 11] MENT√âS FIRESTORE-BA ‚Äì START ===== */
saveBtn.onclick = async () => {
  if (pinEl.value.trim() !== ADMIN_PIN) {
    alert("Helytelen PIN.");
    return;
  }
  const url = urlEl.value.trim();
  if (!url) { alert("Link k√∂telez≈ë."); return; }

  // meta kieg√©sz√≠t√©s
  let title = titleEl.value.trim();
  let poster = posterPrev.src || "";
  if (!title || !poster) {
    const meta = await extractMeta(url);
    title = title || meta.title || url;
    poster = poster || meta.poster || "";
  }

  const actors = splitActors(actorsEl.value); // <-- √öJ

  try {
    await addDoc(collection(db, "movies"), {
      title, url, poster,
      actors,                          // <-- √öJ mez≈ë (t√∂mb)
      category: catEl.value,
      addedAt: serverTimestamp()
    });
    [titleEl, urlEl, pinEl, actorsEl].forEach(el => el.value = "");
    posterPrev.src = "";
    alert("Mentve ‚úÖ");
  } catch (e) {
    alert("Hiba ment√©s k√∂zben: " + (e?.message || e));
  }
};
/* ===== [SZAKASZ 11] MENT√âS FIRESTORE-BA ‚Äì END ===== */

        /* ===== [SZAKASZ 12] LISTA √âL≈ê FIGYEL√âS + RENDEZ√âS ‚Äì START ===== */
const q = query(collection(db, "movies"), orderBy("addedAt", "desc"));
let lastItems = [];
onSnapshot(q, (snap) => {
  lastItems = [];
  snap.forEach(doc => lastItems.push({ id: doc.id, ...doc.data() }));
  render();
  renderActors(); // <-- √öJ: sz√≠n√©szlista √∫jra√©p√≠t√©se
});
/* ===== [SZAKASZ 12] LISTA √âL≈ê FIGYEL√âS + RENDEZ√âS ‚Äì END ===== */

    /* ===== [SZAKASZ 12] LISTA √âL≈ê FIGYEL√âS + RENDEZ√âS ‚Äì START ===== */
const q = query(collection(db, "movies"), orderBy("addedAt", "desc"));
let lastItems = [];
onSnapshot(q, (snap) => {
  lastItems = [];
  snap.forEach(doc => lastItems.push({ id: doc.id, ...doc.data() }));
  render();
  renderActors(); // <-- √öJ: sz√≠n√©szlista √∫jra√©p√≠t√©se
});
/* ===== [SZAKASZ 12] LISTA √âL≈ê FIGYEL√âS + RENDEZ√âS ‚Äì END ===== */
    /* ===== [SZAKASZ 13] LISTA KIRAJZOL√ÅS + SZ≈∞R√âS/KERES√âS ‚Äì START ===== */
let selectedActor = ""; // <-- √öJ

[filterCat, searchEl].forEach(el => el.addEventListener('input', () => {
  selectedActor = "";          // ha manu√°lisan v√°ltozik kateg./keres√©s, t√∂r√∂lj√ºk a sz√≠n√©sz-sz≈±r≈ët
  render();
}));

function render() {
  const term = searchEl.value.trim().toLowerCase();
  const fc = filterCat.value;

  const filtered = lastItems.filter(x =>
    (!fc || x.category === fc) &&
    (!term || (x.title || "").toLowerCase().includes(term)) &&
    (!selectedActor || (Array.isArray(x.actors) && x.actors.map(a=>a.toLowerCase()).includes(selectedActor.toLowerCase())))
  );

  listEl.innerHTML = "";
  if (!filtered.length) {
    listEl.innerHTML = `<div class="muted">Nincs tal√°lat.</div>`;
    return;
  }
  for (const m of filtered) {
    const when = m.addedAt?.toDate ? m.addedAt.toDate().toLocaleString() : "‚Äî";
    const poster = m.poster ? `<img class="thumb" src="${escapeAttr(m.poster)}" alt="">` : `<div class="thumb"></div>`;
    const actorsLine = (m.actors && m.actors.length) ? `<div class="muted" style="margin-top:6px">Szerepl≈ëk: ${escapeHtml(m.actors.join(", "))}</div>` : "";

    const card = document.createElement("div");
    card.className = "item";
    card.innerHTML = `
      ${poster}
      <div class="inner">
        <div class="title">
          <a href="${escapeAttr(m.url||'#')}" target="_blank" rel="noopener" style="text-decoration:none;color:inherit">
            ${escapeHtml(m.title || "‚Äî")}
          </a>
          <span class="badge">${escapeHtml(m.category || "egy√©b")}</span>
        </div>
        <div class="muted" style="margin:6px 0 10px">${when}</div>
        ${actorsLine}
        <div class="actions">
          <a href="${escapeAttr(m.url||'#')}" target="_blank" rel="noopener"><button>Lej√°tsz√°s / Megnyit√°s</button></a>
        </div>
      </div>
    `;
    listEl.appendChild(card);
  }
}
/* ===== [SZAKASZ 13] LISTA KIRAJZOL√ÅS + SZ≈∞R√âS/KERES√âS ‚Äì END ===== */

  /* ===== [SZAKASZ 16] SZ√çN√âSZLISTA FEL√âP√çT√âSE ‚Äì START ===== */
function renderActors() {
  if (!actorsPanel || !actorsList) return;

  // egyedi, √°b√©c√©sorrendben
  const set = new Set();
  for (const m of lastItems) {
    if (Array.isArray(m.actors)) {
      m.actors.forEach(a => {
        const t = (a||"").trim();
        if (t) set.add(t);
      });
    }
  }

  actorsList.innerHTML = "";
  if (!set.size) {
    actorsList.innerHTML = `<div class="muted">M√©g nincs megadott sz√≠n√©sz. Az ≈±rlapon a ‚ÄûSz√≠n√©szek‚Äù mez≈ëben adhatsz meg neveket.</div>`;
    return;
  }

  [...set].sort((a,b)=>a.localeCompare(b,'hu')).forEach(name => {
    const btn = document.createElement('button');
    btn.className = 'secondary';
    btn.textContent = name;
    btn.addEventListener('click', () => {
      selectedActor = name;
      actorsPanel.hidden = true;
      render();
    });
    actorsList.appendChild(btn);
  });
}

function splitActors(s){
  return (s||"")
    .split(",")
    .map(x=>x.trim())
    .filter(Boolean);
}
/* ===== [SZAKASZ 16] SZ√çN√âSZLISTA FEL√âP√çT√âSE ‚Äì END ===== */
  <!-- ===== [SZAKASZ 17] FIREBASE ‚Äì INIT + AUTH + FIRESTORE ‚Äì START ===== -->
<script type="module">
  /* --- Firebase modulok --- */
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import {
    getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import {
    getFirestore, collection, addDoc, serverTimestamp,
    onSnapshot, query, orderBy
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  /* --- IDE ILLesZD BE A SAJ√ÅT firebaseConfig-ot a konzolb√≥l --- */
  const firebaseConfig = {
    // apiKey: "...",
    // authDomain: "...",
    // projectId: "...",
    // storageBucket: "...",
    // messagingSenderId: "...",
    // appId: "..."
  };

  /* --- Alap inicializ√°l√°s --- */
  const app  = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db   = getFirestore(app);

  /* --- DOM horgonyok (m√°r l√©teznek a lapodon) --- */
  const pinOverlay = document.getElementById('pinOverlay');
  const mainBox    = document.getElementById('mainBox');
  const pinInput   = document.getElementById('pinInput');
  const pinError   = document.getElementById('pinError');
  const uploadBtn  = document.querySelector('.uploadbtn');

  const listBox = document.getElementById('movielistBox');
  const listEl  = document.getElementById('movielinks');
  const titleEl = document.getElementById('movielistTitle');
  const hintEl  = document.getElementById('movielistHint');

  /* --- √Ålland√≥k --- */
  const NEW_DAYS = 7;
  let allMovies = [];

  /* === AUTH √ÅLLAPOT ===
     Admin bejelentkezve ‚Üí Felt√∂lt√©s enged√©lyezett
     Nincs bejelentkezve ‚Üí Csak olvas√°s (felt√∂lt√©s tiltva) */
  onAuthStateChanged(auth, (user) => {
    pinOverlay.style.display = "none";   // olvas√°shoz ne takarja a k√©perny≈ët
    mainBox.style.display    = "";       // f≈ë UI l√°that√≥
    if (uploadBtn) uploadBtn.disabled = !user; // csak adminnak akt√≠v
  });

  /* === ADMIN LOGIN (PIN = jelsz√≥, e-mail fix vagy k√©rhet≈ë) === */
  // Ha van k√ºl√∂n admin e‚Äëmail inputod, haszn√°ld azt; itt egy fix p√©lda:
  const ADMIN_EMAIL = "admin@csabi.app";
  pinOverlay?.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') doLogin();
  });
  document.getElementById('btnPinLogin')?.addEventListener('click', doLogin);

  async function doLogin() {
    pinError.textContent = "";
    const pass = (pinInput?.value || "").trim();
    if (!pass) { pinError.textContent = "√çrd be a PIN-t!"; return; }
    try {
      await signInWithEmailAndPassword(auth, ADMIN_EMAIL, pass);
      pinInput.value = "";
    } catch (err) {
      console.error(err);
      pinError.textContent = "Hib√°s e‚Äëmail vagy PIN!";
    }
  }

  /* === KIJELENTKEZ√âS === */
  window.logout = async () => {
    try { await signOut(auth); } catch(e) { console.error(e); }
    mainBox.style.display = "none";
    pinOverlay.style.display = "";
    pinInput.value = "";
    pinInput.focus();
  };

  /* === FIRESTORE STREAM ‚Äì val√≥s idej≈± lista === */
  const moviesRef = collection(db, "movies");
  const q = query(moviesRef, orderBy("createdAt", "desc"));
  onSnapshot(q, (snap) => {
    allMovies = snap.docs.map(d => ({ id: d.id, ...d.data() }));
    // ha nyitva van egy lista, nem musz√°j azonnal √∫jrarajzolni; k√©r√©sre friss√≠t√ºnk
  });

  /* === LIST√ÅK MEGJELEN√çT√âSE === */
  function renderList(category) {
    listEl.innerHTML = "";
    hintEl.style.display = "none";
    let data = allMovies;

    if (category === "√öj filmek") {
      const cutoff = Date.now() - NEW_DAYS*24*60*60*1000;
      data = allMovies.filter(m => {
        const ts = m.createdAt?.toMillis?.() ?? m.createdAt ?? 0;
        return ts >= cutoff;
      });
      hintEl.style.display = "block";
      hintEl.textContent = `Az elm√∫lt ${NEW_DAYS} napban hozz√°adott filmek.`;
    } else {
      data = allMovies.filter(m => (m.category || "").trim() === category);
    }

    if (!data.length) {
      titleEl.textContent = "Nincs tal√°lat!";
    } else {
      titleEl.textContent = `${category} filmek:`;
      data.forEach(movie => {
        const a = document.createElement('a');
        a.href = movie.url;
        a.target = "_blank";
        a.rel = "noopener";
        a.className = "movielink";
        a.textContent = movie.title;
        listEl.appendChild(a);
      });
    }
    listBox.style.display = "";
    setTimeout(() => listBox.scrollIntoView({ behavior: 'smooth' }), 80);
  }

  /* Glob√°lis h√≠v√°sok ‚Äì a megl√©v≈ë gombjaid ezeket h√≠vj√°k */
  window.showMovies = (category) => {
    hideUploadForm();
    renderList(category);
  };
  window.hideMovies = () => listBox.style.display = "none";

  /* === FELT√ñLT√âS (csak admin) === */
  window.showUploadForm = () => {
    if (!auth.currentUser) { alert("Csak admin t√∂lthet fel. Jelentkezz be!"); return; }
    document.getElementById('uploadBox').style.display = "";
    hideMovies();
  };
  window.hideUploadForm = () => {
    document.getElementById('uploadBox').style.display = "none";
    document.getElementById('uploadError').textContent = "";
  };
  window.addMovie = async (e) => {
    e.preventDefault();
    if (!auth.currentUser) {
      document.getElementById('uploadError').textContent = "Csak admin t√∂lthet fel!";
      return;
    }
    const title = document.getElementById('newTitle').value.trim();
    const url   = document.getElementById('newUrl').value.trim();
    const cat   = document.getElementById('newCategory').value.trim();

    if (!title || !url || !cat) {
      document.getElementById('uploadError').textContent = "Minden mez≈ë k√∂telez≈ë!";
      return;
    }
    if (!/^https?:\/\//i.test(url)) {
      document.getElementById('uploadError').textContent = "A linknek http(s)://-el kell kezd≈ëdnie!";
      return;
    }
    try {
      await addDoc(moviesRef, {
        title, url, category: cat,
        createdAt: serverTimestamp()
      });
      document.getElementById('newTitle').value = "";
      document.getElementById('newUrl').value = "";
      document.getElementById('newCategory').value = "";
      hideUploadForm();
      alert("Film sikeresen hozz√°adva!");
      showMovies(cat);
    } catch (e) {
      console.error(e);
      document.getElementById('uploadError').textContent = "Hiba t√∂rt√©nt ment√©s k√∂zben!";
    }
  };

  /* === Bet√∂lt√©skor: olvas√°s enged√©lyezett, admin login k√ºl√∂n === */
  window.onload = () => {
    pinOverlay.style.display = "none";
    mainBox.style.display = "";
  };
</script>
<!-- ===== [SZAKASZ 17] FIREBASE ‚Äì INIT + AUTH + FIRESTORE ‚Äì END ===== -->

  
