<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Filmek ‚Äì Firebase</title>
  <style>
    :root { color-scheme: dark; }
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#0b1220;color:#e5e7eb}
    .wrap{max-width:760px;margin:24px auto;padding:0 16px}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:16px}
    h1{font-size:1.4rem;margin:0}
    .card{background:#111827;border:1px solid #1f2937;border-radius:14px;padding:14px 16px;box-shadow:0 2px 16px rgba(0,0,0,.25);margin-bottom:14px}
    label{display:block;font-size:.9rem;margin:6px 0 4px}
    input,select{width:100%;padding:10px;border-radius:10px;border:1px solid #334155;background:#0b1220;color:#e5e7eb}
    button{padding:10px 14px;border:0;border-radius:10px;background:#2563eb;color:#fff;font-weight:600}
    button.secondary{background:#374151}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .list{display:grid;gap:10px;margin-top:8px}
    .item{background:#0b1220;border:1px solid #374151;border-radius:12px;padding:12px}
    .title{font-weight:700}
    .muted{color:#94a3b8;font-size:.85rem}
    .badge{display:inline-block;background:#111827;border:1px solid #334155;color:#cbd5e1;border-radius:999px;padding:2px 8px;font-size:.75rem;margin-left:6px}
    a.btnlike{display:inline-block}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>üé¨ Filmek</h1>
      <div>
        <button id="btnRefresh" class="secondary">Friss√≠t√©s</button>
        <button id="btnAdd">+ √öj film</button>
      </div>
    </header>

    <!-- √öj film ≈±rlap -->
    <div id="addBox" class="card" hidden>
      <h3 style="margin:0 0 8px">√öj film hozz√°ad√°sa</h3>
      <div class="row">
        <div>
          <label>Film c√≠me</label>
          <input id="title" placeholder="pl. A sz√∂kev√©ny (1993)" />
        </div>
        <div>
          <label>Kateg√≥ria</label>
          <select id="category">
            <option value="akcio">Akci√≥</option>
            <option value="krimi">Krimi</option>
            <option value="thriller">Thriller</option>
            <option value="vigjatek">V√≠gj√°t√©k</option>
            <option value="drama">Dr√°ma</option>
            <option value="egyeb">Egy√©b</option>
          </select>
        </div>
      </div>
      <label>Lej√°tsz√°si link (YouTube, Videa, stb.)</label>
      <input id="url" placeholder="https://..." />
      <div class="row" style="margin-top:10px">
        <input id="pin" placeholder="PIN (1954)" />
        <button id="save">Ment√©s</button>
      </div>
      <div class="muted" style="margin-top:6px">Csak ideiglenes PIN-v√©delem. K√©s≈ëbb Firebase Auth-ra cser√©lj√ºk.</div>
    </div>

    <!-- Lista + sz≈±r≈ëk -->
    <div class="card">
      <div class="row">
        <div>
          <label>Kateg√≥ria sz≈±r≈ë</label>
          <select id="filterCat">
            <option value="">(Mind)</option>
            <option value="akcio">Akci√≥</option>
            <option value="krimi">Krimi</option>
            <option value="thriller">Thriller</option>
            <option value="vigjatek">V√≠gj√°t√©k</option>
            <option value="drama">Dr√°ma</option>
            <option value="egyeb">Egy√©b</option>
          </select>
        </div>
        <div>
          <label>Keres√©s c√≠mben</label>
          <input id="search" placeholder="pl. Termin√°tor" />
        </div>
      </div>
      <div id="list" class="list"></div>
    </div>
  </div>

  <!-- Firebase + App (ES Modules) -->
  <script type="module">
    // Firebase modulok (12.1.0)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import {
      getFirestore, collection, addDoc, serverTimestamp,
      query, orderBy, onSnapshot
    } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

    // --- SAJ√ÅT FIREBASE CONFIG (t≈ëled)
    const firebaseConfig = {
      apiKey: "AIzaSyD_u1zqJR8zgXiNEMxgecfuPKWq7aR5qOQ",
      authDomain: "filmek-540be.firebaseapp.com",
      projectId: "filmek-540be",
      storageBucket: "filmek-540be.firebasestorage.app",
      messagingSenderId: "711814484581",
      appId: "1:711814484581:web:fd604515dd9f8cb3122c8c",
      measurementId: "G-Y60ED0Q7R8"
    };

    // App + Firestore
    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);

    // --- UI elemek
    const addBox = document.getElementById('addBox');
    const btnAdd = document.getElementById('btnAdd');
    const btnRefresh = document.getElementById('btnRefresh');
    const saveBtn = document.getElementById('save');
    const titleEl = document.getElementById('title');
    const urlEl = document.getElementById('url');
    const catEl = document.getElementById('category');
    const pinEl = document.getElementById('pin');
    const filterCat = document.getElementById('filterCat');
    const searchEl = document.getElementById('search');
    const listEl = document.getElementById('list');

    // --- Egyszer≈± ‚Äûadmin‚Äù PIN
    const ADMIN_PIN = "1954";

    btnAdd.onclick = () => { addBox.hidden = !addBox.hidden; };

    saveBtn.onclick = async () => {
      if (pinEl.value.trim() !== ADMIN_PIN) {
        alert("Helytelen PIN.");
        return;
      }
      const title = titleEl.value.trim();
      const url   = urlEl.value.trim();
      const cat   = catEl.value;

      if (!title || !url) {
        alert("C√≠m √©s link k√∂telez≈ë.");
        return;
      }
      try {
        await addDoc(collection(db, "movies"), {
          title, url, category: cat,
          addedAt: serverTimestamp()
        });
        titleEl.value = ""; urlEl.value = "";
        alert("Mentve ‚úÖ");
      } catch (e) {
        alert("Hiba ment√©s k√∂zben: " + (e?.message || e));
      }
    };

    // --- Lista √©l≈ë figyel√©se
    const q = query(collection(db, "movies"), orderBy("addedAt", "desc"));
    let lastItems = [];
    onSnapshot(q, (snap) => {
      lastItems = [];
      snap.forEach(doc => lastItems.push({ id: doc.id, ...doc.data() }));
      render();
    });

    function render() {
      const term = searchEl.value.trim().toLowerCase();
      const fc = filterCat.value;
      const filtered = lastItems.filter(x =>
        (!fc || x.category === fc) &&
        (!term || (x.title || "").toLowerCase().includes(term))
      );

      listEl.innerHTML = "";
      if (!filtered.length) {
        listEl.innerHTML = `<div class="muted">Nincs tal√°lat.</div>`;
        return;
      }
      for (const m of filtered) {
        const div = document.createElement("div");
        div.className = "item";
        const when = m.addedAt?.toDate ? m.addedAt.toDate().toLocaleString() : "‚Äî";
        div.innerHTML = `
          <div class="title">
            ${escapeHtml(m.title || "‚Äî")}
            <span class="badge">${escapeHtml(m.category || "egy√©b")}</span>
          </div>
          <div class="muted" style="margin:6px 0 10px">${when}</div>
          <div>
            <a class="btnlike" href="${escapeAttr(m.url||'#')}" target="_blank" rel="noopener">
              <button>Lej√°tsz√°s / Megnyit√°s</button>
            </a>
          </div>
        `;
        listEl.appendChild(div);
      }
    }

    function escapeHtml(s){return (s||"").replace(/[&<>"']/g,c=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[c]))}
    function escapeAttr(s){return (s||"").replace(/"/g,'&quot;')}

    // Sz≈±r≈ëk figyel√©se
    [filterCat, searchEl].forEach(el => el.addEventListener('input', render));
    btnRefresh.onclick = () => window.location.reload();
  </script>
</body>
</html>
