<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Filmek Anyunak</title>
  <style>
    :root{
      --bg:#0b1220; --card:#0e1626; --ink:#e9eefc; --muted:#9db0d8;
      --line:#21304d; --green:#16934a; --blue:#2b6df6; --red:#cf2746; --amber:#ef8d12;
      --btn:#1b2740; --btnh:#243355;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:system-ui,Segoe UI,Roboto,Arial; color:var(--ink); background:var(--bg);
    }
    .wrap{max-width:1280px; margin:0 auto; padding:16px}
    h1{margin:8px 0 18px; font-size:42px; font-weight:800}
    h2{margin:14px 0 10px; font-size:22px}
    .row{display:flex; gap:14px; flex-wrap:wrap}
    .pill{
      flex:1 1 260px; min-height:96px; border-radius:18px; padding:16px 18px;
      display:flex; flex-direction:column; justify-content:center; line-height:1.25; box-shadow:0 8px 24px rgba(0,0,0,.18);
      border:1px solid transparent;
    }
    .pill.green{background:linear-gradient(180deg,#1aa756,#117b3e)}
    .pill.blue{background:linear-gradient(180deg,#3976ff,#214ed9)}
    .pill.red{background:linear-gradient(180deg,#e83e5e,#b21733)}
    .pill.amber{background:linear-gradient(180deg,#ffa212,#dd7b00)}
    .pill h3{margin:0 0 10px; font-size:24px; font-weight:800}
    .pill .meta{opacity:.9}
    .topbar{display:flex; gap:10px; align-items:center; margin-left:auto}
    .btn{
      background:var(--btn); border:1px solid var(--line); color:var(--ink); padding:10px 14px; border-radius:12px; cursor:pointer;
    }
    .btn:hover{background:var(--btnh)}
    .btn.danger{background:#a01a33; border-color:#90142b}
    .btn.round{width:44px; height:44px; border-radius:999px; display:inline-flex; align-items:center; justify-content:center; font-weight:800}
    .card{
      background:var(--card); border:1px solid var(--line); border-radius:14px; padding:12px;
    }
    .grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:14px}
    figure.thumb{margin:0 0 8px; height:160px; overflow:hidden; border-radius:10px; background:#0b1220}
    figure.thumb img{width:100%; height:100%; object-fit:cover}
    small.muted{color:var(--muted)}
    /* modálok */
    .mask{
      position:fixed; inset:0; background:rgba(7,12,24,.68);
      display:flex; align-items:center; justify-content:center; z-index:50;
      backdrop-filter: blur(4px);
    }
    .modal{background:var(--card); border:1px solid var(--line); border-radius:16px; padding:18px; width:min(720px,95vw)}
    .f{display:flex; flex-direction:column; gap:10px}
    .inp{
      background:#0b1325; border:1px solid #21304d; color:var(--ink); padding:12px 14px; border-radius:12px; width:100%;
      outline:none;
    }
    .inp::placeholder{color:#8094c7}
    .err{color:#ff6b7d; margin-top:6px}
    /* rejthető szekciók */
    [hidden]{display:none !important}
    .head{display:flex; align-items:center; gap:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="head">
      <h1>Filmek Anyunak</h1>
      <div class="topbar">
        <button id="logoutAll" class="btn danger" hidden>Kilépés mindből</button>
        <button id="btnActors" class="btn amber">SZÍNÉSZEK<br><small class="muted">Galéria és filmek</small></button>
        <button id="btnAdmin" class="btn round">A</button>
        <button id="btnRefresh" class="btn">Frissítés</button>
      </div>
    </div>

    <!-- ============ HOME (alap nézet) ============ -->
    <section id="homeView">
      <div class="row">
        <div class="pill green">
          <h3>KRIMI</h3>
          <div class="meta">Új:<span id="bKrimiNew">0</span> · Összes:<span id="bKrimiAll">0</span></div>
        </div>
        <div class="pill blue">
          <h3>AKCIÓ</h3>
          <div class="meta">Új:<span id="bAkcioNew">0</span> · Összes:<span id="bAkcioAll">0</span></div>
        </div>
        <div class="pill red">
          <h3>THRILLER</h3>
          <div class="meta">Új:<span id="bThrillerNew">0</span> · Összes:<span id="bThrillerAll">0</span></div>
        </div>
        <div class="pill amber">
          <h3>SZÍNÉSZEK</h3>
          <div class="meta">Galéria és filmek</div>
        </div>
      </div>

      <div style="margin:18px 4px 6px; display:flex; align-items:center; gap:10px">
        <h2 style="margin:0">KRIMI</h2>
        <button id="seedKrimiBtn" class="btn" hidden>10 krimi link feltöltése (YouTube)</button>
      </div>
      <div id="krimiList" class="grid"></div>

      <!-- Itt hagyhatsz később külön Akció/Thriller listát is -->
    </section>

    <!-- ============ SZÍNÉSZEK (rejtve indul) ============ -->
    <section id="actorsView" hidden>
      <div style="display:flex;justify-content:space-between;align-items:center;margin:0 0 10px">
        <h2 style="margin:0">Színészek</h2>
        <button id="actorsBackBtn" class="btn">Vissza a főoldalra</button>
      </div>
      <div id="actorsGrid" class="grid"></div>
    </section>
  </div>

  <!-- ============ VENDÉG KAPU (PIN) ============ -->
  <div id="guestGate" class="mask" aria-modal="true" role="dialog" hidden>
    <div class="modal">
      <h2>Vendég kapu</h2>
      <div class="f">
        <label for="pinIn">PIN (6 számjegy)</label>
        <input id="pinIn" class="inp" type="tel" inputmode="numeric" pattern="[0-9]*" maxlength="6"
               placeholder="Kattints! Ide írd a kódot">
        <div class="err" id="pinErr" hidden>Hibás PIN.</div>
        <small class="muted">Írd be a kódot – a nézet automatikusan megnyílik.</small>
      </div>
    </div>
  </div>

  <!-- ============ ADMIN BELÉPÉS ============ -->
  <div id="adminModal" class="mask" aria-modal="true" role="dialog" hidden>
    <div class="modal">
      <h2>Admin belépés</h2>
      <div class="f">
        <label for="admMail">Email</label>
        <input id="admMail" class="inp" type="email" placeholder="admin@email.com" />
        <label for="admPass">Jelszó</label>
        <input id="admPass" class="inp" type="password" placeholder="********" />
        <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:6px">
          <button id="admCancel" class="btn">Mégse</button>
          <button id="admLogin" class="btn">Belépés</button>
        </div>
        <div class="err" id="admErr" hidden></div>
      </div>
    </div>
  </div>

  <!-- ============ FIREBASE ============ -->
  <script type="module">
    // ---- Firebase importok
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import {
      getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut
    } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
    import {
      getFirestore, collection, addDoc, getDocs, serverTimestamp, query
    } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

    // ---- Config (TÖLTSD KI a sajátoddal, vagy hagyd a régi értékeket)
    const firebaseConfig = {
      /* példa:
      apiKey: "xxx",
      authDomain: "xxx.firebaseapp.com",
      projectId: "xxx",
      storageBucket: "xxx.appspot.com",
      messagingSenderId: "123",
      appId: "1:123:web:abc"
      */
    };

    // ---- Init
    const app  = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);

    // Exponáljuk
    window.fb = {
      app, auth, db,
      collection, addDoc, getDocs, serverTimestamp, query,
      signInWithEmailAndPassword, signOut
    };

    // ---- Egységes elemfogók
    const $ = (sel)=>document.querySelector(sel);
    const homeView   = $("#homeView");
    const actorsView = $("#actorsView");
    const btnActors  = $("#btnActors");
    const btnRefresh = $("#btnRefresh");
    const btnAdmin   = $("#btnAdmin");
    const logoutAll  = $("#logoutAll");
    const seedKrimiBtn = $("#seedKrimiBtn");

    const guestGate  = $("#guestGate");
    const pinIn      = $("#pinIn");
    const pinErr     = $("#pinErr");

    const adminModal = $("#adminModal");
    const admMail    = $("#admMail");
    const admPass    = $("#admPass");
    const admErr     = $("#admErr");
    const admLogin   = $("#admLogin");
    const admCancel  = $("#admCancel");

    // jelzők
    const PIN_CODE = "195400";
    const CATS = ["krimi","akcio","thriller"];

    // ===== Vendég-kapu
    function openGate(){ guestGate.hidden = false; pinIn.focus(); }
    function closeGate(){ guestGate.hidden = true; }
    function gateCheck(){
      const v = pinIn.value.trim();
      if(v.length===6){
        if(v===PIN_CODE){
          localStorage.setItem("guestOK","1");
          pinErr.hidden = true;
          closeGate();
        }else{
          pinErr.hidden = false;
        }
      }else{
        pinErr.hidden = true;
      }
    }
    pinIn.addEventListener("input", gateCheck);

    // ===== Nézetváltók
    function showHome(){ homeView.hidden=false; actorsView.hidden=true; }
    function showActors(){ homeView.hidden=true; actorsView.hidden=false; renderActors(); }
    $("#actorsBackBtn").addEventListener("click", showHome);
    btnActors.addEventListener("click", showActors);

    // ===== Admin UI
    btnAdmin.addEventListener("click", ()=>{ adminModal.hidden=false; admMail.focus(); });
    admCancel.addEventListener("click", ()=> adminModal.hidden=true);
    admLogin.addEventListener("click", async ()=>{
      admErr.hidden = true;
      try{
        await signInWithEmailAndPassword(auth, admMail.value.trim(), admPass.value);
        adminModal.hidden = true;
      }catch(e){
        admErr.textContent = "Belépési hiba: " + (e?.message || e);
        admErr.hidden = false;
      }
    });
    logoutAll.addEventListener("click", async ()=>{
      await signOut(auth);
    });

    onAuthStateChanged(auth, (user)=>{
      // UI: admin gombok
      const isAdmin = !!user;
      logoutAll.hidden = !isAdmin;
      seedKrimiBtn.hidden = !isAdmin;
      // Admin modált ürítsük
      admPass.value = "";
    });

    // ===== Badgek (Új/Összes)
    async function countCategory(catKey){
      try{
        const snap = await getDocs(collection(db,"categories",catKey,"movies"));
        return snap.size || 0;
      }catch(e){ return 0; }
    }
    function lastSeenKey(cat){ return `seen_${cat}`; }

    async function refreshBadges(){
      for(const cat of CATS){
        const total = await countCategory(cat);
        const allEl = cat==="krimi"? $("#bKrimiAll"): cat==="akcio"? $("#bAkcioAll"): $("#bThrillerAll");
        const newEl = cat==="krimi"? $("#bKrimiNew"): cat==="akcio"? $("#bAkcioNew"): $("#bThrillerNew");
        allEl.textContent = total;

        // „Új” – egyszerűen total különbség a legutóbbi értékhez képest
        const prev = Number(localStorage.getItem(lastSeenKey(cat) + "_total") || "0");
        const diff = Math.max(total - prev, 0);
        newEl.textContent = diff;
      }
    }
    function markSeen(){
      CATS.forEach(async (cat)=>{
        const total = await countCategory(cat);
        localStorage.setItem(lastSeenKey(cat) + "_total", String(total));
      });
    }

    // ===== Alap feltöltő
    async function addMovie(catKey, payload){
      const doc = {
        title: (payload?.title || "").trim(),
        link:  (payload?.link  || "").trim(),
        cover: (payload?.cover|| "").trim(),
        desc:  (payload?.desc || "").trim(),
        createdAt: serverTimestamp()
      };
      await addDoc(collection(db,"categories",catKey,"movies"), doc);
    }

    // ===== Krimi seed (10 link) – ADMIN
    const KRIMI_LINKS = [
      // Itt 10 YouTube krimi link legyen – minta
      "https://www.youtube.com/watch?v=dQw4w9WgXcQ",
      "https://www.youtube.com/watch?v=ysz5S6PUM-U",
      "https://www.youtube.com/watch?v=oHg5SJYRHA0",
      "https://www.youtube.com/watch?v=aqz-KE-bpKQ",
      "https://www.youtube.com/watch?v=9bZkp7q19f0",
      "https://www.youtube.com/watch?v=3GwjfUFyY6M",
      "https://www.youtube.com/watch?v=fJ9rUzIMcZQ",
      "https://www.youtube.com/watch?v=Zi_XLOBDo_Y",
      "https://www.youtube.com/watch?v=OPf0YbXqDm0",
      "https://www.youtube.com/watch?v=FTQbiNvZqaY"
    ];
    seedKrimiBtn.addEventListener("click", async ()=>{
      try{
        let ok=0, skip=0, err=0;
        const snap = await getDocs(collection(db,"categories","krimi","movies"));
        const existing = new Set();
        snap.forEach(d=> existing.add((d.data().link||"").trim()));
        for(const [i,lnk] of KRIMI_LINKS.entries()){
          if(existing.has(lnk.trim())){ skip++; continue; }
          try{
            await addMovie("krimi", {title:`Krimi #${i+1}`, link:lnk, cover:"", desc:"YouTube krimi"});
            ok++;
          }catch{ err++; }
        }
        await refreshBadges();
        markSeen();
        alert(`KRIMI seed kész.\nÚj: ${ok} · Kihagyva (dupla): ${skip} · Hiba: ${err}`);
      }catch(e){
        alert("Seed hiba: " + e?.message || e);
      }
    });

    // ===== Színészek – képek + darabszám
    const ACTOR_PHOTOS = {
      "Sylvester Stallone": "https://upload.wikimedia.org/wikipedia/commons/6/6b/Sylvester_Stallone_2014.jpg",
      "Jason Statham": "https://upload.wikimedia.org/wikipedia/commons/0/05/Jason_Statham_2018.jpg",
      "Jet Li": "https://upload.wikimedia.org/wikipedia/commons/5/5c/Jet_Li_2009.jpg",
      "Dolph Lundgren": "https://upload.wikimedia.org/wikipedia/commons/9/91/Dolph_Lundgren_2018.jpg",
      "Randy Couture": "https://upload.wikimedia.org/wikipedia/commons/1/1d/Randy_Couture_2008.jpg",
      "Terry Crews": "https://upload.wikimedia.org/wikipedia/commons/d/df/Terry_Crews_2019.jpg",
      "Mickey Rourke": "https://upload.wikimedia.org/wikipedia/commons/7/71/Mickey_Rourke_2009.jpg",
      "Eric Roberts": "https://upload.wikimedia.org/wikipedia/commons/4/47/Eric_Roberts_2013.jpg",
      "Bruce Willis": "https://upload.wikimedia.org/wikipedia/commons/8/89/Bruce_Willis_by_Gage_Skidmore.jpg",
      "Arnold Schwarzenegger": "https://upload.wikimedia.org/wikipedia/commons/9/98/Arnold_Schwarzenegger_2019.jpg",
      "Wesley Snipes": "https://upload.wikimedia.org/wikipedia/commons/4/47/Wesley_Snipes_2014.jpg",
      "Antonio Banderas": "https://upload.wikimedia.org/wikipedia/commons/0/0f/Antonio_Banderas_2019.jpg",
      "Kelsey Grammer": "https://upload.wikimedia.org/wikipedia/commons/0/0c/Kelsey_Grammer_2010.jpg",
      "Kellan Lutz": "https://upload.wikimedia.org/wikipedia/commons/7/74/Kellan_Lutz_2012.jpg",
      "Ronda Rousey": "https://upload.wikimedia.org/wikipedia/commons/5/5d/Ronda_Rousey_2018.jpg",
      "Glen Powell": "https://upload.wikimedia.org/wikipedia/commons/2/22/Glen_Powell_2019.jpg",
      "Victor Ortiz": "https://upload.wikimedia.org/wikipedia/commons/6/6a/Victor_Ortiz_2011.jpg",
      "Mel Gibson": "https://upload.wikimedia.org/wikipedia/commons/7/7f/Mel_Gibson_Cannes_2016.jpg",
      "Harrison Ford": "https://upload.wikimedia.org/wikipedia/commons/9/9f/Harrison_Ford_2017.jpg",
      "50 Cent": "https://upload.wikimedia.org/wikipedia/commons/b/b0/50_Cent_2018.jpg",
      "Megan Fox": "https://upload.wikimedia.org/wikipedia/commons/5/50/Megan_Fox_2009.jpg",
      "Tony Jaa": "https://upload.wikimedia.org/wikipedia/commons/3/38/Tony_Jaa_2018.jpg",
      "Jacob Scipio": "https://upload.wikimedia.org/wikipedia/commons/0/0c/Jacob_Scipio_2020.jpg",
      "Levy Tran": "https://upload.wikimedia.org/wikipedia/commons/8/8e/Levy_Tran_2019.jpg",
      "Iko Uwais": "https://upload.wikimedia.org/wikipedia/commons/1/1c/Iko_Uwais_2012.jpg",
      "Jean-Claude Van Damme": "https://upload.wikimedia.org/wikipedia/commons/8/80/Jean-Claude_Van_Damme_2012.jpg",
      "Chuck Norris": "https://upload.wikimedia.org/wikipedia/commons/3/35/Chuck_Norris_May_2015.jpg",
      "Lucy Liu": "https://upload.wikimedia.org/wikipedia/commons/6/6c/LucyLiu.webp"
    };
    const ACTORS = Object.keys(ACTOR_PHOTOS);
    const prox = (u)=> u ? `https://images.weserv.nl/?url=${encodeURIComponent(u.replace(/^https?:\/\//,''))}` : "";

    async function countMoviesForActor(name){
      try{
        const snap = await getDocs(collection(db,"actors",name,"movies"));
        return snap.size || 0;
      }catch{ return 0; }
    }

    async function renderActors(){
      const grid = $("#actorsGrid"); grid.innerHTML = "";
      for(const name of ACTORS){
        const films = await countMoviesForActor(name);
        const url = ACTOR_PHOTOS[name] || "";
        const fb  = prox(url);
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <figure class="thumb"><img referrerpolicy="no-referrer" src="${url}" onerror="this.onerror=null;this.src='${fb}'" alt="${name}"></figure>
          <div style="font-weight:800">${name}</div>
          <small class="muted">${films} film</small><br>
          <button class="btn" style="margin-top:8px">Megnyitás</button>
        `;
        card.querySelector("button").addEventListener("click", ()=>{
          alert(`${name} – ide jön a saját filmnézet (később).`);
        });
        grid.appendChild(card);
      }
    }

    // ===== Krimi lista (nagyon egyszerű demó)
    async function renderKrimi(){
      const box = $("#krimiList"); box.innerHTML = "";
      const snap = await getDocs(collection(db,"categories","krimi","movies"));
      if(snap.empty){
        box.innerHTML = `<div class="card">Még nincs film ebben a kategóriában.</div>`;
        return;
      }
      snap.forEach(doc=>{
        const d = doc.data();
        const item = document.createElement("div");
        item.className = "card";
        item.innerHTML = `
          <div style="font-weight:700">${d.title||"Cím nélkül"}</div>
          <small class="muted">${d.link||""}</small>
        `;
        box.appendChild(item);
      });
    }

    // ===== Frissítés gomb
    btnRefresh.addEventListener("click", async ()=>{
      await refreshBadges();
      await renderKrimi();
    });

    // ===== Indulás
    document.addEventListener("DOMContentLoaded", async ()=>{
      // Vendég-kapu elsőre
      if(!localStorage.getItem("guestOK")) openGate();

      showHome();
      await refreshBadges();
      await renderKrimi();

      // amikor bezártad/használtad az oldalt, jelöld látottnak (Új számláló nullázás)
      window.addEventListener("beforeunload", markSeen);
    });

    // Hely az automata leírás-húzáshoz (TMDb/OMDb)
    window.MOVIE_API = { TMDB_API_KEY:"", OMDB_API_KEY:"" };
  </script>
</body>
</html>
