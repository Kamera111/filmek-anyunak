<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Filmek Anyunak</title>

  <!-- ========== 1. RÉSZ ELEJE – ALAP STÍLUSOK ========== -->
  <style>
    :root { --bg:#0f172a; --card:#111827; --muted:#94a3b8; --txt:#e5e7eb; --line:#233046; }
    html,body{margin:0;padding:0;background:var(--bg);color:var(--txt);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .sticky{position:sticky;top:0;z-index:10;background:linear-gradient(180deg,rgba(15,23,42,.98),rgba(15,23,42,.7) 60%,rgba(15,23,42,0));backdrop-filter:blur(6px)}
    header{display:flex;align-items:center;gap:12px;padding:10px 0}
    .title{font-weight:800;font-size:clamp(20px,4.6vw,28px)}
    .btn{background:#1f2937;color:#fff;border:1px solid #334155;border-radius:12px;padding:9px 13px;cursor:pointer;font-weight:600}
    .btn:active{transform:scale(.98)}
    .btn-danger{background:#dc2626;border-color:#b91c1c}
    .muted{color:var(--muted);font-size:14px}
    .card{background:var(--card);border:1px solid #1f2937;border-radius:16px;padding:14px}
    a{color:#a5f3fc;text-decoration:none} a:hover{text-decoration:underline}
    img{max-width:100%;border-radius:10px;border:1px solid #1f2937}
    [hidden]{display:none !important;}

    /* felső színes kategória gombok */
    .top-filters{display:grid;grid-template-columns:repeat(4,minmax(140px,1fr));gap:10px;padding:6px 12px 12px}
    @media (max-width:900px){.top-filters{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:520px){.top-filters{grid-template-columns:1fr}}
    .chip{display:flex;flex-direction:column;gap:4px;padding:12px 14px;border-radius:14px;color:#fff;border:1px solid rgba(255,255,255,.16);box-shadow:0 4px 14px rgba(0,0,0,.18);cursor:pointer;transition:.12s}
    .chip:hover{transform:translateY(-1px);box-shadow:0 8px 18px rgba(0,0,0,.22);filter:brightness(1.03)}
    .chip-title{font-weight:800}
    .chip-sub{font-size:14px;opacity:.95}
    .chip-krimi{background:linear-gradient(180deg,#16a34a,#15803d)}
    .chip-akcio{background:linear-gradient(180deg,#2563eb,#1e40af)}
    .chip-thriller{background:linear-gradient(180deg,#e11d48,#be123c)}
    .chip-actors{background:linear-gradient(180deg,#f59e0b,#b45309)}

    /* élő kártyák + grid */
    #catBar{padding:12px}
    .cats-row{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
    .cat{display:flex;flex-direction:column;gap:6px;padding:14px 16px;border-radius:14px;background:#1f2937;color:#fff;border:1px solid #0f2437;box-shadow:0 4px 14px rgba(0,0,0,.18)}
    .cat .name{color:#22c55e;font-weight:700;font-size:18px}
    .cat .name .live{color:#ef4444;font-weight:900;margin-right:4px}
    .cat .now{font-size:15px}
    .btn-back{margin-bottom:12px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px}

    /* Színész galéria / kártya */
    .actor-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:14px;padding:8px}
    .actor{background:#1f2937;border:1px solid #0f2437;border-radius:14px;padding:10px;cursor:pointer;transition:transform .12s, box-shadow .12s;display:flex;flex-direction:column;align-items:center;gap:8px;text-align:center}
    .actor:hover{transform:translateY(-2px);box-shadow:0 8px 18px rgba(0,0,0,.22)}
    .actor img{width:100%;height:180px;object-fit:cover;border-radius:12px}
    .actor .name{font-weight:800}
    .actor .sub{font-size:12px;color:var(--muted)}
    .actor-header{display:flex;gap:12px;align-items:center}
    .actor-header img{width:72px;height:72px;object-fit:cover;border-radius:12px}
    .actor-header .who{display:flex;flex-direction:column}

    /* Feltöltő UI */
    .field{display:flex;flex-direction:column;gap:6px;margin:10px 0}
    .field input{background:#0b1224;border:1px solid #22304b;border-radius:10px;color:var(--txt);padding:10px}
    .two{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .preview{display:flex;gap:10px;align-items:center;margin:10px 0}
    .preview img{width:160px;height:90px;object-fit:cover;border-radius:10px}
    .hint{font-size:12px;color:var(--muted)}
    .err{color:#fecaca;font-weight:700;margin-top:6px}

    /* Modál (admin/vendég kapu) */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.55);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:.15s}
    .modal-backdrop.show{opacity:1;pointer-events:auto}
    .modal{background:#0f172a;border:1px solid #1f2937;border-radius:16px;padding:16px;min-width:300px;max-width:92vw}
  </style>
  <!-- ========== 1. RÉSZ VÉGE – ALAP STÍLUSOK ========== -->
</head>

<!-- ========== 2. RÉSZ ELEJE – FIREBASE INIT (doc + deleteDoc exportokkal) ========== -->
<script type="module">
  import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
  import {
    getFirestore, collection, addDoc, getDocs, onSnapshot,
    query, where, orderBy, limit, serverTimestamp, doc, deleteDoc
  } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";
  import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBDSI-z3a4IFAIoKCVZVcUyue7GMoO5acY",
    authDomain: "filmek-fe035.firebaseapp.com",
    projectId: "filmek-fe035",
    storageBucket: "filmek-fe035.appspot.com",
    messagingSenderId: "302167835367",
    appId: "1:302167835367:web:6e0fd4304c4496612c1842",
    measurementId: "G-QBG7LG0ZQH"
  };

  const app  = getApps().length ? getApps()[0] : initializeApp(firebaseConfig);
  const db   = getFirestore(app);
  const auth = getAuth(app);

  /* AUTOMATA TARTALOM (opcionális API-k) – töltsd ki, ha szeretnéd */
  window.MOVIE_API = {
    TMDB_API_KEY: "",  // ide TMDb kulcs
    OMDB_API_KEY: ""   // ide OMDb kulcs (nem kötelező)
  };

  /* Exportok az oldal többi részének */
  window.fb = {
    app,
    db: { db, collection, addDoc, getDocs, onSnapshot, query, where, orderBy, limit, serverTimestamp, doc, deleteDoc },
    auth: { auth, signInWithEmailAndPassword, signOut, onAuthStateChanged }
  };

  console.debug("[Firebase] READY – project:", firebaseConfig.projectId);
</script>
<!-- ========== 2. RÉSZ VÉGE – FIREBASE INIT ========== -->

<body>
<!-- ========== 3. RÉSZ ELEJE – FŐ UI (HEADER + KATEGÓRIÁK) ========== -->
<div id="app" class="wrap">
  <div class="sticky">
    <header>
      <div class="title">Filmek Anyunak</div>
      <div style="margin-left:auto;display:flex;gap:8px">
        <button id="btnAdmin" class="btn" title="Admin belépés">A</button>
        <button id="btnRefreshAll" class="btn">Frissítés</button>
      </div>
    </header>

    <div id="topFilters" class="top-filters">
      <button class="chip chip-krimi"    data-goto="krimi"><div class="chip-title">KRIMI</div><div class="chip-sub">Új:<span id="badge-new-krimi">0</span> · Összes:<span id="badge-all-krimi">0</span></div></button>
      <button class="chip chip-akcio"    data-goto="akcio"><div class="chip-title">AKCIÓ</div><div class="chip-sub">Új:<span id="badge-new-akcio">0</span> · Összes:<span id="badge-all-akcio">0</span></div></button>
      <button class="chip chip-thriller" data-goto="thriller"><div class="chip-title">THRILLER</div><div class="chip-sub">Új:<span id="badge-new-thriller">0</span> · Összes:<span id="badge-all-thriller">0</span></div></button>
      <button class="chip chip-actors"   data-goto="actors"><div class="chip-title">SZÍNÉSZEK</div><div class="chip-sub">Galéria és filmek</div></button>
    </div>

    <div id="catBar"><div class="cats-row" id="catsLive"></div></div>
  </div>

  <main id="view" class="view" data-type=""></main>
</div>
<!-- ========== 3. RÉSZ VÉGE – FŐ UI (HEADER + KATEGÓRIÁK) ========== -->

<!-- ========== 3.5. RÉSZ ELEJE – BADGE FRISSÍTŐ (Új/Összes az elmúlt 7 nap alapján) ========== -->
<script>
(function(){
  const NEW_DAYS = 7, MS_DAY = 86400000;

  async function refreshBadges(){
    try{
      const fbd = window.fb?.db; if (!fbd) return;
      const { db, collection, getDocs } = fbd;
      const cats = ["krimi","akcio","thriller"];
      const newAfter = Date.now() - NEW_DAYS * MS_DAY;

      for (const k of cats){
        const snap  = await getDocs(collection(db,"categories",k,"movies"));
        const total = snap.size || 0;
        let news = 0;
        snap.forEach(d=>{
          const ts = d.data()?.createdAt;
          const ms = ts?.toMillis ? ts.toMillis() : (ts?.seconds ? ts.seconds*1000 : 0);
          if (ms && ms >= newAfter) news++;
        });
        const t = document.getElementById(`badge-all-${k}`); if (t) t.textContent = String(total);
        const n = document.getElementById(`badge-new-${k}`); if (n) n.textContent = String(news);
      }
    }catch(e){ console.warn("Badge frissítés hiba:", e); }
  }

  document.addEventListener("DOMContentLoaded", refreshBadges);
  document.addEventListener("admin:login",  refreshBadges);
  document.addEventListener("admin:logout", refreshBadges);
  document.getElementById("btnRefreshAll").addEventListener("click", refreshBadges);
  document.addEventListener("badges:refresh", refreshBadges);
})();
</script>
<!-- ========== 3.5. RÉSZ VÉGE – BADGE FRISSÍTŐ ========== -->

<!-- ========== 4. RÉSZ ELEJE – MODÁLOK (Admin belépő + Vendég kapu – automatikus) ========== -->
<div id="adminModal" class="modal-backdrop" aria-hidden="true" hidden>
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="admintitle">
    <h3 id="admintitle">Admin belépés</h3>
    <div class="field"><label for="admEmail">Email</label><input id="admEmail" type="email" autocomplete="username" placeholder="pl. te@pelda.hu"></div>
    <div class="field"><label for="admPass">Jelszó</label><input id="admPass" type="password" autocomplete="new-password" placeholder="••••••••"><div class="hint">A jelszó nincs előtöltve — kézzel írd be.</div></div>
    <div class="err" id="admErr"></div>
    <div class="row"><button id="admCancel" class="btn btn-danger" type="button">Mégse</button><button id="admSubmit" class="btn" type="button">Belépés</button></div>
  </div>
</div>

<div id="guestModal" class="modal-backdrop" aria-hidden="true" hidden>
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="guesttitle">
    <h3 id="guesttitle">Vendég kapu</h3>
    <div class="field">
      <label for="guestPin">PIN (6 számjegy)</label>
      <input id="guestPin" type="text" inputmode="numeric" pattern="[0-9]*" maxlength="6"
             placeholder="Kattints! Ide írd a kódot" autocomplete="one-time-code">
    </div>
    <div class="err" id="guestErr"></div>
    <div class="row"><button id="guestCancel" class="btn btn-danger" type="button">Mégse</button></div>
  </div>
</div>
<!-- ========== 4. RÉSZ VÉGE – MODÁLOK ========== -->

<!-- ========== 5. RÉSZ ELEJE – ADMIN / VENDÉG VEZÉRLÉS (gombok, kapu, kilépés) ========== -->
<script>
(function(){
  const LS_ADMIN_OK="filmek_anyunak_admin_ok", LS_ADMIN_EMAIL="admin_email", LS_GUEST_OK="filmek_anyunak_guest_ok", GUEST_PIN="195400";
  const btn=document.getElementById("btnAdmin");
  const admM=document.getElementById("adminModal"), admEmail=document.getElementById("admEmail"), admPass=document.getElementById("admPass"), admErr=document.getElementById("admErr");
  const admCancel=document.getElementById("admCancel"), admSubmit=document.getElementById("admSubmit");
  const gusM=document.getElementById("guestModal"), gusPin=document.getElementById("guestPin"), gusErr=document.getElementById("guestErr"), gusCancel=document.getElementById("guestCancel");

  const openModal=m=>{m.classList.add("show");m.removeAttribute("hidden");m.setAttribute("aria-hidden","false");};
  const closeModal=m=>{m.classList.remove("show");m.setAttribute("hidden","");m.setAttribute("aria-hidden","true");};
  const loggedIn=()=> (window.fb?.auth?.auth?.currentUser)||localStorage.getItem(LS_ADMIN_OK)==="1";
  const guestOk=()=> localStorage.getItem(LS_GUEST_OK)==="1";

  function ensureGuestGate(){
    if(!loggedIn() && !guestOk()){
      gusErr.textContent=""; gusPin.value=""; openModal(gusM); setTimeout(()=>gusPin.focus(),0);
    }
  }
  function setAdminUi(){ btn.textContent=loggedIn()?"Admin kilépés":"A"; btn.title=loggedIn()?"Kijelentkezés és vendég kapu":"Admin belépés"; }

  async function doLogin(){
    admErr.textContent="";
    const email=(admEmail.value||"").trim(), pass=(admPass.value||"");
    if(!email||!pass){admErr.textContent="Add meg az email címet és a jelszót.";return;}
    try{
      const a=window.fb?.auth?.auth, si=window.fb?.auth?.signInWithEmailAndPassword; if(!a||typeof si!=="function") throw new Error("Firebase Auth nincs inicializálva.");
      await Promise.race([si(a,email,pass), new Promise((_,rej)=>setTimeout(()=>rej(new Error("Időtúllépés")),8000)) ]);
      localStorage.setItem(LS_ADMIN_OK,"1"); localStorage.setItem(LS_ADMIN_EMAIL,email); closeModal(admM); setAdminUi(); document.dispatchEvent(new CustomEvent("admin:login"));
    }catch(e){ admErr.textContent=e?.message||"Ismeretlen hiba."; }
  }
  async function doLogoutToGuestGate(){
    try{ localStorage.removeItem(LS_ADMIN_OK); sessionStorage.clear(); }catch{}
    try{ const a=window.fb?.auth?.auth, so=window.fb?.auth?.signOut; if(a&&typeof so==="function"){ await Promise.race([so(a), new Promise(r=>setTimeout(r,1200))]); } }catch{}
    setAdminUi(); document.dispatchEvent(new CustomEvent("admin:logout")); localStorage.removeItem(LS_GUEST_OK); ensureGuestGate();
  }

  // Vendég kapu: automatikus belépés helyes PIN-nel (nincs „Belépés” gomb)
  function normalizeDigits(s){ return (s||"").replace(/\D/g,"").slice(0,6); }
  gusPin.addEventListener("input", ()=>{
    const val = normalizeDigits(gusPin.value);
    if (gusPin.value !== val) gusPin.value = val;
    gusErr.textContent = "";
    if (val.length === 6){
      if (val === GUEST_PIN){
        localStorage.setItem(LS_GUEST_OK,"1");
        closeModal(gusM);
      } else {
        gusErr.textContent = "Hibás PIN.";
      }
    }
  });

  btn.addEventListener("click", ()=> loggedIn()?doLogoutToGuestGate():(admErr.textContent="",admEmail.value=localStorage.getItem(LS_ADMIN_EMAIL)||"",admPass.value="",openModal(admM), setTimeout(()=> (admEmail.value?admPass:admEmail).focus(),0)));
  admCancel.addEventListener("click", ()=>closeModal(admM)); admSubmit.addEventListener("click", doLogin);
  admM.addEventListener("click",(e)=>{ if(e.target===admM) closeModal(admM); });

  gusCancel.addEventListener("click", ()=>closeModal(gusM));
  gusM.addEventListener("click",(e)=>{ if(e.target===gusM) closeModal(gusM); });

  document.addEventListener("keydown",(e)=>{
    if(e.key==="Escape"){
      if(admM.classList.contains("show")) closeModal(admM);
      if(gusM.classList.contains("show")) closeModal(gusM);
    }
    if(e.key==="Enter" && admM.classList.contains("show")) doLogin();
  });

  try{
    const o=window.fb?.auth?.onAuthStateChanged, a=window.fb?.auth?.auth;
    if(typeof o==="function"&&a){
      o(a,(user)=>{ if(user){ localStorage.setItem(LS_ADMIN_OK,"1"); if(user.email) localStorage.setItem(LS_ADMIN_EMAIL,user.email); document.dispatchEvent(new CustomEvent("admin:login")); } else { localStorage.removeItem(LS_ADMIN_OK); document.dispatchEvent(new CustomEvent("admin:logout")); } setAdminUi(); });
    }
  }catch{}

  setAdminUi();
  document.addEventListener("DOMContentLoaded", ensureGuestGate, { once:true });
})();
</script>
<!-- ========== 5. RÉSZ VÉGE – ADMIN / VENDÉG VEZÉRLÉS ========== -->

<!-- ========== 6. RÉSZ ELEJE – ÉLŐ TV GOMBOK FELTÖLTÉSE ========== -->
<script>
(function(){
  const list = [
    {name:"ÉLŐ Vígjáték TV", url:"https://sweet.tv/hu/free_tv/2014-comedy-universe-hd"},
    {name:"ÉLŐ Akció TV",    url:"https://sweet.tv/hu/free_tv/2010-action-zone-hd"},
    {name:"ÉLŐ Thriller TV", url:"https://sweet.tv/hu/free_tv/2016-thriller-time-hd"},
    {name:"ÉLŐ TOP Filmek",  url:"https://sweet.tv/hu/free_tv/2967-top-movies-hd"},
    {name:"Mozi+ tv",      url:"https://player.telekomtvgo.hu/player/live?channelNumber=13"},
    {name:"Film + tv",     url:"https://player.telekomtvgo.hu/player/live?channelNumber=15"},
    {name:"Prime tv",      url:"https://player.telekomtvgo.hu/player/live?channelNumber=21"},
    {name:"RTL 2 tv",      url:"https://player.telekomtvgo.hu/player/live?channelNumber=24"},
    {name:"FilmCafe tv",   url:"https://player.telekomtvgo.hu/player/live?channelNumber=28"},
    {name:"ozone tv",      url:"https://player.telekomtvgo.hu/player/live?channelNumber=30"},
    {name:"Cool tv",       url:"https://player.telekomtvgo.hu/player/live?channelNumber=60"},
    {name:"AXN tv",        url:"https://player.telekomtvgo.hu/player/live?channelNumber=61"},
    {name:"AMC tv",        url:"https://player.telekomtvgo.hu/player/live?channelNumber=62"},
    {name:"Paramount tv",  url:"https://player.telekomtvgo.hu/player/live?channelNumber=66"},
    {name:"FilmMánia tv",  url:"https://player.telekomtvgo.hu/player/live?channelNumber=163"},
    {name:"Moziverzum tv", url:"https://player.telekomtvgo.hu/player/live?channelNumber=169"}
  ];
  const host = document.getElementById("catsLive");
  if (!host) return;
  for (const ch of list){
    const a = document.createElement("a");
    a.className="cat"; a.target="_blank"; a.rel="noopener"; a.href=ch.url;
    const safe = ch.name.replace(/^ÉLŐ(\s+)/, "<span class='live'>ÉLŐ</span>$1");
    a.innerHTML = `<div class="name">${safe}</div><div class="now"><span class="label">Most megy:</span> <span class="title">Kattints</span></div>`;
    host.appendChild(a);
  }
})();
</script>
<!-- ========== 6. RÉSZ VÉGE – ÉLŐ TV GOMBOK FELTÖLTÉSE ========== -->

<!-- ========== 7. RÉSZ ELEJE – FILMEK + FELTÖLTŐ + TÖRLÉS + SZÍNÉSZ GALÉRIA + AUTOMATA TARTALOM ========== -->
<script>
(function(){
  const $ = (s,r=document)=>r.querySelector(s);
  const LS_ADMIN_OK = "filmek_anyunak_admin_ok";
  const isAdmin = ()=> { try{ if(window.fb?.auth?.auth?.currentUser) return true; return localStorage.getItem(LS_ADMIN_OK)==="1"; } catch{ return false; } };
  const catLabel = (k)=>({krimi:"KRIMI", akcio:"AKCIÓ", thriller:"THRILLER"})[k]||k.toUpperCase();

  /* ----- SZÍNÉSZ LISTA (név + fotó URL) ----- */
  const ACTORS_RAW = [
    {name:"Sylvester Stallone", photo:"https://upload.wikimedia.org/wikipedia/commons/6/6b/Sylvester_Stallone_2014.jpg"},
    {name:"Jason Statham", photo:"https://upload.wikimedia.org/wikipedia/commons/0/05/Jason_Statham_2018.jpg"},
    {name:"Jet Li", photo:"https://upload.wikimedia.org/wikipedia/commons/5/5c/Jet_Li_2009.jpg"},
    {name:"Dolph Lundgren", photo:"https://upload.wikimedia.org/wikipedia/commons/9/91/Dolph_Lundgren_2018.jpg"},
    {name:"Randy Couture", photo:"https://upload.wikimedia.org/wikipedia/commons/1/1d/Randy_Couture_2008.jpg"},
    {name:"Terry Crews", photo:"https://upload.wikimedia.org/wikipedia/commons/d/df/Terry_Crews_2019.jpg"},
    {name:"Mickey Rourke", photo:"https://upload.wikimedia.org/wikipedia/commons/7/71/Mickey_Rourke_2009.jpg"},
    {name:"Eric Roberts", photo:"https://upload.wikimedia.org/wikipedia/commons/4/47/Eric_Roberts_2013.jpg"},
    {name:"Bruce Willis", photo:"https://upload.wikimedia.org/wikipedia/commons/8/89/Bruce_Willis_by_Gage_Skidmore.jpg"},
    {name:"Arnold Schwarzenegger", photo:"https://upload.wikimedia.org/wikipedia/commons/9/98/Arnold_Schwarzenegger_2019.jpg"},
    {name:"Wesley Snipes", photo:"https://upload.wikimedia.org/wikipedia/commons/4/47/Wesley_Snipes_2014.jpg"},
    {name:"Antonio Banderas", photo:"https://upload.wikimedia.org/wikipedia/commons/0/0f/Antonio_Banderas_2019.jpg"},
    {name:"Kelsey Grammer", photo:"https://upload.wikimedia.org/wikipedia/commons/0/0c/Kelsey_Grammer_2010.jpg"},
    {name:"Kellan Lutz", photo:"https://upload.wikimedia.org/wikipedia/commons/7/74/Kellan_Lutz_2012.jpg"},
    {name:"Ronda Rousey", photo:"https://upload.wikimedia.org/wikipedia/commons/5/5d/Ronda_Rousey_2018.jpg"},
    {name:"Glen Powell", photo:"https://upload.wikimedia.org/wikipedia/commons/2/22/Glen_Powell_2019.jpg"},
    {name:"Victor Ortiz", photo:"https://upload.wikimedia.org/wikipedia/commons/6/6a/Victor_Ortiz_2011.jpg"},
    {name:"Mel Gibson", photo:"https://upload.wikimedia.org/wikipedia/commons/7/7f/Mel_Gibson_Cannes_2016.jpg"},
    {name:"Harrison Ford", photo:"https://upload.wikimedia.org/wikipedia/commons/9/9f/Harrison_Ford_2017.jpg"},
    {name:'Curtis "50 Cent" Jackson', photo:"https://upload.wikimedia.org/wikipedia/commons/b/b0/50_Cent_2018.jpg"},
    {name:"Megan Fox", photo:"https://upload.wikimedia.org/wikipedia/commons/5/50/Megan_Fox_2009.jpg"},
    {name:"Tony Jaa", photo:"https://upload.wikimedia.org/wikipedia/commons/3/38/Tony_Jaa_2018.jpg"},
    {name:"Jacob Scipio", photo:"https://upload.wikimedia.org/wikipedia/commons/0/0c/Jacob_Scipio_2020.jpg"},
    {name:"Levy Tran", photo:"https://upload.wikimedia.org/wikipedia/commons/8/8e/Levy_Tran_2019.jpg"},
    {name:"Iko Uwais", photo:"https://upload.wikimedia.org/wikipedia/commons/1/1c/Iko_Uwais_2012.jpg"},
    {name:"Jean-Claude Van Damme", photo:"https://upload.wikimedia.org/wikipedia/commons/8/80/Jean-Claude_Van_Damme_2012.jpg"},
    {name:"Chuck Norris", photo:"https://upload.wikimedia.org/wikipedia/commons/3/35/Chuck_Norris_May_2015.jpg"},
  ];
  const ACTORS = ACTORS_RAW.map(a=>({ ...a, id: slug(a.name) }));
  function slug(s){ return (s||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""); }
  function findActor(id){ return ACTORS.find(a=>a.id===id); }

  /* ----- Placeholder kép hibára ----- */
  const IMG_FALLBACK = "data:image/svg+xml;utf8," + encodeURIComponent(
    `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 120 80'>
       <rect width='120' height='80' rx='12' fill='#1f2937'/>
       <circle cx='40' cy='32' r='14' fill='#4b5563'/>
       <rect x='20' y=' Fifty' width='80' height='18' rx='9' fill='#4b5563'/>
     </svg>`.replace(" Fifty","50") // csak hogy biztos valid svg legyen
  );

  function goHome(){ $("#catBar").style.display=""; const v=$("#view"); v.dataset.type=""; v.dataset.key=""; v.innerHTML=""; window.scrollTo({top:0,behavior:"smooth"}); }

  /* ----- Kártya HTML (film) ----- */
  function cardHtml(m, admin, delMeta){
    const img = m.cover ? `<img src="${m.cover}" alt="">` : "";
    const title = m.title || "Cím nélkül";
    const content = m.content || "";
    const link = m.link || "#";
    const delBtn = admin ? `<button class="btn btn-danger btn-del" data-id="${delMeta.id}" data-path="${(delMeta.path||[]).join("/")}">Törlés</button>` : "";
    return `<div class="card">${img}<div style="font-weight:800;margin:6px 0">${title}</div><div class="muted" style="margin-bottom:8px">${content}</div><div style="display:flex;gap:8px;flex-wrap:wrap"><a class="btn" href="${link}" target="_blank" rel="noopener">Megnyitás</a>${delBtn}</div></div>`;
  }

  function updateBadges(catKey, total){
    const t = document.getElementById(`badge-all-${catKey}`); if (t) t.textContent=String(total||0);
    const n = document.getElementById(`badge-new-${catKey}`); if (n) n.textContent="0";
  }

  /* ----- oEmbed meta (YouTube/Vimeo/Dailymotion) ----- */
  async function fetchMeta(url){
    const u = String(url||"").trim();
    if (!u) return {};
    const get = async ep=>{ const r=await fetch(ep,{mode:"cors"}); if(!r.ok) throw 0; return r.json(); };
    try{
      if (/youtube\.com|youtu\.be/.test(u)){ const o=await get(`https://www.youtube.com/oembed?url=${encodeURIComponent(u)}&format=json`); return {title:o.title,cover:o.thumbnail_url}; }
      if (/vimeo\.com/.test(u)){ const o=await get(`https://vimeo.com/api/oembed.json?url=${encodeURIComponent(u)}`); return {title:o.title,cover:o.thumbnail_url}; }
      if (/dailymotion\.com/.test(u)){ const o=await get(`https://www.dailymotion.com/services/oembed?url=${encodeURIComponent(u)}`); return {title:o.title,cover:o.thumbnail_url}; }
    }catch(e){}
    try{ const p=new URL(u); const last=decodeURIComponent(p.pathname.split("/").filter(Boolean).pop()||""); const guess=last.replace(/[-_]/g," ").replace(/\.\w+$/,""); return {title:guess||p.hostname, cover:""}; }catch{ return {}; }
  }

  /* ----- AUTOMATA TARTALOM (TMDb/OMDb – opcionális) ----- */
  async function fetchPlotByTitle(title){
    const t = (title||"").trim(); if (!t) return "";
    try{
      if (window.MOVIE_API?.TMDB_API_KEY){
        // HU leírás, ha nincs: EN
        const k = window.MOVIE_API.TMDB_API_KEY;
        const q = encodeURIComponent(t);
        const r = await fetch(`https://api.themoviedb.org/3/search/movie?api_key=${k}&language=hu-HU&query=${q}`);
        const j = await r.json();
        const m = j?.results?.[0];
        if (m?.overview) return m.overview;
        const r2 = await fetch(`https://api.themoviedb.org/3/search/movie?api_key=${k}&language=en-US&query=${q}`);
        const j2 = await r2.json();
        const m2 = j2?.results?.[0];
        if (m2?.overview) return m2.overview;
      }
      if (window.MOVIE_API?.OMDB_API_KEY){
        const k = window.MOVIE_API.OMDB_API_KEY;
        const r = await fetch(`https://www.omdbapi.com/?t=${encodeURIComponent(t)}&plot=short&apikey=${k}`);
        const j = await r.json();
        if (j?.Plot && j.Plot !== "N/A") return j.Plot;
      }
    }catch(e){}
    return "";
  }

  /* ----- Feltöltő (új film) ----- */
  function uploaderHtml(scopeLabel){
    return `
      <div class="card" style="margin:12px;">
        <h3 style="margin:0 0 8px">Új film hozzáadása – <span class="muted">${scopeLabel}</span></h3>
        <div class="uploader">
          <div class="field"><label>Videó/film link</label><input id="upLink" type="url" placeholder="Illeszd be a linket (pl. YouTube)"><div class="hint">Beillesztés után a cím és a borítókép automatikus (ha elérhető).</div></div>
          <div class="two">
            <div class="field"><label>Cím</label><input id="upTitle" type="text" placeholder="Automatikus, de módosítható"></div>
            <div class="field"><label>Borítókép (URL)</label><input id="upCover" type="url" placeholder="Automatikus, ha van oEmbed"></div>
          </div>
          <div class="field"><label>Leírás (opcionális)</label><input id="upDesc" type="text" placeholder="Rövid megjegyzés…"></div>
          <div class="preview"><img id="upPrev" src="" alt="" style="display:none"><div class="muted">Előnézet</div></div>
          <div class="row"><button id="upCancel" class="btn btn-danger" type="button">Mégse</button><button id="upSubmit" class="btn" type="button">Feltöltés</button></div>
          <div class="err" id="upErr"></div>
        </div>
      </div>`;
  }
  function bindUploader(targetPathBuilder, afterAdded){
    const $id=(x)=>document.getElementById(x);
    const link=$id("upLink"), title=$id("upTitle"), cover=$id("upCover"), desc=$id("upDesc"), prev=$id("upPrev"), err=$id("upErr");
    const updatePrev=()=>{ const u=(cover.value||"").trim(); prev.style.display=u?"block":"none"; prev.src=u||""; };
    cover.addEventListener("input", updatePrev);

    let timer=null, timerTitle=null;

    link.addEventListener("input", ()=>{
      clearTimeout(timer);
      timer=setTimeout(async ()=>{
        err.textContent="";
        const meta = await fetchMeta(link.value);
        if (meta.title && !title.value) title.value = meta.title;
        if (meta.cover && !cover.value){ cover.value = meta.cover; updatePrev(); }
        if (!desc.value && title.value){
          const plot = await fetchPlotByTitle(title.value);
          if (plot) desc.value = plot;
        }
      }, 350);
    });

    title.addEventListener("input", ()=>{
      clearTimeout(timerTitle);
      timerTitle=setTimeout(async ()=>{
        if (!desc.value && title.value){
          const plot = await fetchPlotByTitle(title.value);
          if (plot) desc.value = plot;
        }
      }, 500);
    });

    $id("upCancel").addEventListener("click", ()=>{ link.value=title.value=cover.value=desc.value=""; updatePrev(); err.textContent=""; });

    $id("upSubmit").addEventListener("click", async ()=>{
      err.textContent="";
      const L=(link.value||"").trim(); if(!L){ err.textContent="Adj meg egy linket."; return; }
      const payload={ link:L, title:(title.value||"").trim()||"Cím nélkül", cover:(cover.value||"").trim()||"", content:(desc.value||"").trim()||"", createdAt: window.fb.db.serverTimestamp() };
      try{
        const { db, collection, addDoc } = window.fb.db;
        const { root, segments } = targetPathBuilder();
        await addDoc(collection(db, ...root, ...segments), payload);
        document.dispatchEvent(new Event("badges:refresh"));
        link.value = title.value = cover.value = desc.value = ""; updatePrev();
        if (typeof afterAdded==="function") afterAdded();
      }catch(e){ err.textContent = e?.message || "Feltöltési hiba."; }
    });
  }

  /* ----- Kategória nézet ----- */
  let unsub=null; const detach=()=>{ if(typeof unsub==="function"){try{unsub();}catch{}} unsub=null; };

  async function loadCategory(catKey, label){
    detach(); $("#catBar").style.display="none";
    const admin=isAdmin(); const uploader=admin?uploaderHtml(catLabel(catKey)):"";
    const v=$("#view"); v.dataset.type="category"; v.dataset.key=catKey; v.innerHTML = `
      ${uploader}
      <div class="card" style="margin:12px;">
        <button class="btn btn-danger btn-back" id="btnBackHome">Vissza a főoldalra</button>
        <h2 style="margin:4px 0 8px">${label}</h2>
        <div class="muted" id="listInfo" style="margin-bottom:10px">Lista betöltése…</div>
        <div id="list-${catKey}" class="grid"></div>
      </div>`;
    $("#btnBackHome").addEventListener("click",()=>{ detach(); goHome(); });
    if (admin) bindUploader(()=>({root:["categories",catKey], segments:["movies"]}));

    const host=document.getElementById(`list-${catKey}`);
    const {db,collection,getDocs,onSnapshot,query,orderBy,limit,doc,deleteDoc} = window.fb.db;
    try{
      const q = query(collection(db,"categories",catKey,"movies"), orderBy("createdAt","desc"), limit(200));
      const render=(movies)=>{
        if(!movies.length){ host.innerHTML=`<div class="muted">Még nincs film ebben a kategóriában.</div>`; updateBadges(catKey,0); return; }
        host.innerHTML = movies.map(m=>cardHtml(m, admin, {id:m.id, path:["categories",catKey,"movies"]})).join(""); updateBadges(catKey,movies.length);
        if(admin){
          host.querySelectorAll(".btn-del").forEach(b=>{
            b.addEventListener("click", async ()=>{
              const id=b.dataset.id; if(!confirm("Biztosan törlöd ezt a filmet?")) return;
              try{ await deleteDoc(doc(db,"categories",catKey,"movies",id)); document.dispatchEvent(new Event("badges:refresh")); }
              catch(e){ alert("Törlési hiba: "+(e?.message||e)); }
            });
          });
        }
      };
      if(admin){
        unsub = onSnapshot(q, snap=>{ render(snap.docs.map(d=>({id:d.id,...d.data()}))); const info=document.getElementById("listInfo"); if(info) info.textContent="Valós idejű lista (admin mód)"; }, err=>{ host.innerHTML=`<div class="muted">Hiba (realtime): ${err?.message||err}</div>`; });
      }else{
        const snap = await getDocs(q);
        render(snap.docs.map(d=>({id:d.id,...d.data()})));
        const info=document.getElementById("listInfo"); if(info) info.textContent="Egyszeri lista (vendég mód)";
      }
    }catch(e){ host.innerHTML = `<div class="muted">Hiba: ${e?.message||e}</div>`; }
  }

  /* ----- Színész galéria ----- */
  function renderActorsGallery(){
    detach(); $("#catBar").style.display="none";
    const v=$("#view"); v.dataset.type="actors"; v.dataset.key=""; v.innerHTML = `
      <div class="card" style="margin:12px;">
        <button class="btn btn-danger btn-back" id="btnBackHome">Vissza a főoldalra</button>
        <h2 style="margin:4px 0 8px">Színészek</h2>
        <div class="actor-grid" id="actorGrid"></div>
      </div>`;
    $("#btnBackHome").addEventListener("click", goHome);
    const grid=$("#actorGrid");
    grid.innerHTML = ACTORS.map(a=>`
      <div class="actor" data-id="${a.id}">
        <img src="${a.photo}" alt="${a.name}" referrerpolicy="no-referrer"
             onerror="this.onerror=null;this.src='${IMG_FALLBACK}'">
        <div class="name">${a.name}</div>
        <div class="sub">kattints</div>
      </div>`).join("");
    grid.querySelectorAll(".actor").forEach(el=>{
      el.addEventListener("click", ()=> loadActorDetails(el.dataset.id));
    });
  }

  /* ----- Egy színész filmjei ----- */
  async function loadActorDetails(actorId){
    const actor = findActor(actorId); if(!actor){ alert("Ismeretlen színész."); return; }
    detach(); $("#catBar").style.display="none";
    const admin=isAdmin(); const uploader=admin?uploaderHtml(actor.name):"";
    const v=$("#view"); v.dataset.type="actor"; v.dataset.key=actorId;
    v.innerHTML = `
      ${uploader}
      <div class="card" style="margin:12px;">
        <div class="actor-header">
          <img src="${actor.photo}" alt="${actor.name}" referrerpolicy="no-referrer"
               onerror="this.onerror=null;this.src='${IMG_FALLBACK}'">
          <div class="who">
            <div style="font-weight:800;font-size:20px">${actor.name}</div>
            <div class="muted">Saját filmek</div>
          </div>
        </div>
        <div style="display:flex;gap:8px;margin:12px 0">
          <button class="btn btn-danger btn-back" id="btnBackActors">Vissza a színészekhez</button>
          <button class="btn" id="btnBackHome2">Főoldal</button>
        </div>
        <div class="muted" id="listInfo" style="margin-bottom:10px">Lista betöltése…</div>
        <div id="list-actor-${actorId}" class="grid"></div>
      </div>`;
    $("#btnBackActors").addEventListener("click", renderActorsGallery);
    $("#btnBackHome2").addEventListener("click", goHome);
    if (admin) bindUploader(()=>({root:["actors",actorId], segments:["movies"]}));

    const host=document.getElementById(`list-actor-${actorId}`);
    const {db,collection,getDocs,onSnapshot,query,orderBy,limit,doc,deleteDoc} = window.fb.db;
    try{
      const q = query(collection(db,"actors",actorId,"movies"), orderBy("createdAt","desc"), limit(200));
      const render=(movies)=>{
        if(!movies.length){ host.innerHTML=`<div class="muted">Még nincs film feltöltve.</div>`; return; }
        host.innerHTML = movies.map(m=>cardHtml(m, admin, {id:m.id, path:["actors",actorId,"movies"]})).join("");
        if(admin){
          host.querySelectorAll(".btn-del").forEach(b=>{
            b.addEventListener("click", async ()=>{
              const id=b.dataset.id; if(!confirm("Biztosan törlöd ezt a filmet?")) return;
              try{ await deleteDoc(doc(db,"actors",actorId,"movies",id)); document.dispatchEvent(new Event("badges:refresh")); }
              catch(e){ alert("Törlési hiba: "+(e?.message||e)); }
            });
          });
        }
      };
      if(admin){
        unsub = onSnapshot(q, snap=>{ render(snap.docs.map(d=>({id:d.id,...d.data()}))); const info=document.getElementById("listInfo"); if(info) info.textContent="Valós idejű lista (admin mód)"; }, err=>{ host.innerHTML=`<div class="muted">Hiba (realtime): ${err?.message||err}</div>`; });
      }else{
        const snap = await getDocs(q);
        render(snap.docs.map(d=>({id:d.id,...d.data()})));
        const info=document.getElementById("listInfo"); if(info) info.textContent="Egyszeri lista (vendég mód)";
      }
    }catch(e){ host.innerHTML = `<div class="muted">Hiba: ${e?.message||e}</div>`; }
  }

  /* ----- Navigáció, frissítés ----- */
  document.addEventListener("DOMContentLoaded", ()=>{
    const top=document.getElementById("topFilters");
    top.addEventListener("click",(e)=>{
      const b=e.target.closest(".chip"); if(!b) return;
      const g=b.dataset.goto;
      if(g==="krimi") loadCategory("krimi","KRIMI");
      if(g==="akcio") loadCategory("akcio","AKCIÓ");
      if(g==="thriller") loadCategory("thriller","THRILLER");
      if(g==="actors") renderActorsGallery();
    });

    document.getElementById("btnRefreshAll").addEventListener("click", ()=>{
      const v=document.getElementById("view");
      const type=v.dataset.type, key=v.dataset.key;
      if(type==="category" && key) loadCategory(key, catLabel(key));
      else if(type==="actor" && key) loadActorDetails(key);
      else if(type==="actors") renderActorsGallery();
    });
  });

  document.addEventListener("admin:login", ()=>{
    const v=document.getElementById("view"); const type=v.dataset.type, key=v.dataset.key;
    if(type==="category" && key) loadCategory(key, catLabel(key));
    else if(type==="actor" && key) loadActorDetails(key);
  });
  document.addEventListener("admin:logout",()=>{
    const v=document.getElementById("view"); const type=v.dataset.type, key=v.dataset.key;
    if(type==="category" && key) loadCategory(key, catLabel(key));
    else if(type==="actor" && key) loadActorDetails(key);
  });
})();
</script>
<!-- ========== 7. RÉSZ VÉGE – FILMEK + FELTÖLTŐ + TÖRLÉS + SZÍNÉSZ GALÉRIA + AUTOMATA TARTALOM ========== -->

<!-- ========== 8. RÉSZ ELEJE – FAVICON ========== -->
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><text y='50%' x='50%' dominant-baseline='middle' text-anchor='middle' font-size='44'>🎬</text></svg>">
<!-- ========== 8. RÉSZ VÉGE – FAVICON ========== -->

</body>
</html>
