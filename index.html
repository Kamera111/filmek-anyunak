<!-- =========================
     1. rész eleje – HEAD + ALAP STÍLUSOK
========================== -->
<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Filmek Anyunak</title>

  <style>
    :root { --bg:#0f172a; --card:#111827; --muted:#94a3b8; --txt:#e5e7eb; --accent:#22d3ee; }
    html,body{margin:0;padding:0;background:var(--bg);color:var(--txt);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    .wrap{max-width:980px;margin:0 auto;padding:16px}
    .sticky{position:sticky;top:0;background:linear-gradient(180deg, rgba(15,23,42,.98), rgba(15,23,42,.75) 60%, rgba(15,23,42,0));backdrop-filter: blur(6px);z-index:10}
    header{display:flex;align-items:center;gap:12px;padding:12px 0}
    .title{font-weight:800;font-size:clamp(20px,4.8vw,28px);letter-spacing:.3px}
    .btn{background:#1f2937;color:#fff;border:1px solid #334155;border-radius:12px;padding:10px 14px;cursor:pointer;font-weight:600}
    .btn:active{transform:scale(.98)}
    .btn[hidden]{display:none!important}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px}
    .card{background:var(--card);border:1px solid #1f2937;border-radius:16px;padding:14px}
    .muted{color:var(--muted);font-size:14px}
    input,select,textarea{width:100%;padding:10px;border-radius:12px;border:1px solid #334155;background:#0b1220;color:#e5e7eb}
    label{font-size:13px;color:#b3c1d1;margin-bottom:6px;display:block}
    form .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    img{max-width:100%;border-radius:10px;border:1px solid #1f2937}
    a{color:#a5f3fc;text-decoration:none}
    a:hover{text-decoration:underline}
    .hidden{display:none!important}
    .footer{margin:30px 0 10px;text-align:center;color:#6b7280;font-size:12px}
  </style>
</head>
<!-- =========================
     1. rész vége
========================== -->

<!-- ===== [SZAKASZ 2] VENDÉG PIN KAPU – START ===== -->
<style>
  /* Teljes képernyős, sötétített kapu */
  #gateOverlay {
    position: fixed; inset: 0; z-index: 9999;
    display: flex; align-items: center; justify-content: center;
    background: rgba(6,12,20,0.92);
    backdrop-filter: blur(2px);
  }
  #gateBox {
    width: min(520px, 92vw);
    display: flex; flex-direction: column; gap: 14px;
    background: #111827; border-radius: 16px; padding: 22px 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,.35);
  }
  #gateTitle {
    color: #e5e7eb; font-size: 18px; font-weight: 700; letter-spacing:.3px;
  }
  #guestPinInput {
    width: 100%;
    font-size: 22px; line-height: 1; padding: 14px 16px;
    border-radius: 12px; border: 1px solid #374151;
    background: #0f172a; color: #f9fafb;
    outline: none;
  }
  #guestPinInput::placeholder { color: #9ca3af; }
  #gateHint {
    color:#9ca3af; font-size: 13px;
  }
  #adminTinyBtn {
    align-self: flex-start;
    margin-top: 6px;
    font-size: 13px; font-weight: 700; letter-spacing:.2px;
    padding: 6px 10px; border-radius: 999px; border: 1px solid #334155;
    background:#0b1220; color:#e5e7eb; cursor:pointer;
  }
  #adminTinyBtn:hover { filter: brightness(1.08); }
  /* Ha feloldva: a kapu rejtve */
  #gateOverlay[hidden] { display: none !important; }
</style>

<div id="gateOverlay" role="dialog" aria-modal="true">
  <div id="gateBox">
    <div id="gateTitle">Vendég PIN</div>
    <input id="guestPinInput"
           type="tel" inputmode="numeric" autocomplete="one-time-code"
           placeholder="katt ide a kódot" maxlength="6" />
    <div id="gateHint">Írd be a 6 számjegyet, és <strong>automatikusan belépsz</strong>.</div>
    <button id="adminTinyBtn" type="button" aria-label="Admin belépés">A</button>
  </div>
</div>

<script>
  // ===== Beállítások
  const GUEST_PIN = "195400";
  const LS_KEY = "filmek_anyunak_guest_ok";

  // Feloldás
  function unlockGuest() {
    try { localStorage.setItem(LS_KEY, "1"); } catch {}
    // csak elrejtjük az overlayt; az app már alatta fut
    document.getElementById("gateOverlay")?.setAttribute("hidden","hidden");
  }

  // Első betöltéskor mutassuk-e a kaput?
  function showGateIfNeeded() {
    const ok = (()=>{
      try { return localStorage.getItem(LS_KEY) === "1"; } catch { return false; }
    })();
    const overlay = document.getElementById("gateOverlay");
    if (!overlay) return;
    if (ok) {
      overlay.setAttribute("hidden","hidden");
    } else {
      overlay.removeAttribute("hidden");
      // fókusz a mezőre
      setTimeout(()=> document.getElementById("guestPinInput")?.focus(), 10);
    }
  }

  // PIN ellenőrzés – gomb NÉLKÜL, azonnali belépés
  function handlePinInput(ev) {
    const raw = (ev.target.value || "");
    // csak számjegyek
    const norm = raw.replace(/\D+/g,"").slice(0, 6);
    if (norm !== raw) ev.target.value = norm;
    if (norm.length === 6 && norm === GUEST_PIN) {
      unlockGuest();
    }
  }

  // Admin gomb – később kötjük be az admin modalt
  function openAdmin() {
    // Ha már van külön admin modalod, itt hívd meg:
    if (typeof openAdminModal === "function") return openAdminModal();
    alert("Admin belépés hamarosan elérhető.");
  }

  // Init
  (function initGate(){
    document.addEventListener("DOMContentLoaded", () => {
      showGateIfNeeded();
      const pin = document.getElementById("guestPinInput");
      pin?.addEventListener("input", handlePinInput);
      document.getElementById("adminTinyBtn")?.addEventListener("click", openAdmin);
      // Ha rákattint a háttérre, fókusz a mezőre
      document.getElementById("gateOverlay")?.addEventListener("click", (e)=>{
        if (e.target && e.target.id === "gateOverlay") pin?.focus();
      });
      // Másik fülön is feloldtad? Szinkronizáljuk.
      window.addEventListener("storage", (e)=>{
        if (e.key === LS_KEY && e.newValue === "1") showGateIfNeeded();
      });
    });
  })();
</script>
<!-- ===== [SZAKASZ 2] VENDÉG PIN KAPU – END ===== -->

<!-- ===== [SZAKASZ 3] FEJLÉC + KATEGÓRIÁK + NÉZETEK – START ===== -->
<div id="app" class="wrap">
  <div class="sticky">
   <header>
  <div class="title" style="display:none">Filmek Anyunak</div>

  <div style="margin-left:auto; display:flex; gap:8px;">
    <button id="btnLogoutAll" class="btn btn-danger" title="Kijelentkezés és vissza a PIN-hez">
      Kilépés mindenből
    </button>
    <button class="btn" id="btnRefreshAll">Frissítés</button>
  </div>
</header>

    <!-- Egyetlen gombsor -->
    <div id="catBar">
      <div class="cats-row" id="catsLive"></div>
    </div>
  </div>

  <main id="view" class="view"></main>
</div>
<!-- ===== [SZAKASZ 3] FEJLÉC + KATEGÓRIÁK + NÉZETEK – END ===== -->

<!-- ===== [SZAKASZ 4] STÍLUS – START ===== -->
<style>
  h1, h2 { display:none !important; }

  #catBar { padding: 12px; }
  .cats-row { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px,1fr)); gap: 12px; }
  .cat {
    display: flex; flex-direction: column; align-items: flex-start; justify-content: center;
    padding: 14px 16px; border-radius: 14px; background: #1f2937; color: #fff; cursor: pointer;
    box-shadow: 0 4px 14px rgba(0,0,0,.18); transition: transform .08s ease, box-shadow .12s ease;
    min-height: 84px; text-align: left;
  }
  .cat:hover { transform: translateY(-1px); box-shadow: 0 8px 18px rgba(0,0,0,.22); }
  .cat .name { font-weight: 700; font-size: 18px; line-height: 1.2; margin-bottom: 6px; }
  .cat .now  { font-size: 15px; opacity: .95; white-space: normal; }
  .cat .now .label { opacity:.9; margin-right:6px; }
  .cat .now .title { font-weight: 800; }
      .btn-danger{
    background:#dc2626; /* piros */
    border:1px solid #b91c1c;
    color:#fff;
  }
  .btn-danger:hover{ filter:brightness(1.05); }
</style>
<!-- ===== [SZAKASZ 4] STÍLUS – END ===== -->

<!-- ===== [SZAKASZ 5] LOGIKA – GOMBOK + CÍM-KINYERÉS – START ===== -->
<script>
/**
 * Röviden:
 * - Gombfelirat: "Most megy: Kattints" -> siker esetén filmcím.
 * - Sweet.tv: a konkrét csatorna-oldal bal listájából, majd fallback a /free_tv főlistából.
 * - Telekom TV GO: megpróbáljuk a player oldal (<title>, og:description), + pár lehetséges JSON-részlet.
 *   (Sok Telekom oldal bejelentkezést igényel; ha nem olvasható, marad "Kattints".)
 * - Dupla nagy cím + vendég/admin űrlap rejtve a főoldalon.
 * - Frissítés: első betöltés + gomb + 5 percenként automatikus kör.
 */

const channels = [];

/* ========== [5.1] CSATORNÁK – START ========== */
function addChannel({ id, name, url, sweetName, provider }) {
  channels.push({ id, name, url, sweetName, provider });
}

/* SWEET.TV – 4 gomb */
addChannel({
  id: "live-vigjatek",
  name: "ÉLŐ Vígjáték TV",
  url: "https://sweet.tv/hu/free_tv/2014-comedy-universe-hd",
  sweetName: "Vígjáték univerzum HD",
  provider: "sweet"
});
addChannel({
  id: "live-akcio",
  name: "ÉLŐ Akció TV",
  url: "https://sweet.tv/hu/free_tv/2010-action-zone-hd",
  sweetName: "Akció zóna HD",
  provider: "sweet"
});
addChannel({
  id: "live-thriller",
  name: "ÉLŐ Thriller TV",
  url: "https://sweet.tv/hu/free_tv/2016-thriller-time-hd",
  sweetName: "Thriller idő HD",
  provider: "sweet"
});
addChannel({
  id: "live-top",
  name: "ÉLŐ TOP Filmek",
  url: "https://sweet.tv/hu/free_tv/2967-top-movies-hd",
  sweetName: "Top Filmek HD",
  provider: "sweet"
});

/* TELEKOM TV GO – 12 gomb */
addChannel({ id:"tgo-13",  name:"Mozi+ tv",        url:"https://player.telekomtvgo.hu/player/live?channelNumber=13",  provider:"telekom" });
addChannel({ id:"tgo-15",  name:"Film + tv",       url:"https://player.telekomtvgo.hu/player/live?channelNumber=15",  provider:"telekom" });
addChannel({ id:"tgo-21",  name:"Prime tv",        url:"https://player.telekomtvgo.hu/player/live?channelNumber=21",  provider:"telekom" });
addChannel({ id:"tgo-24",  name:"RTL 2 tv",        url:"https://player.telekomtvgo.hu/player/live?channelNumber=24",  provider:"telekom" });
addChannel({ id:"tgo-28",  name:"FilmCafe tv",     url:"https://player.telekomtvgo.hu/player/live?channelNumber=28",  provider:"telekom" });
addChannel({ id:"tgo-30",  name:"ozone tv",        url:"https://player.telekomtvgo.hu/player/live?channelNumber=30",  provider:"telekom" });
addChannel({ id:"tgo-60",  name:"Cool tv",         url:"https://player.telekomtvgo.hu/player/live?channelNumber=60",  provider:"telekom" });
addChannel({ id:"tgo-61",  name:"AXN tv",          url:"https://player.telekomtvgo.hu/player/live?channelNumber=61",  provider:"telekom" });
addChannel({ id:"tgo-62",  name:"AMC tv",          url:"https://player.telekomtvgo.hu/player/live?channelNumber=62",  provider:"telekom" });
addChannel({ id:"tgo-66",  name:"Paramount tv",    url:"https://player.telekomtvgo.hu/player/live?channelNumber=66",  provider:"telekom" });
addChannel({ id:"tgo-163", name:"FilmMánia tv",    url:"https://player.telekomtvgo.hu/player/live?channelNumber=163", provider:"telekom" });
addChannel({ id:"tgo-169", name:"Moziverzum tv",   url:"https://player.telekomtvgo.hu/player/live?channelNumber=169", provider:"telekom" });

/* Ide jöhet még +10 gomb a jövőben:
   addChannel({ id:"...", name:"...", url:"https://...", provider:"sweet|telekom", sweetName:"(ha sweet)" });
*/
/* ========== [5.1] CSATORNÁK – END ========== */

/* ========== [5.2] DUPLA CÍM + BELÉPÉSEK ELREJTÉSE – START ========== */
document.addEventListener("DOMContentLoaded", () => {
  const heads = document.querySelectorAll("h1, h2, .title");
  heads.forEach(el => {
    if (/^\s*Filmek Anyunak\s*$/i.test(el.textContent || "")) el.style.display = "none";
  });
  const suspects = [
    "#guestPinWrap","#guestGate","#guestLogin",".guest-login",
    "#adminWrap","#adminLogin",".admin-login",".auth",".loginWrap",".login-wrap","#auth"
  ];
  suspects.forEach(sel => document.querySelectorAll(sel).forEach(el => el.setAttribute("hidden","hidden")));
  document.querySelectorAll("form, .card, .row, div").forEach(el => {
    const txt = (el.textContent || "").toLowerCase();
    if (txt.includes("admin belépés") || txt.includes("admin email") || txt.includes("jelszó") || txt.includes("katt ide! add a kódot")) {
      if (!el.contains(document.getElementById("catsLive"))) el.hidden = true;
    }
  });
});
/* ========== [5.2] DUPLA CÍM + BELÉPÉSEK ELREJTÉSE – END ========== */

/* ========== [5.3] UI + FRISSÍTÉS – START ========== */
const catsLiveEl = document.getElementById("catsLive");
const btnRefreshAll = document.getElementById("btnRefreshAll");
const REFRESH_MS = 5 * 60 * 1000; // 5 perc

function renderButtons() {
  catsLiveEl.innerHTML = "";
  for (const ch of channels) {
    const btn = document.createElement("button");
    btn.className = "cat";
    btn.dataset.channel = ch.id;
    btn.innerHTML = `
      <div class="name">${escapeHtml(ch.name)}</div>
      <div class="now"><span class="label">Most megy:</span><span class="title" id="now-${ch.id}">Kattints</span></div>
    `;
    btn.addEventListener("click", () => window.open(ch.url, "_blank"));
    catsLiveEl.appendChild(btn);
  }
}
renderButtons();

btnRefreshAll?.addEventListener("click", () => refreshAll(true));
refreshAll(false);
setInterval(() => refreshAll(false), REFRESH_MS);
/* ========== [5.3] UI + FRISSÍTÉS – END ========== */

/* ========== [5.4] CÍM-KINYERÉS – START ========== */
async function refreshAll(force) {
  await Promise.all(channels.map(ch => updateOne(ch, force)));
}

async function updateOne(ch, force) {
  const out = document.getElementById(`now-${ch.id}`);
  if (!out) return;

  try {
    let title = null;

    if (ch.provider === "sweet") {
      // 1) konkrét csatorna-oldal
      title = await sweetFromChannel(ch.url, ch.sweetName);
      // 2) fallback: főlista
      if (!title) {
        const html = await fetchHtml("https://sweet.tv/hu/free_tv");
        title = findNear(html, ch.sweetName);
      }
    } else if (ch.provider === "telekom") {
      title = await telekomFromPlayer(ch.url);
    }

    // végső fallback: marad a "Kattints"
    out.textContent = title ? cleanTitle(title) : "Kattints";
  } catch {
    out.textContent = "Kattints";
  }
}

/* ---- SWEET.TV PARSING ---- */
async function sweetFromChannel(url, sweetName) {
  const html = await fetchHtml(url);
  // név környékéről próbálunk címet kiolvasni
  let t = sweetName ? findNear(html, sweetName) : null;
  if (t) return t;

  // JSON nyomok
  t = matchJsonNowTitle(html);
  if (t) return t;

  // meta / title
  t = matchTitle(html) || matchOg(html, 'og:description') || matchOg(html, 'og:title');
  return t || null;
}

/* ---- TELEKOM TV GO PARSING (best-effort) ----
   - player oldal <title>, og:description
   - esetleges "currentProgram"/"now"/"title" JSON darabok
*/
async function telekomFromPlayer(url) {
  const html = await fetchHtml(url);

  // 1) <title>
  let t = matchTitle(html);
  if (t && looksLikeTitle(t)) return t;

  // 2) OpenGraph
  t = matchOg(html, 'og:description') || matchOg(html, 'og:title');
  if (t && looksLikeTitle(t)) return t;

  // 3) JSON minták
  const m1 = html.match(/"currentProgram"[^{}]*\{[^{}]*"title"\s*:\s*"([^"]{2,120})"/i);
  if (m1 && m1[1]) return m1[1];
  const m2 = html.match(/"(now|program|epg)"[^{}]*\{[^{}]*"title"\s*:\s*"([^"]{2,120})"/i);
  if (m2 && m2[2]) return m2[2];

  // 4) Bizonyos oldalakon a csatorna neve után közvetlenül szerepelhet a cím – első értelmes sor
  const texts = (html.match(/>([^<>]{1,160})</g) || [])
    .map(s => s.replace(/^>|<$/g,"").replace(/[<>]/g,"").trim())
    .map(s => s.replace(/\s+/g," ").trim())
    .filter(Boolean);
  for (const x of texts) {
    if (looksLikeTitle(x)) return x;
  }

  return null;
}

/* ---- Közös segédek ---- */
async function fetchHtml(url) {
  const proxied = url.startsWith("https://")
    ? `https://r.jina.ai/${url}`
    : `https://r.jina.ai/http://${url.replace(/^https?:\/\//,'')}`;
  const res = await fetch(proxied, { method: "GET" });
  if (!res.ok) throw new Error("fetch failed");
  return await res.text();
}

function matchTitle(text) {
  const m = text.match(/<title[^>]*>([\s\S]*?)<\/title>/i);
  return m && m[1] ? m[1] : null;
}
function matchOg(text, prop) {
  const re = new RegExp(`property=["']${prop}["'][^>]*content=["']([^"']+)["']`, "i");
  const m = text.match(re);
  return m && m[1] ? m[1] : null;
}
function matchJsonNowTitle(text) {
  const m1 = text.match(/"now"[^{}]*\{[^{}]*"title"\s*:\s*"([^"]{2,120})"/i);
  if (m1 && m1[1]) return m1[1];
  const m2 = text.match(/"(current|program|epg)"[^{}]*\{[^{}]*"title"\s*:\s*"([^"]{2,120})"/i);
  return (m2 && m2[2]) ? m2[2] : null;
}

function findNear(html, sweetName) {
  if (!sweetName) return null;
  const idx = html.search(new RegExp(escapeRegex(sweetName), "i"));
  if (idx < 0) return null;
  const slice = html.slice(idx, Math.min(html.length, idx + 2600));
  const texts = (slice.match(/>([^<>]{1,160})</g) || [])
    .map(s => s.replace(/^>|<$/g,"").replace(/[<>]/g,"").trim())
    .map(s => s.replace(/\s+/g," ").trim())
    .filter(Boolean);

  const nameNorm = normalizeKey(sweetName);
  const badRe = /^(HD|Full\s*HD|TV|Live|Új|Összes|Bejelentkezés|Regisztráció|Profil|Kategóriák)$/i;

  const candidates = texts
    .filter(t => normalizeKey(t) !== nameNorm)
    .filter(t => !badRe.test(t))
    .filter(t => t.length >= 2 && t.length <= 120);

  for (const t of candidates) {
    if (looksLikeTitle(t)) return t;
  }
  return null;
}

function looksLikeTitle(t) {
  if (!t) return false;
  if (t.length < 3) return false;
  if (/^\d{1,2}:\d{2}$/.test(t)) return false; // csak időpont
  if (/^HD$/i.test(t)) return false;
  if (/^\w{1,3}$/.test(t)) return false;
  return true;
}

function cleanTitle(t) {
  return String(t)
    .replace(/\s+\|\s*Sweet\.?TV.*$/i, "")
    .replace(/ - Sweet\.?TV.*$/i, "")
    .replace(/\s+—\s+.*$/,"")
    .replace(/\s*\|\s*HD\s*$/i,"")
    .replace(/\s+/g," ")
    .trim();
}
function escapeHtml(str) {
  return String(str)
    .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
    .replaceAll('"',"&quot;").replaceAll("'","&#39;");
}
function escapeRegex(s) { return String(s).replace(/[.*+?^${}()|[\]\\]/g, "\\$&"); }
function normalizeKey(s) {
  return String(s).toLowerCase()
    .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
    .replace(/\s+/g," ").trim();
}
/* ========== [5.4] CÍM-KINYERÉS – END ========== */
     <script>
  // === Kilépés mindenből → vissza a PIN kapuhoz ===
  (function setupGlobalLogout(){
    const BTN_ID = "btnLogoutAll";
    const LS_KEY_GUEST = "filmek_anyunak_guest_ok";
    const ADMIN_KEYS = ["filmek_anyunak_admin_ok","admin_session","admin_email"];

    function showPinGateNow() {
      try {
        // töröljük a vendég és (ha volt) admin státuszt
        localStorage.removeItem(LS_KEY_GUEST);
        ADMIN_KEYS.forEach(k => localStorage.removeItem(k));
        sessionStorage.clear();
      } catch {}

      // PIN kapu megjelenítése (ha a [SZAKASZ 2] már betöltve van)
      const gate = document.getElementById("gateOverlay");
      if (gate) {
        gate.removeAttribute("hidden");
        const pin = document.getElementById("guestPinInput");
        if (pin) { pin.value = ""; pin.focus(); }
        // opcionális: görgessünk tetejére
        window.scrollTo({top:0, behavior:"instant"});
      } else {
        // biztos, ami biztos: teljes újratöltés, hogy a kapu garantáltan feljöjjön
        location.replace(location.origin + location.pathname);
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById(BTN_ID)?.addEventListener("click", showPinGateNow);
    });
  })();

</script>
<!-- ===== [SZAKASZ 5] LOGIKA – GOMBOK + CÍM-KINYERÉS – END ===== -->

<!-- =========================
     6. rész eleje – AUTH (vendég + admin)
========================== -->
<script type="module">
  import { onAuthStateChanged, signInWithEmailAndPassword, signOut }
    from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";

  const { auth } = window.fb;

  const pinView      = document.getElementById('pinView');
  const appView      = document.getElementById('app');
  const guestPin     = document.getElementById('guestPin');
  const btnShowAdmin = document.getElementById('btnShowAdmin');
  const adminForm    = document.getElementById('adminLoginForm');
  const btnLogout    = document.getElementById('btnAdminLogout');
  const btnAdd       = document.getElementById('btnAddGlobal');
  const adminPanel   = document.getElementById('adminPanel');
  const pinError     = document.getElementById('pinError');

  // Vendég beléptetés automatikusan 6 szám után
  async function guestLogin(){
    try {
      await signInWithEmailAndPassword(auth,"guest@filmek-anyunak.app","195400");
    } catch(e) {
      if(pinError){ pinError.textContent="Hibás PIN kód!"; pinError.style.display="block"; }
      if(guestPin){ guestPin.value=""; guestPin.focus(); }
    }
  }
  if (guestPin){
    guestPin.addEventListener('input',()=>{
      if(pinError) pinError.style.display="none";
      if(guestPin.value.replace(/\D/g,'').length===6) guestLogin();
    });
  }

  // Admin űrlap mutatás/elrejtés – mindig üres mezőkkel nyisson
  if (btnShowAdmin && adminForm){
    btnShowAdmin.addEventListener('click',()=>{
      adminForm.classList.toggle('show');
      if(adminForm.classList.contains('show')){
        const e=document.getElementById('adminEmail'), p=document.getElementById('adminPass');
        if(e) e.value=""; if(p) p.value=""; e?.focus();
      }
    });
  }

  // Admin belépés
  adminForm?.addEventListener('submit',async ev=>{
    ev.preventDefault();
    const email=document.getElementById('adminEmail').value.trim();
    const pass =document.getElementById('adminPass').value;
    try{ await signInWithEmailAndPassword(auth,email,pass); }
    catch(e){ alert("Hiba: "+(e?.message||e)); }
    finally{ const p=document.getElementById('adminPass'); if(p) p.value=""; }
  });

  // Kijelentkezés
  btnLogout?.addEventListener('click', async ()=>{ await signOut(auth); });

  // Auth állapot váltás
  onAuthStateChanged(auth,u=>{
    const logged=!!u;
    const isAdmin=logged && u.email==="chisnyan@gmail.com";
    pinView?.classList.toggle('hidden',logged);
    appView?.classList.toggle('hidden',!logged);
    btnLogout?.classList.toggle('hidden',!logged);
    btnAdd?.classList.toggle('hidden',!isAdmin);
    adminPanel?.classList.toggle('hidden',!isAdmin);
    if(logged && window.startRealtime) window.startRealtime();
  });
</script>
<!-- =========================
     6. rész vége
========================== -->


<!-- =========================
     7. rész eleje – BELÉPŐ (vendég PIN + admin gomb/űrlap)
========================== -->
<div id="pinView" class="wrap">
  <input
    id="guestPin"
    class="pinInput"
    type="text"
    inputmode="numeric"
    pattern="[0-9]*"
    maxlength="6"
    placeholder="Katt ide! Add a kódot!"
    aria-label="Vendég PIN"
    autocomplete="one-time-code"
  />
  <div id="pinError" role="alert" aria-live="polite" style="display:none;"></div>
  <button id="btnShowAdmin" type="button" title="Admin belépés">A</button>
  <form id="adminLoginForm" autocomplete="off">
    <input id="adminEmail" type="email" inputmode="email" placeholder="Admin email"
           autocomplete="off" autocapitalize="none" spellcheck="false" required />
    <input id="adminPass" type="password" placeholder="Jelszó"
           autocomplete="new-password" autocapitalize="none" spellcheck="false" required />
    <button type="submit">Admin belépés</button>
  </form>
</div>
<!-- =========================
     7. rész vége
========================== -->


<!-- =========================
     8. rész eleje – (Megjegyzés) FIRESTORE SECURITY RULES – csak a konzolba
========================== -->
<!--
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Olvasás csak bejelentkezve
    match /{doc=**} { allow read: if request.auth != null; }

    // Írás csak admin emailről
    match /categories/{cat}/movies/{doc} {
      allow create, update, delete: if request.auth != null
        && request.auth.token.email == "chisnyan@gmail.com";
    }
  }
}
-->
<!-- =========================
     8. rész vége
========================== -->

</body>
</html>
